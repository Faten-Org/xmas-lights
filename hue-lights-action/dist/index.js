module.exports=(()=>{var __webpack_modules__={2932:(e,t,r)=>{const n=r(5622),s=r(2186),i=r(8039).v3,o=i.lightStates.LightState;async function run(){try{const e=getRequiredInputValue("username"),t=getRequiredInputValue("bridge");const r=await getHueApi(t,e);const n=getLightNames();const i=await getLights(r,n);const o=i.map(e=>{return{id:e.id,name:e.name,type:e.type,modelid:e.modelid}});s.setOutput("lights",o)}catch(e){s.setFailed(e.message)}}run();function getRequiredInputValue(e){return s.getInput(e,{required:true})}function getLightNames(){const e=getRequiredInputValue("light_names");if(typeof e==="string"){return[e]}return[].concat(...e)}async function getLights(e,t){console.log(`Looking for lights: ${JSON.stringify(t)}`);if(!t||t.length<=0){return Promise.resolve([])}return e.lights.getAll().then(e=>{return e.filter(e=>{return t.indexOf(e.name)>-1})})}async function getHueApi(e,t){return i.api.createLocal(e).connect(t)}},7351:function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const s=n(r(2087));const i=r(5278);function issueCommand(e,t,r){const n=new Command(e,t,r);process.stdout.write(n.toString()+s.EOL)}t.issueCommand=issueCommand;function issue(e,t=""){issueCommand(e,{},t)}t.issue=issue;const o="::";class Command{constructor(e,t,r){if(!e){e="missing.command"}this.command=e;this.properties=t;this.message=r}toString(){let e=o+this.command;if(this.properties&&Object.keys(this.properties).length>0){e+=" ";let t=true;for(const r in this.properties){if(this.properties.hasOwnProperty(r)){const n=this.properties[r];if(n){if(t){t=false}else{e+=","}e+=`${r}=${escapeProperty(n)}`}}}}e+=`${o}${escapeData(this.message)}`;return e}}function escapeData(e){return i.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(e){return i.toCommandValue(e).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},2186:function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){function adopt(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,s){function fulfilled(e){try{step(n.next(e))}catch(e){s(e)}}function rejected(e){try{step(n["throw"](e))}catch(e){s(e)}}function step(e){e.done?r(e.value):adopt(e.value).then(fulfilled,rejected)}step((n=n.apply(e,t||[])).next())})};var s=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const i=r(7351);const o=r(717);const u=r(5278);const a=s(r(2087));const c=s(r(5622));var l;(function(e){e[e["Success"]=0]="Success";e[e["Failure"]=1]="Failure"})(l=t.ExitCode||(t.ExitCode={}));function exportVariable(e,t){const r=u.toCommandValue(t);process.env[e]=r;const n=process.env["GITHUB_ENV"]||"";if(n){const t="_GitHubActionsFileCommandDelimeter_";const n=`${e}<<${t}${a.EOL}${r}${a.EOL}${t}`;o.issueCommand("ENV",n)}else{i.issueCommand("set-env",{name:e},r)}}t.exportVariable=exportVariable;function setSecret(e){i.issueCommand("add-mask",{},e)}t.setSecret=setSecret;function addPath(e){const t=process.env["GITHUB_PATH"]||"";if(t){o.issueCommand("PATH",e)}else{i.issueCommand("add-path",{},e)}process.env["PATH"]=`${e}${c.delimiter}${process.env["PATH"]}`}t.addPath=addPath;function getInput(e,t){const r=process.env[`INPUT_${e.replace(/ /g,"_").toUpperCase()}`]||"";if(t&&t.required&&!r){throw new Error(`Input required and not supplied: ${e}`)}return r.trim()}t.getInput=getInput;function setOutput(e,t){i.issueCommand("set-output",{name:e},t)}t.setOutput=setOutput;function setCommandEcho(e){i.issue("echo",e?"on":"off")}t.setCommandEcho=setCommandEcho;function setFailed(e){process.exitCode=l.Failure;error(e)}t.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}t.isDebug=isDebug;function debug(e){i.issueCommand("debug",{},e)}t.debug=debug;function error(e){i.issue("error",e instanceof Error?e.toString():e)}t.error=error;function warning(e){i.issue("warning",e instanceof Error?e.toString():e)}t.warning=warning;function info(e){process.stdout.write(e+a.EOL)}t.info=info;function startGroup(e){i.issue("group",e)}t.startGroup=startGroup;function endGroup(){i.issue("endgroup")}t.endGroup=endGroup;function group(e,t){return n(this,void 0,void 0,function*(){startGroup(e);let r;try{r=yield t()}finally{endGroup()}return r})}t.group=group;function saveState(e,t){i.issueCommand("save-state",{name:e},t)}t.saveState=saveState;function getState(e){return process.env[`STATE_${e}`]||""}t.getState=getState},717:function(e,t,r){"use strict";var n=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var r in e)if(Object.hasOwnProperty.call(e,r))t[r]=e[r];t["default"]=e;return t};Object.defineProperty(t,"__esModule",{value:true});const s=n(r(5747));const i=n(r(2087));const o=r(5278);function issueCommand(e,t){const r=process.env[`GITHUB_${e}`];if(!r){throw new Error(`Unable to find environment variable for file command ${e}`)}if(!s.existsSync(r)){throw new Error(`Missing file at path: ${r}`)}s.appendFileSync(r,`${o.toCommandValue(t)}${i.EOL}`,{encoding:"utf8"})}t.issueCommand=issueCommand},5278:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:true});function toCommandValue(e){if(e===null||e===undefined){return""}else if(typeof e==="string"||e instanceof String){return e}return JSON.stringify(e)}t.toCommandValue=toCommandValue},6545:(e,t,r)=>{e.exports=r(2618)},8104:(e,t,r)=>{"use strict";var n=r(328);var s=r(3211);var i=r(1934);var o=r(646);var u=r(8605);var a=r(7211);var c=r(7707).http;var l=r(7707).https;var h=r(8835);var d=r(8761);var p=r(696);var g=r(5226);var f=r(1516);var m=/https:?/;e.exports=function httpAdapter(e){return new Promise(function dispatchHttpRequest(t,r){var _=function resolve(e){t(e)};var y=function reject(e){r(e)};var b=e.data;var v=e.headers;if(!v["User-Agent"]&&!v["user-agent"]){v["User-Agent"]="axios/"+p.version}if(b&&!n.isStream(b)){if(Buffer.isBuffer(b)){}else if(n.isArrayBuffer(b)){b=Buffer.from(new Uint8Array(b))}else if(n.isString(b)){b=Buffer.from(b,"utf-8")}else{return y(g("Data after transformation must be a string, an ArrayBuffer, a Buffer, or a Stream",e))}v["Content-Length"]=b.length}var w=undefined;if(e.auth){var x=e.auth.username||"";var A=e.auth.password||"";w=x+":"+A}var S=i(e.baseURL,e.url);var k=h.parse(S);var V=k.protocol||"http:";if(!w&&k.auth){var C=k.auth.split(":");var R=C[0]||"";var T=C[1]||"";w=R+":"+T}if(w){delete v.Authorization}var L=m.test(V);var P=L?e.httpsAgent:e.httpAgent;var B={path:o(k.path,e.params,e.paramsSerializer).replace(/^\?/,""),method:e.method.toUpperCase(),headers:v,agent:P,agents:{http:e.httpAgent,https:e.httpsAgent},auth:w};if(e.socketPath){B.socketPath=e.socketPath}else{B.hostname=k.hostname;B.port=k.port}var E=e.proxy;if(!E&&E!==false){var j=V.slice(0,-1)+"_proxy";var I=process.env[j]||process.env[j.toUpperCase()];if(I){var D=h.parse(I);var O=process.env.no_proxy||process.env.NO_PROXY;var q=true;if(O){var U=O.split(",").map(function trim(e){return e.trim()});q=!U.some(function proxyMatch(e){if(!e){return false}if(e==="*"){return true}if(e[0]==="."&&k.hostname.substr(k.hostname.length-e.length)===e){return true}return k.hostname===e})}if(q){E={host:D.hostname,port:D.port};if(D.auth){var F=D.auth.split(":");E.auth={username:F[0],password:F[1]}}}}}if(E){B.hostname=E.host;B.host=E.host;B.headers.host=k.hostname+(k.port?":"+k.port:"");B.port=E.port;B.path=V+"//"+k.hostname+(k.port?":"+k.port:"")+B.path;if(E.auth){var N=Buffer.from(E.auth.username+":"+E.auth.password,"utf8").toString("base64");B.headers["Proxy-Authorization"]="Basic "+N}}var G;var $=L&&(E?m.test(E.protocol):true);if(e.transport){G=e.transport}else if(e.maxRedirects===0){G=$?a:u}else{if(e.maxRedirects){B.maxRedirects=e.maxRedirects}G=$?l:c}if(e.maxContentLength&&e.maxContentLength>-1){B.maxBodyLength=e.maxContentLength}var M=G.request(B,function handleResponse(t){if(M.aborted)return;var r=t;switch(t.headers["content-encoding"]){case"gzip":case"compress":case"deflate":r=t.statusCode===204?r:r.pipe(d.createUnzip());delete t.headers["content-encoding"];break}var n=t.req||M;var i={status:t.statusCode,statusText:t.statusMessage,headers:t.headers,config:e,request:n};if(e.responseType==="stream"){i.data=r;s(_,y,i)}else{var o=[];r.on("data",function handleStreamData(t){o.push(t);if(e.maxContentLength>-1&&Buffer.concat(o).length>e.maxContentLength){r.destroy();y(g("maxContentLength size of "+e.maxContentLength+" exceeded",e,null,n))}});r.on("error",function handleStreamError(t){if(M.aborted)return;y(f(t,e,null,n))});r.on("end",function handleStreamEnd(){var t=Buffer.concat(o);if(e.responseType!=="arraybuffer"){t=t.toString(e.responseEncoding)}i.data=t;s(_,y,i)})}});M.on("error",function handleRequestError(t){if(M.aborted)return;y(f(t,e,null,M))});if(e.timeout){M.setTimeout(e.timeout,function handleRequestTimeout(){M.abort();y(g("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",M))})}if(e.cancelToken){e.cancelToken.promise.then(function onCanceled(e){if(M.aborted)return;M.abort();y(e)})}if(n.isStream(b)){b.on("error",function handleStreamError(t){y(f(t,e,null,M))}).pipe(M)}else{M.end(b)}})}},3454:(e,t,r)=>{"use strict";var n=r(328);var s=r(3211);var i=r(646);var o=r(1934);var u=r(6455);var a=r(3608);var c=r(5226);e.exports=function xhrAdapter(e){return new Promise(function dispatchXhrRequest(t,l){var h=e.data;var d=e.headers;if(n.isFormData(h)){delete d["Content-Type"]}var p=new XMLHttpRequest;if(e.auth){var g=e.auth.username||"";var f=e.auth.password||"";d.Authorization="Basic "+btoa(g+":"+f)}var m=o(e.baseURL,e.url);p.open(e.method.toUpperCase(),i(m,e.params,e.paramsSerializer),true);p.timeout=e.timeout;p.onreadystatechange=function handleLoad(){if(!p||p.readyState!==4){return}if(p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)){return}var r="getAllResponseHeaders"in p?u(p.getAllResponseHeaders()):null;var n=!e.responseType||e.responseType==="text"?p.responseText:p.response;var i={data:n,status:p.status,statusText:p.statusText,headers:r,config:e,request:p};s(t,l,i);p=null};p.onabort=function handleAbort(){if(!p){return}l(c("Request aborted",e,"ECONNABORTED",p));p=null};p.onerror=function handleError(){l(c("Network Error",e,null,p));p=null};p.ontimeout=function handleTimeout(){var t="timeout of "+e.timeout+"ms exceeded";if(e.timeoutErrorMessage){t=e.timeoutErrorMessage}l(c(t,e,"ECONNABORTED",p));p=null};if(n.isStandardBrowserEnv()){var _=r(1545);var y=(e.withCredentials||a(m))&&e.xsrfCookieName?_.read(e.xsrfCookieName):undefined;if(y){d[e.xsrfHeaderName]=y}}if("setRequestHeader"in p){n.forEach(d,function setRequestHeader(e,t){if(typeof h==="undefined"&&t.toLowerCase()==="content-type"){delete d[t]}else{p.setRequestHeader(t,e)}})}if(!n.isUndefined(e.withCredentials)){p.withCredentials=!!e.withCredentials}if(e.responseType){try{p.responseType=e.responseType}catch(t){if(e.responseType!=="json"){throw t}}}if(typeof e.onDownloadProgress==="function"){p.addEventListener("progress",e.onDownloadProgress)}if(typeof e.onUploadProgress==="function"&&p.upload){p.upload.addEventListener("progress",e.onUploadProgress)}if(e.cancelToken){e.cancelToken.promise.then(function onCanceled(e){if(!p){return}p.abort();l(e);p=null})}if(h===undefined){h=null}p.send(h)})}},2618:(e,t,r)=>{"use strict";var n=r(328);var s=r(7065);var i=r(8178);var o=r(4831);var u=r(8190);function createInstance(e){var t=new i(e);var r=s(i.prototype.request,t);n.extend(r,i.prototype,t);n.extend(r,t);return r}var a=createInstance(u);a.Axios=i;a.create=function create(e){return createInstance(o(a.defaults,e))};a.Cancel=r(8875);a.CancelToken=r(1587);a.isCancel=r(4057);a.all=function all(e){return Promise.all(e)};a.spread=r(4850);e.exports=a;e.exports.default=a},8875:e=>{"use strict";function Cancel(e){this.message=e}Cancel.prototype.toString=function toString(){return"Cancel"+(this.message?": "+this.message:"")};Cancel.prototype.__CANCEL__=true;e.exports=Cancel},1587:(e,t,r)=>{"use strict";var n=r(8875);function CancelToken(e){if(typeof e!=="function"){throw new TypeError("executor must be a function.")}var t;this.promise=new Promise(function promiseExecutor(e){t=e});var r=this;e(function cancel(e){if(r.reason){return}r.reason=new n(e);t(r.reason)})}CancelToken.prototype.throwIfRequested=function throwIfRequested(){if(this.reason){throw this.reason}};CancelToken.source=function source(){var e;var t=new CancelToken(function executor(t){e=t});return{token:t,cancel:e}};e.exports=CancelToken},4057:e=>{"use strict";e.exports=function isCancel(e){return!!(e&&e.__CANCEL__)}},8178:(e,t,r)=>{"use strict";var n=r(328);var s=r(646);var i=r(3214);var o=r(5062);var u=r(4831);function Axios(e){this.defaults=e;this.interceptors={request:new i,response:new i}}Axios.prototype.request=function request(e){if(typeof e==="string"){e=arguments[1]||{};e.url=arguments[0]}else{e=e||{}}e=u(this.defaults,e);if(e.method){e.method=e.method.toLowerCase()}else if(this.defaults.method){e.method=this.defaults.method.toLowerCase()}else{e.method="get"}var t=[o,undefined];var r=Promise.resolve(e);this.interceptors.request.forEach(function unshiftRequestInterceptors(e){t.unshift(e.fulfilled,e.rejected)});this.interceptors.response.forEach(function pushResponseInterceptors(e){t.push(e.fulfilled,e.rejected)});while(t.length){r=r.then(t.shift(),t.shift())}return r};Axios.prototype.getUri=function getUri(e){e=u(this.defaults,e);return s(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")};n.forEach(["delete","get","head","options"],function forEachMethodNoData(e){Axios.prototype[e]=function(t,r){return this.request(n.merge(r||{},{method:e,url:t}))}});n.forEach(["post","put","patch"],function forEachMethodWithData(e){Axios.prototype[e]=function(t,r,s){return this.request(n.merge(s||{},{method:e,url:t,data:r}))}});e.exports=Axios},3214:(e,t,r)=>{"use strict";var n=r(328);function InterceptorManager(){this.handlers=[]}InterceptorManager.prototype.use=function use(e,t){this.handlers.push({fulfilled:e,rejected:t});return this.handlers.length-1};InterceptorManager.prototype.eject=function eject(e){if(this.handlers[e]){this.handlers[e]=null}};InterceptorManager.prototype.forEach=function forEach(e){n.forEach(this.handlers,function forEachHandler(t){if(t!==null){e(t)}})};e.exports=InterceptorManager},1934:(e,t,r)=>{"use strict";var n=r(1301);var s=r(7189);e.exports=function buildFullPath(e,t){if(e&&!n(t)){return s(e,t)}return t}},5226:(e,t,r)=>{"use strict";var n=r(1516);e.exports=function createError(e,t,r,s,i){var o=new Error(e);return n(o,t,r,s,i)}},5062:(e,t,r)=>{"use strict";var n=r(328);var s=r(9812);var i=r(4057);var o=r(8190);function throwIfCancellationRequested(e){if(e.cancelToken){e.cancelToken.throwIfRequested()}}e.exports=function dispatchRequest(e){throwIfCancellationRequested(e);e.headers=e.headers||{};e.data=s(e.data,e.headers,e.transformRequest);e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers);n.forEach(["delete","get","head","post","put","patch","common"],function cleanHeaderConfig(t){delete e.headers[t]});var t=e.adapter||o.adapter;return t(e).then(function onAdapterResolution(t){throwIfCancellationRequested(e);t.data=s(t.data,t.headers,e.transformResponse);return t},function onAdapterRejection(t){if(!i(t)){throwIfCancellationRequested(e);if(t&&t.response){t.response.data=s(t.response.data,t.response.headers,e.transformResponse)}}return Promise.reject(t)})}},1516:e=>{"use strict";e.exports=function enhanceError(e,t,r,n,s){e.config=t;if(r){e.code=r}e.request=n;e.response=s;e.isAxiosError=true;e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}};return e}},4831:(e,t,r)=>{"use strict";var n=r(328);e.exports=function mergeConfig(e,t){t=t||{};var r={};var s=["url","method","params","data"];var i=["headers","auth","proxy"];var o=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];n.forEach(s,function valueFromConfig2(e){if(typeof t[e]!=="undefined"){r[e]=t[e]}});n.forEach(i,function mergeDeepProperties(s){if(n.isObject(t[s])){r[s]=n.deepMerge(e[s],t[s])}else if(typeof t[s]!=="undefined"){r[s]=t[s]}else if(n.isObject(e[s])){r[s]=n.deepMerge(e[s])}else if(typeof e[s]!=="undefined"){r[s]=e[s]}});n.forEach(o,function defaultToConfig2(n){if(typeof t[n]!=="undefined"){r[n]=t[n]}else if(typeof e[n]!=="undefined"){r[n]=e[n]}});var u=s.concat(i).concat(o);var a=Object.keys(t).filter(function filterAxiosKeys(e){return u.indexOf(e)===-1});n.forEach(a,function otherKeysDefaultToConfig2(n){if(typeof t[n]!=="undefined"){r[n]=t[n]}else if(typeof e[n]!=="undefined"){r[n]=e[n]}});return r}},3211:(e,t,r)=>{"use strict";var n=r(5226);e.exports=function settle(e,t,r){var s=r.config.validateStatus;if(!s||s(r.status)){e(r)}else{t(n("Request failed with status code "+r.status,r.config,null,r.request,r))}}},9812:(e,t,r)=>{"use strict";var n=r(328);e.exports=function transformData(e,t,r){n.forEach(r,function transform(r){e=r(e,t)});return e}},8190:(e,t,r)=>{"use strict";var n=r(328);var s=r(6240);var i={"Content-Type":"application/x-www-form-urlencoded"};function setContentTypeIfUnset(e,t){if(!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])){e["Content-Type"]=t}}function getDefaultAdapter(){var e;if(typeof XMLHttpRequest!=="undefined"){e=r(3454)}else if(typeof process!=="undefined"&&Object.prototype.toString.call(process)==="[object process]"){e=r(8104)}return e}var o={adapter:getDefaultAdapter(),transformRequest:[function transformRequest(e,t){s(t,"Accept");s(t,"Content-Type");if(n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)){return e}if(n.isArrayBufferView(e)){return e.buffer}if(n.isURLSearchParams(e)){setContentTypeIfUnset(t,"application/x-www-form-urlencoded;charset=utf-8");return e.toString()}if(n.isObject(e)){setContentTypeIfUnset(t,"application/json;charset=utf-8");return JSON.stringify(e)}return e}],transformResponse:[function transformResponse(e){if(typeof e==="string"){try{e=JSON.parse(e)}catch(e){}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function validateStatus(e){return e>=200&&e<300}};o.headers={common:{Accept:"application/json, text/plain, */*"}};n.forEach(["delete","get","head"],function forEachMethodNoData(e){o.headers[e]={}});n.forEach(["post","put","patch"],function forEachMethodWithData(e){o.headers[e]=n.merge(i)});e.exports=o},7065:e=>{"use strict";e.exports=function bind(e,t){return function wrap(){var r=new Array(arguments.length);for(var n=0;n<r.length;n++){r[n]=arguments[n]}return e.apply(t,r)}}},646:(e,t,r)=>{"use strict";var n=r(328);function encode(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function buildURL(e,t,r){if(!t){return e}var s;if(r){s=r(t)}else if(n.isURLSearchParams(t)){s=t.toString()}else{var i=[];n.forEach(t,function serialize(e,t){if(e===null||typeof e==="undefined"){return}if(n.isArray(e)){t=t+"[]"}else{e=[e]}n.forEach(e,function parseValue(e){if(n.isDate(e)){e=e.toISOString()}else if(n.isObject(e)){e=JSON.stringify(e)}i.push(encode(t)+"="+encode(e))})});s=i.join("&")}if(s){var o=e.indexOf("#");if(o!==-1){e=e.slice(0,o)}e+=(e.indexOf("?")===-1?"?":"&")+s}return e}},7189:e=>{"use strict";e.exports=function combineURLs(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},1545:(e,t,r)=>{"use strict";var n=r(328);e.exports=n.isStandardBrowserEnv()?function standardBrowserEnv(){return{write:function write(e,t,r,s,i,o){var u=[];u.push(e+"="+encodeURIComponent(t));if(n.isNumber(r)){u.push("expires="+new Date(r).toGMTString())}if(n.isString(s)){u.push("path="+s)}if(n.isString(i)){u.push("domain="+i)}if(o===true){u.push("secure")}document.cookie=u.join("; ")},read:function read(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function remove(e){this.write(e,"",Date.now()-864e5)}}}():function nonStandardBrowserEnv(){return{write:function write(){},read:function read(){return null},remove:function remove(){}}}()},1301:e=>{"use strict";e.exports=function isAbsoluteURL(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},3608:(e,t,r)=>{"use strict";var n=r(328);e.exports=n.isStandardBrowserEnv()?function standardBrowserEnv(){var e=/(msie|trident)/i.test(navigator.userAgent);var t=document.createElement("a");var r;function resolveURL(r){var n=r;if(e){t.setAttribute("href",n);n=t.href}t.setAttribute("href",n);return{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:t.pathname.charAt(0)==="/"?t.pathname:"/"+t.pathname}}r=resolveURL(window.location.href);return function isURLSameOrigin(e){var t=n.isString(e)?resolveURL(e):e;return t.protocol===r.protocol&&t.host===r.host}}():function nonStandardBrowserEnv(){return function isURLSameOrigin(){return true}}()},6240:(e,t,r)=>{"use strict";var n=r(328);e.exports=function normalizeHeaderName(e,t){n.forEach(e,function processHeader(r,n){if(n!==t&&n.toUpperCase()===t.toUpperCase()){e[t]=r;delete e[n]}})}},6455:(e,t,r)=>{"use strict";var n=r(328);var s=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function parseHeaders(e){var t={};var r;var i;var o;if(!e){return t}n.forEach(e.split("\n"),function parser(e){o=e.indexOf(":");r=n.trim(e.substr(0,o)).toLowerCase();i=n.trim(e.substr(o+1));if(r){if(t[r]&&s.indexOf(r)>=0){return}if(r==="set-cookie"){t[r]=(t[r]?t[r]:[]).concat([i])}else{t[r]=t[r]?t[r]+", "+i:i}}});return t}},4850:e=>{"use strict";e.exports=function spread(e){return function wrap(t){return e.apply(null,t)}}},328:(e,t,r)=>{"use strict";var n=r(7065);var s=Object.prototype.toString;function isArray(e){return s.call(e)==="[object Array]"}function isUndefined(e){return typeof e==="undefined"}function isBuffer(e){return e!==null&&!isUndefined(e)&&e.constructor!==null&&!isUndefined(e.constructor)&&typeof e.constructor.isBuffer==="function"&&e.constructor.isBuffer(e)}function isArrayBuffer(e){return s.call(e)==="[object ArrayBuffer]"}function isFormData(e){return typeof FormData!=="undefined"&&e instanceof FormData}function isArrayBufferView(e){var t;if(typeof ArrayBuffer!=="undefined"&&ArrayBuffer.isView){t=ArrayBuffer.isView(e)}else{t=e&&e.buffer&&e.buffer instanceof ArrayBuffer}return t}function isString(e){return typeof e==="string"}function isNumber(e){return typeof e==="number"}function isObject(e){return e!==null&&typeof e==="object"}function isDate(e){return s.call(e)==="[object Date]"}function isFile(e){return s.call(e)==="[object File]"}function isBlob(e){return s.call(e)==="[object Blob]"}function isFunction(e){return s.call(e)==="[object Function]"}function isStream(e){return isObject(e)&&isFunction(e.pipe)}function isURLSearchParams(e){return typeof URLSearchParams!=="undefined"&&e instanceof URLSearchParams}function trim(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function isStandardBrowserEnv(){if(typeof navigator!=="undefined"&&(navigator.product==="ReactNative"||navigator.product==="NativeScript"||navigator.product==="NS")){return false}return typeof window!=="undefined"&&typeof document!=="undefined"}function forEach(e,t){if(e===null||typeof e==="undefined"){return}if(typeof e!=="object"){e=[e]}if(isArray(e)){for(var r=0,n=e.length;r<n;r++){t.call(null,e[r],r,e)}}else{for(var s in e){if(Object.prototype.hasOwnProperty.call(e,s)){t.call(null,e[s],s,e)}}}}function merge(){var e={};function assignValue(t,r){if(typeof e[r]==="object"&&typeof t==="object"){e[r]=merge(e[r],t)}else{e[r]=t}}for(var t=0,r=arguments.length;t<r;t++){forEach(arguments[t],assignValue)}return e}function deepMerge(){var e={};function assignValue(t,r){if(typeof e[r]==="object"&&typeof t==="object"){e[r]=deepMerge(e[r],t)}else if(typeof t==="object"){e[r]=deepMerge({},t)}else{e[r]=t}}for(var t=0,r=arguments.length;t<r;t++){forEach(arguments[t],assignValue)}return e}function extend(e,t,r){forEach(t,function assignValue(t,s){if(r&&typeof t==="function"){e[s]=n(t,r)}else{e[s]=t}});return e}e.exports={isArray:isArray,isArrayBuffer:isArrayBuffer,isBuffer:isBuffer,isFormData:isFormData,isArrayBufferView:isArrayBufferView,isString:isString,isNumber:isNumber,isObject:isObject,isUndefined:isUndefined,isDate:isDate,isFile:isFile,isBlob:isBlob,isFunction:isFunction,isStream:isStream,isURLSearchParams:isURLSearchParams,isStandardBrowserEnv:isStandardBrowserEnv,forEach:forEach,merge:merge,deepMerge:deepMerge,extend:extend,trim:trim}},5442:(e,t,r)=>{"use strict";var n,s,i;i=r(7823);s=r(107);n=function(){class Batcher{constructor(e={}){this.options=e;i.load(this.options,this.defaults,this);this.Events=new s(this);this._arr=[];this._resetPromise();this._lastFlush=Date.now()}_resetPromise(){return this._promise=new this.Promise((e,t)=>{return this._resolve=e})}_flush(){clearTimeout(this._timeout);this._lastFlush=Date.now();this._resolve();this.Events.trigger("batch",this._arr);this._arr=[];return this._resetPromise()}add(e){var t;this._arr.push(e);t=this._promise;if(this._arr.length===this.maxSize){this._flush()}else if(this.maxTime!=null&&this._arr.length===1){this._timeout=setTimeout(()=>{return this._flush()},this.maxTime)}return t}}Batcher.prototype.defaults={maxTime:null,maxSize:null,Promise:Promise};return Batcher}.call(void 0);e.exports=n},3911:(e,t,r)=>{"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _iterableToArrayLimit(e,t){var r=[];var n=true;var s=false;var i=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){s=true;i=e}finally{try{if(!n&&o["return"]!=null)o["return"]()}finally{if(s)throw i}}return r}function _toArray(e){return _arrayWithHoles(e)||_iterableToArray(e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var n,s,i,o,u,a,c,l,h,d,p,g=[].splice;a=10;s=5;p=r(7823);c=r(5893);o=r(5949);u=r(8979);l=r(4946);i=r(107);h=r(2527);d=r(6029);n=function(){class Bottleneck{constructor(e={},...t){var r,n;this._addToQueue=this._addToQueue.bind(this);this._validateOptions(e,t);p.load(e,this.instanceDefaults,this);this._queues=new c(a);this._scheduled={};this._states=new h(["RECEIVED","QUEUED","RUNNING","EXECUTING"].concat(this.trackDoneStatus?["DONE"]:[]));this._limiter=null;this.Events=new i(this);this._submitLock=new d("submit",this.Promise);this._registerLock=new d("register",this.Promise);n=p.load(e,this.storeDefaults,{});this._store=function(){if(this.datastore==="redis"||this.datastore==="ioredis"||this.connection!=null){r=p.load(e,this.redisStoreDefaults,{});return new l(this,n,r)}else if(this.datastore==="local"){r=p.load(e,this.localStoreDefaults,{});return new u(this,n,r)}else{throw new Bottleneck.prototype.BottleneckError(`Invalid datastore type: ${this.datastore}`)}}.call(this);this._queues.on("leftzero",()=>{var e;return(e=this._store.heartbeat)!=null?typeof e.ref==="function"?e.ref():void 0:void 0});this._queues.on("zero",()=>{var e;return(e=this._store.heartbeat)!=null?typeof e.unref==="function"?e.unref():void 0:void 0})}_validateOptions(e,t){if(!(e!=null&&typeof e==="object"&&t.length===0)){throw new Bottleneck.prototype.BottleneckError("Bottleneck v2 takes a single object argument. Refer to https://github.com/SGrondin/bottleneck#upgrading-to-v2 if you're upgrading from Bottleneck v1.")}}ready(){return this._store.ready}clients(){return this._store.clients}channel(){return`b_${this.id}`}channel_client(){return`b_${this.id}_${this._store.clientId}`}publish(e){return this._store.__publish__(e)}disconnect(e=true){return this._store.__disconnect__(e)}chain(e){this._limiter=e;return this}queued(e){return this._queues.queued(e)}clusterQueued(){return this._store.__queued__()}empty(){return this.queued()===0&&this._submitLock.isEmpty()}running(){return this._store.__running__()}done(){return this._store.__done__()}jobStatus(e){return this._states.jobStatus(e)}jobs(e){return this._states.statusJobs(e)}counts(){return this._states.statusCounts()}_randomIndex(){return Math.random().toString(36).slice(2)}check(e=1){return this._store.__check__(e)}_clearGlobalState(e){if(this._scheduled[e]!=null){clearTimeout(this._scheduled[e].expiration);delete this._scheduled[e];return true}else{return false}}_free(e,t,r,n){var s=this;return _asyncToGenerator(function*(){var t,i;try{var o=yield s._store.__free__(e,r.weight);i=o.running;s.Events.trigger("debug",`Freed ${r.id}`,n);if(i===0&&s.empty()){return s.Events.trigger("idle")}}catch(e){t=e;return s.Events.trigger("error",t)}})()}_run(e,t,r){var n,s,i;t.doRun();n=this._clearGlobalState.bind(this,e);i=this._run.bind(this,e,t);s=this._free.bind(this,e,t);return this._scheduled[e]={timeout:setTimeout(()=>{return t.doExecute(this._limiter,n,i,s)},r),expiration:t.options.expiration!=null?setTimeout(function(){return t.doExpire(n,i,s)},r+t.options.expiration):void 0,job:t}}_drainOne(e){return this._registerLock.schedule(()=>{var t,r,n,s,i;if(this.queued()===0){return this.Promise.resolve(null)}i=this._queues.getFirst();var o=n=i.first();s=o.options;t=o.args;if(e!=null&&s.weight>e){return this.Promise.resolve(null)}this.Events.trigger("debug",`Draining ${s.id}`,{args:t,options:s});r=this._randomIndex();return this._store.__register__(r,s.weight,s.expiration).then(({success:e,wait:o,reservoir:u})=>{var a;this.Events.trigger("debug",`Drained ${s.id}`,{success:e,args:t,options:s});if(e){i.shift();a=this.empty();if(a){this.Events.trigger("empty")}if(u===0){this.Events.trigger("depleted",a)}this._run(r,n,o);return this.Promise.resolve(s.weight)}else{return this.Promise.resolve(null)}})})}_drainAll(e,t=0){return this._drainOne(e).then(r=>{var n;if(r!=null){n=e!=null?e-r:e;return this._drainAll(n,t+r)}else{return this.Promise.resolve(t)}}).catch(e=>{return this.Events.trigger("error",e)})}_dropAllQueued(e){return this._queues.shiftAll(function(t){return t.doDrop({message:e})})}stop(e={}){var t,r;e=p.load(e,this.stopDefaults);r=(e=>{var t;t=(()=>{var t;t=this._states.counts;return t[0]+t[1]+t[2]+t[3]===e});return new this.Promise((e,r)=>{if(t()){return e()}else{return this.on("done",()=>{if(t()){this.removeAllListeners("done");return e()}})}})});t=e.dropWaitingJobs?(this._run=function(t,r){return r.doDrop({message:e.dropErrorMessage})},this._drainOne=(()=>{return this.Promise.resolve(null)}),this._registerLock.schedule(()=>{return this._submitLock.schedule(()=>{var t,n,s;n=this._scheduled;for(t in n){s=n[t];if(this.jobStatus(s.job.options.id)==="RUNNING"){clearTimeout(s.timeout);clearTimeout(s.expiration);s.job.doDrop({message:e.dropErrorMessage})}}this._dropAllQueued(e.dropErrorMessage);return r(0)})})):this.schedule({priority:a-1,weight:0},()=>{return r(1)});this._receive=function(t){return t._reject(new Bottleneck.prototype.BottleneckError(e.enqueueErrorMessage))};this.stop=(()=>{return this.Promise.reject(new Bottleneck.prototype.BottleneckError("stop() has already been called"))});return t}_addToQueue(e){var t=this;return _asyncToGenerator(function*(){var r,n,s,i,o,u,a;r=e.args;i=e.options;try{var c=yield t._store.__submit__(t.queued(),i.weight);o=c.reachedHWM;n=c.blocked;a=c.strategy}catch(n){s=n;t.Events.trigger("debug",`Could not queue ${i.id}`,{args:r,options:i,error:s});e.doDrop({error:s});return false}if(n){e.doDrop();return true}else if(o){u=a===Bottleneck.prototype.strategy.LEAK?t._queues.shiftLastFrom(i.priority):a===Bottleneck.prototype.strategy.OVERFLOW_PRIORITY?t._queues.shiftLastFrom(i.priority+1):a===Bottleneck.prototype.strategy.OVERFLOW?e:void 0;if(u!=null){u.doDrop()}if(u==null||a===Bottleneck.prototype.strategy.OVERFLOW){if(u==null){e.doDrop()}return o}}e.doQueue(o,n);t._queues.push(e);yield t._drainAll();return o})()}_receive(e){if(this._states.jobStatus(e.options.id)!=null){e._reject(new Bottleneck.prototype.BottleneckError(`A job with the same id already exists (id=${e.options.id})`));return false}else{e.doReceive();return this._submitLock.schedule(this._addToQueue,e)}}submit(...e){var t,r,n,s,i,u,a;if(typeof e[0]==="function"){var c,l,h,d;i=e,c=i,l=_toArray(c),r=l[0],e=l.slice(1),c,h=g.call(e,-1),d=_slicedToArray(h,1),t=d[0],h;s=p.load({},this.jobDefaults)}else{var f,m,_,y;u=e,f=u,m=_toArray(f),s=m[0],r=m[1],e=m.slice(2),f,_=g.call(e,-1),y=_slicedToArray(_,1),t=y[0],_;s=p.load(s,this.jobDefaults)}a=((...e)=>{return new this.Promise(function(t,n){return r(...e,function(...e){return(e[0]!=null?n:t)(e)})})});n=new o(a,e,s,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise);n.promise.then(function(e){return typeof t==="function"?t(...e):void 0}).catch(function(e){if(Array.isArray(e)){return typeof t==="function"?t(...e):void 0}else{return typeof t==="function"?t(e):void 0}});return this._receive(n)}schedule(...e){var t,r,n;if(typeof e[0]==="function"){var s=e;var i=_toArray(s);n=i[0];e=i.slice(1);r={}}else{var u=e;var a=_toArray(u);r=a[0];n=a[1];e=a.slice(2)}t=new o(n,e,r,this.jobDefaults,this.rejectOnDrop,this.Events,this._states,this.Promise);this._receive(t);return t.promise}wrap(e){var t,r;t=this.schedule.bind(this);r=function wrapped(...r){return t(e.bind(this),...r)};r.withOptions=function(r,...n){return t(r,e,...n)};return r}updateSettings(e={}){var t=this;return _asyncToGenerator(function*(){yield t._store.__updateSettings__(p.overwrite(e,t.storeDefaults));p.overwrite(e,t.instanceDefaults,t);return t})()}currentReservoir(){return this._store.__currentReservoir__()}incrementReservoir(e=0){return this._store.__incrementReservoir__(e)}}Bottleneck.default=Bottleneck;Bottleneck.Events=i;Bottleneck.version=Bottleneck.prototype.version=r(8372).i;Bottleneck.strategy=Bottleneck.prototype.strategy={LEAK:1,OVERFLOW:2,OVERFLOW_PRIORITY:4,BLOCK:3};Bottleneck.BottleneckError=Bottleneck.prototype.BottleneckError=r(3529);Bottleneck.Group=Bottleneck.prototype.Group=r(3068);Bottleneck.RedisConnection=Bottleneck.prototype.RedisConnection=r(9992);Bottleneck.IORedisConnection=Bottleneck.prototype.IORedisConnection=r(7710);Bottleneck.Batcher=Bottleneck.prototype.Batcher=r(5442);Bottleneck.prototype.jobDefaults={priority:s,weight:1,expiration:null,id:"<no-id>"};Bottleneck.prototype.storeDefaults={maxConcurrent:null,minTime:0,highWater:null,strategy:Bottleneck.prototype.strategy.LEAK,penalty:null,reservoir:null,reservoirRefreshInterval:null,reservoirRefreshAmount:null,reservoirIncreaseInterval:null,reservoirIncreaseAmount:null,reservoirIncreaseMaximum:null};Bottleneck.prototype.localStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:250};Bottleneck.prototype.redisStoreDefaults={Promise:Promise,timeout:null,heartbeatInterval:5e3,clientTimeout:1e4,Redis:null,clientOptions:{},clusterNodes:null,clearDatastore:false,connection:null};Bottleneck.prototype.instanceDefaults={datastore:"local",connection:null,id:"<no-id>",rejectOnDrop:true,trackDoneStatus:false,Promise:Promise};Bottleneck.prototype.stopDefaults={enqueueErrorMessage:"This limiter has been stopped and cannot accept new jobs.",dropWaitingJobs:true,dropErrorMessage:"This limiter has been stopped."};return Bottleneck}.call(void 0);e.exports=n},3529:e=>{"use strict";var t;t=class BottleneckError extends Error{};e.exports=t},8579:e=>{"use strict";var t;t=class DLList{constructor(e,t){this.incr=e;this.decr=t;this._first=null;this._last=null;this.length=0}push(e){var t;this.length++;if(typeof this.incr==="function"){this.incr()}t={value:e,prev:this._last,next:null};if(this._last!=null){this._last.next=t;this._last=t}else{this._first=this._last=t}return void 0}shift(){var e;if(this._first==null){return}else{this.length--;if(typeof this.decr==="function"){this.decr()}}e=this._first.value;if((this._first=this._first.next)!=null){this._first.prev=null}else{this._last=null}return e}first(){if(this._first!=null){return this._first.value}}getArray(){var e,t,r;e=this._first;r=[];while(e!=null){r.push((t=e,e=e.next,t.value))}return r}forEachShift(e){var t;t=this.shift();while(t!=null){e(t),t=this.shift()}return void 0}debug(){var e,t,r,n,s;e=this._first;s=[];while(e!=null){s.push((t=e,e=e.next,{value:t.value,prev:(r=t.prev)!=null?r.value:void 0,next:(n=t.next)!=null?n.value:void 0}))}return s}};e.exports=t},107:e=>{"use strict";function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var t;t=class Events{constructor(e){this.instance=e;this._events={};if(this.instance.on!=null||this.instance.once!=null||this.instance.removeAllListeners!=null){throw new Error("An Emitter already exists for this object")}this.instance.on=((e,t)=>{return this._addListener(e,"many",t)});this.instance.once=((e,t)=>{return this._addListener(e,"once",t)});this.instance.removeAllListeners=((e=null)=>{if(e!=null){return delete this._events[e]}else{return this._events={}}})}_addListener(e,t,r){var n;if((n=this._events)[e]==null){n[e]=[]}this._events[e].push({cb:r,status:t});return this.instance}listenerCount(e){if(this._events[e]!=null){return this._events[e].length}else{return 0}}trigger(e,...t){var r=this;return _asyncToGenerator(function*(){var n,s;try{if(e!=="debug"){r.trigger("debug",`Event triggered: ${e}`,t)}if(r._events[e]==null){return}r._events[e]=r._events[e].filter(function(e){return e.status!=="none"});s=r._events[e].map(function(){var e=_asyncToGenerator(function*(e){var n,s;if(e.status==="none"){return}if(e.status==="once"){e.status="none"}try{s=typeof e.cb==="function"?e.cb(...t):void 0;if(typeof(s!=null?s.then:void 0)==="function"){return yield s}else{return s}}catch(e){n=e;if(true){r.trigger("error",n)}return null}});return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(s)).find(function(e){return e!=null})}catch(e){n=e;if(true){r.trigger("error",n)}return null}})()}};e.exports=t},3068:(e,t,r)=>{"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[];var n=true;var s=false;var i=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){s=true;i=e}finally{try{if(!n&&o["return"]!=null)o["return"]()}finally{if(s)throw i}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var n,s,i,o,u,a;a=r(7823);n=r(107);o=r(9992);i=r(7710);u=r(4169);s=function(){class Group{constructor(e={}){this.deleteKey=this.deleteKey.bind(this);this.limiterOptions=e;a.load(this.limiterOptions,this.defaults,this);this.Events=new n(this);this.instances={};this.Bottleneck=r(3911);this._startAutoCleanup();this.sharedConnection=this.connection!=null;if(this.connection==null){if(this.limiterOptions.datastore==="redis"){this.connection=new o(Object.assign({},this.limiterOptions,{Events:this.Events}))}else if(this.limiterOptions.datastore==="ioredis"){this.connection=new i(Object.assign({},this.limiterOptions,{Events:this.Events}))}}}key(e=""){var t;return(t=this.instances[e])!=null?t:(()=>{var t;t=this.instances[e]=new this.Bottleneck(Object.assign(this.limiterOptions,{id:`${this.id}-${e}`,timeout:this.timeout,connection:this.connection}));this.Events.trigger("created",t,e);return t})()}deleteKey(e=""){var t=this;return _asyncToGenerator(function*(){var r,n;n=t.instances[e];if(t.connection){r=yield t.connection.__runCommand__(["del",...u.allKeys(`${t.id}-${e}`)])}if(n!=null){delete t.instances[e];yield n.disconnect()}return n!=null||r>0})()}limiters(){var e,t,r,n;t=this.instances;r=[];for(e in t){n=t[e];r.push({key:e,limiter:n})}return r}keys(){return Object.keys(this.instances)}clusterKeys(){var e=this;return _asyncToGenerator(function*(){var t,r,n,s,i,o,u,a,c;if(e.connection==null){return e.Promise.resolve(e.keys())}o=[];t=null;c=`b_${e.id}-`.length;r="_settings".length;while(t!==0){var l=yield e.connection.__runCommand__(["scan",t!=null?t:0,"match",`b_${e.id}-*_settings`,"count",1e4]);var h=_slicedToArray(l,2);a=h[0];n=h[1];t=~~a;for(s=0,u=n.length;s<u;s++){i=n[s];o.push(i.slice(c,-r))}}return o})()}_startAutoCleanup(){var e=this;var t;clearInterval(this.interval);return typeof(t=this.interval=setInterval(_asyncToGenerator(function*(){var t,r,n,s,i,o;i=Date.now();n=e.instances;s=[];for(r in n){o=n[r];try{if(yield o._store.__groupCheck__(i)){s.push(e.deleteKey(r))}else{s.push(void 0)}}catch(e){t=e;s.push(o.Events.trigger("error",t))}}return s}),this.timeout/2)).unref==="function"?t.unref():void 0}updateSettings(e={}){a.overwrite(e,this.defaults,this);a.overwrite(e,e,this.limiterOptions);if(e.timeout!=null){return this._startAutoCleanup()}}disconnect(e=true){var t;if(!this.sharedConnection){return(t=this.connection)!=null?t.disconnect(e):void 0}}}Group.prototype.defaults={timeout:1e3*60*5,connection:null,Promise:Promise,id:"group-key"};return Group}.call(void 0);e.exports=s},7710:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[];var n=true;var s=false;var i=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){s=true;i=e}finally{try{if(!n&&o["return"]!=null)o["return"]()}finally{if(s)throw i}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var Events,IORedisConnection,Scripts,parser;parser=__webpack_require__(7823);Events=__webpack_require__(107);Scripts=__webpack_require__(4169);IORedisConnection=function(){class IORedisConnection{constructor(options={}){parser.load(options,this.defaults,this);if(this.Redis==null){this.Redis=eval("require")("ioredis")}if(this.Events==null){this.Events=new Events(this)}this.terminated=false;if(this.clusterNodes!=null){this.client=new this.Redis.Cluster(this.clusterNodes,this.clientOptions);this.subscriber=new this.Redis.Cluster(this.clusterNodes,this.clientOptions)}else if(this.client!=null&&this.client.duplicate==null){this.subscriber=new this.Redis.Cluster(this.client.startupNodes,this.client.options)}else{if(this.client==null){this.client=new this.Redis(this.clientOptions)}this.subscriber=this.client.duplicate()}this.limiters={};this.ready=this.Promise.all([this._setup(this.client,false),this._setup(this.subscriber,true)]).then(()=>{this._loadScripts();return{client:this.client,subscriber:this.subscriber}})}_setup(e,t){e.setMaxListeners(0);return new this.Promise((r,n)=>{e.on("error",e=>{return this.Events.trigger("error",e)});if(t){e.on("message",(e,t)=>{var r;return(r=this.limiters[e])!=null?r._store.onMessage(e,t):void 0})}if(e.status==="ready"){return r()}else{return e.once("ready",r)}})}_loadScripts(){return Scripts.names.forEach(e=>{return this.client.defineCommand(e,{lua:Scripts.payload(e)})})}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){var r,n;yield t.ready;var s=yield t.client.pipeline([e]).exec();var i=_slicedToArray(s,1);var o=_slicedToArray(i[0],2);r=o[0];n=o[1];return n})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>{return new this.Promise((r,n)=>{return this.subscriber.subscribe(t,()=>{this.limiters[t]=e;return r()})})}))}__removeLimiter__(e){var t=this;return[e.channel(),e.channel_client()].forEach(function(){var e=_asyncToGenerator(function*(e){if(!t.terminated){yield t.subscriber.unsubscribe(e)}return delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}())}__scriptArgs__(e,t,r,n){var s;s=Scripts.keys(e,t);return[s.length].concat(s,r,n)}__scriptFn__(e){return this.client[e].bind(this.client)}disconnect(e=true){var t,r,n,s;s=Object.keys(this.limiters);for(t=0,n=s.length;t<n;t++){r=s[t];clearInterval(this.limiters[r]._store.heartbeat)}this.limiters={};this.terminated=true;if(e){return this.Promise.all([this.client.quit(),this.subscriber.quit()])}else{this.client.disconnect();this.subscriber.disconnect();return this.Promise.resolve()}}}IORedisConnection.prototype.datastore="ioredis";IORedisConnection.prototype.defaults={Redis:null,clientOptions:{},clusterNodes:null,client:null,Promise:Promise,Events:null};return IORedisConnection}.call(void 0);module.exports=IORedisConnection},5949:(e,t,r)=>{"use strict";function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var n,s,i,o,u;o=10;s=5;u=r(7823);n=r(3529);i=class Job{constructor(e,t,r,n,s,i,o,a){this.task=e;this.args=t;this.rejectOnDrop=s;this.Events=i;this._states=o;this.Promise=a;this.options=u.load(r,n);this.options.priority=this._sanitizePriority(this.options.priority);if(this.options.id===n.id){this.options.id=`${this.options.id}-${this._randomIndex()}`}this.promise=new this.Promise((e,t)=>{this._resolve=e;this._reject=t});this.retryCount=0}_sanitizePriority(e){var t;t=~~e!==e?s:e;if(t<0){return 0}else if(t>o-1){return o-1}else{return t}}_randomIndex(){return Math.random().toString(36).slice(2)}doDrop({error:e,message:t="This job has been dropped by Bottleneck"}={}){if(this._states.remove(this.options.id)){if(this.rejectOnDrop){this._reject(e!=null?e:new n(t))}this.Events.trigger("dropped",{args:this.args,options:this.options,task:this.task,promise:this.promise});return true}else{return false}}_assertStatus(e){var t;t=this._states.jobStatus(this.options.id);if(!(t===e||e==="DONE"&&t===null)){throw new n(`Invalid job status ${t}, expected ${e}. Please open an issue at https://github.com/SGrondin/bottleneck/issues`)}}doReceive(){this._states.start(this.options.id);return this.Events.trigger("received",{args:this.args,options:this.options})}doQueue(e,t){this._assertStatus("RECEIVED");this._states.next(this.options.id);return this.Events.trigger("queued",{args:this.args,options:this.options,reachedHWM:e,blocked:t})}doRun(){if(this.retryCount===0){this._assertStatus("QUEUED");this._states.next(this.options.id)}else{this._assertStatus("EXECUTING")}return this.Events.trigger("scheduled",{args:this.args,options:this.options})}doExecute(e,t,r,n){var s=this;return _asyncToGenerator(function*(){var i,o,u;if(s.retryCount===0){s._assertStatus("RUNNING");s._states.next(s.options.id)}else{s._assertStatus("EXECUTING")}o={args:s.args,options:s.options,retryCount:s.retryCount};s.Events.trigger("executing",o);try{u=yield e!=null?e.schedule(s.options,s.task,...s.args):s.task(...s.args);if(t()){s.doDone(o);yield n(s.options,o);s._assertStatus("DONE");return s._resolve(u)}}catch(e){i=e;return s._onFailure(i,o,t,r,n)}})()}doExpire(e,t,r){var s,i;if(this._states.jobStatus(this.options.id==="RUNNING")){this._states.next(this.options.id)}this._assertStatus("EXECUTING");i={args:this.args,options:this.options,retryCount:this.retryCount};s=new n(`This job timed out after ${this.options.expiration} ms.`);return this._onFailure(s,i,e,t,r)}_onFailure(e,t,r,n,s){var i=this;return _asyncToGenerator(function*(){var o,u;if(r()){o=yield i.Events.trigger("failed",e,t);if(o!=null){u=~~o;i.Events.trigger("retry",`Retrying ${i.options.id} after ${u} ms`,t);i.retryCount++;return n(u)}else{i.doDone(t);yield s(i.options,t);i._assertStatus("DONE");return i._reject(e)}}})()}doDone(e){this._assertStatus("EXECUTING");this._states.next(this.options.id);return this.Events.trigger("done",e)}};e.exports=i},8979:(e,t,r)=>{"use strict";function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var n,s,i;i=r(7823);n=r(3529);s=class LocalDatastore{constructor(e,t,r){this.instance=e;this.storeOptions=t;this.clientId=this.instance._randomIndex();i.load(r,r,this);this._nextRequest=this._lastReservoirRefresh=this._lastReservoirIncrease=Date.now();this._running=0;this._done=0;this._unblockTime=0;this.ready=this.Promise.resolve();this.clients={};this._startHeartbeat()}_startHeartbeat(){var e;if(this.heartbeat==null&&(this.storeOptions.reservoirRefreshInterval!=null&&this.storeOptions.reservoirRefreshAmount!=null||this.storeOptions.reservoirIncreaseInterval!=null&&this.storeOptions.reservoirIncreaseAmount!=null)){return typeof(e=this.heartbeat=setInterval(()=>{var e,t,r,n,s;n=Date.now();if(this.storeOptions.reservoirRefreshInterval!=null&&n>=this._lastReservoirRefresh+this.storeOptions.reservoirRefreshInterval){this._lastReservoirRefresh=n;this.storeOptions.reservoir=this.storeOptions.reservoirRefreshAmount;this.instance._drainAll(this.computeCapacity())}if(this.storeOptions.reservoirIncreaseInterval!=null&&n>=this._lastReservoirIncrease+this.storeOptions.reservoirIncreaseInterval){var i=this.storeOptions;e=i.reservoirIncreaseAmount;r=i.reservoirIncreaseMaximum;s=i.reservoir;this._lastReservoirIncrease=n;t=r!=null?Math.min(e,r-s):e;if(t>0){this.storeOptions.reservoir+=t;return this.instance._drainAll(this.computeCapacity())}}},this.heartbeatInterval)).unref==="function"?e.unref():void 0}else{return clearInterval(this.heartbeat)}}__publish__(e){var t=this;return _asyncToGenerator(function*(){yield t.yieldLoop();return t.instance.Events.trigger("message",e.toString())})()}__disconnect__(e){var t=this;return _asyncToGenerator(function*(){yield t.yieldLoop();clearInterval(t.heartbeat);return t.Promise.resolve()})()}yieldLoop(e=0){return new this.Promise(function(t,r){return setTimeout(t,e)})}computePenalty(){var e;return(e=this.storeOptions.penalty)!=null?e:15*this.storeOptions.minTime||5e3}__updateSettings__(e){var t=this;return _asyncToGenerator(function*(){yield t.yieldLoop();i.overwrite(e,e,t.storeOptions);t._startHeartbeat();t.instance._drainAll(t.computeCapacity());return true})()}__running__(){var e=this;return _asyncToGenerator(function*(){yield e.yieldLoop();return e._running})()}__queued__(){var e=this;return _asyncToGenerator(function*(){yield e.yieldLoop();return e.instance.queued()})()}__done__(){var e=this;return _asyncToGenerator(function*(){yield e.yieldLoop();return e._done})()}__groupCheck__(e){var t=this;return _asyncToGenerator(function*(){yield t.yieldLoop();return t._nextRequest+t.timeout<e})()}computeCapacity(){var e,t;var r=this.storeOptions;e=r.maxConcurrent;t=r.reservoir;if(e!=null&&t!=null){return Math.min(e-this._running,t)}else if(e!=null){return e-this._running}else if(t!=null){return t}else{return null}}conditionsCheck(e){var t;t=this.computeCapacity();return t==null||e<=t}__incrementReservoir__(e){var t=this;return _asyncToGenerator(function*(){var r;yield t.yieldLoop();r=t.storeOptions.reservoir+=e;t.instance._drainAll(t.computeCapacity());return r})()}__currentReservoir__(){var e=this;return _asyncToGenerator(function*(){yield e.yieldLoop();return e.storeOptions.reservoir})()}isBlocked(e){return this._unblockTime>=e}check(e,t){return this.conditionsCheck(e)&&this._nextRequest-t<=0}__check__(e){var t=this;return _asyncToGenerator(function*(){var r;yield t.yieldLoop();r=Date.now();return t.check(e,r)})()}__register__(e,t,r){var n=this;return _asyncToGenerator(function*(){var e,r;yield n.yieldLoop();e=Date.now();if(n.conditionsCheck(t)){n._running+=t;if(n.storeOptions.reservoir!=null){n.storeOptions.reservoir-=t}r=Math.max(n._nextRequest-e,0);n._nextRequest=e+r+n.storeOptions.minTime;return{success:true,wait:r,reservoir:n.storeOptions.reservoir}}else{return{success:false}}})()}strategyIsBlock(){return this.storeOptions.strategy===3}__submit__(e,t){var r=this;return _asyncToGenerator(function*(){var s,i,o;yield r.yieldLoop();if(r.storeOptions.maxConcurrent!=null&&t>r.storeOptions.maxConcurrent){throw new n(`Impossible to add a job having a weight of ${t} to a limiter having a maxConcurrent setting of ${r.storeOptions.maxConcurrent}`)}i=Date.now();o=r.storeOptions.highWater!=null&&e===r.storeOptions.highWater&&!r.check(t,i);s=r.strategyIsBlock()&&(o||r.isBlocked(i));if(s){r._unblockTime=i+r.computePenalty();r._nextRequest=r._unblockTime+r.storeOptions.minTime;r.instance._dropAllQueued()}return{reachedHWM:o,blocked:s,strategy:r.storeOptions.strategy}})()}__free__(e,t){var r=this;return _asyncToGenerator(function*(){yield r.yieldLoop();r._running-=t;r._done+=t;r.instance._drainAll(r.computeCapacity());return{running:r._running}})()}};e.exports=s},5893:(e,t,r)=>{"use strict";var n,s,i;n=r(8579);s=r(107);i=class Queues{constructor(e){var t;this.Events=new s(this);this._length=0;this._lists=function(){var r,s,i;i=[];for(t=r=1,s=e;1<=s?r<=s:r>=s;t=1<=s?++r:--r){i.push(new n(()=>{return this.incr()},()=>{return this.decr()}))}return i}.call(this)}incr(){if(this._length++===0){return this.Events.trigger("leftzero")}}decr(){if(--this._length===0){return this.Events.trigger("zero")}}push(e){return this._lists[e.options.priority].push(e)}queued(e){if(e!=null){return this._lists[e].length}else{return this._length}}shiftAll(e){return this._lists.forEach(function(t){return t.forEachShift(e)})}getFirst(e=this._lists){var t,r,n;for(t=0,r=e.length;t<r;t++){n=e[t];if(n.length>0){return n}}return[]}shiftLastFrom(e){return this.getFirst(this._lists.slice(e).reverse()).shift()}};e.exports=i},9992:(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var Events,RedisConnection,Scripts,parser;parser=__webpack_require__(7823);Events=__webpack_require__(107);Scripts=__webpack_require__(4169);RedisConnection=function(){class RedisConnection{constructor(options={}){parser.load(options,this.defaults,this);if(this.Redis==null){this.Redis=eval("require")("redis")}if(this.Events==null){this.Events=new Events(this)}this.terminated=false;if(this.client==null){this.client=this.Redis.createClient(this.clientOptions)}this.subscriber=this.client.duplicate();this.limiters={};this.shas={};this.ready=this.Promise.all([this._setup(this.client,false),this._setup(this.subscriber,true)]).then(()=>{return this._loadScripts()}).then(()=>{return{client:this.client,subscriber:this.subscriber}})}_setup(e,t){e.setMaxListeners(0);return new this.Promise((r,n)=>{e.on("error",e=>{return this.Events.trigger("error",e)});if(t){e.on("message",(e,t)=>{var r;return(r=this.limiters[e])!=null?r._store.onMessage(e,t):void 0})}if(e.ready){return r()}else{return e.once("ready",r)}})}_loadScript(e){return new this.Promise((t,r)=>{var n;n=Scripts.payload(e);return this.client.multi([["script","load",n]]).exec((n,s)=>{if(n!=null){return r(n)}this.shas[e]=s[0];return t(s[0])})})}_loadScripts(){return this.Promise.all(Scripts.names.map(e=>{return this._loadScript(e)}))}__runCommand__(e){var t=this;return _asyncToGenerator(function*(){yield t.ready;return new t.Promise((r,n)=>{return t.client.multi([e]).exec_atomic(function(e,t){if(e!=null){return n(e)}else{return r(t[0])}})})})()}__addLimiter__(e){return this.Promise.all([e.channel(),e.channel_client()].map(t=>{return new this.Promise((r,n)=>{var s;s=(n=>{if(n===t){this.subscriber.removeListener("subscribe",s);this.limiters[t]=e;return r()}});this.subscriber.on("subscribe",s);return this.subscriber.subscribe(t)})}))}__removeLimiter__(e){var t=this;return this.Promise.all([e.channel(),e.channel_client()].map(function(){var e=_asyncToGenerator(function*(e){if(!t.terminated){yield new t.Promise((r,n)=>{return t.subscriber.unsubscribe(e,function(t,s){if(t!=null){return n(t)}if(s===e){return r()}})})}return delete t.limiters[e]});return function(t){return e.apply(this,arguments)}}()))}__scriptArgs__(e,t,r,n){var s;s=Scripts.keys(e,t);return[this.shas[e],s.length].concat(s,r,n)}__scriptFn__(e){return this.client.evalsha.bind(this.client)}disconnect(e=true){var t,r,n,s;s=Object.keys(this.limiters);for(t=0,n=s.length;t<n;t++){r=s[t];clearInterval(this.limiters[r]._store.heartbeat)}this.limiters={};this.terminated=true;this.client.end(e);this.subscriber.end(e);return this.Promise.resolve()}}RedisConnection.prototype.datastore="redis";RedisConnection.prototype.defaults={Redis:null,clientOptions:{},client:null,Promise:Promise,Events:null};return RedisConnection}.call(void 0);module.exports=RedisConnection},4946:(e,t,r)=>{"use strict";function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function _iterableToArrayLimit(e,t){var r=[];var n=true;var s=false;var i=undefined;try{for(var o=e[Symbol.iterator](),u;!(n=(u=o.next()).done);n=true){r.push(u.value);if(t&&r.length===t)break}}catch(e){s=true;i=e}finally{try{if(!n&&o["return"]!=null)o["return"]()}finally{if(s)throw i}}return r}function _arrayWithHoles(e){if(Array.isArray(e))return e}function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var n,s,i,o,u;u=r(7823);n=r(3529);i=r(9992);s=r(7710);o=class RedisDatastore{constructor(e,t,r){this.instance=e;this.storeOptions=t;this.originalId=this.instance.id;this.clientId=this.instance._randomIndex();u.load(r,r,this);this.clients={};this.capacityPriorityCounters={};this.sharedConnection=this.connection!=null;if(this.connection==null){this.connection=this.instance.datastore==="redis"?new i({Redis:this.Redis,clientOptions:this.clientOptions,Promise:this.Promise,Events:this.instance.Events}):this.instance.datastore==="ioredis"?new s({Redis:this.Redis,clientOptions:this.clientOptions,clusterNodes:this.clusterNodes,Promise:this.Promise,Events:this.instance.Events}):void 0}this.instance.connection=this.connection;this.instance.datastore=this.connection.datastore;this.ready=this.connection.ready.then(e=>{this.clients=e;return this.runScript("init",this.prepareInitSettings(this.clearDatastore))}).then(()=>{return this.connection.__addLimiter__(this.instance)}).then(()=>{return this.runScript("register_client",[this.instance.queued()])}).then(()=>{var e;if(typeof(e=this.heartbeat=setInterval(()=>{return this.runScript("heartbeat",[]).catch(e=>{return this.instance.Events.trigger("error",e)})},this.heartbeatInterval)).unref==="function"){e.unref()}return this.clients})}__publish__(e){var t=this;return _asyncToGenerator(function*(){var r;var n=yield t.ready;r=n.client;return r.publish(t.instance.channel(),`message:${e.toString()}`)})()}onMessage(e,t){var r=this;return _asyncToGenerator(function*(){var e,n,s,i,o,u,a,c,l,h;try{a=t.indexOf(":");var d=[t.slice(0,a),t.slice(a+1)];h=d[0];s=d[1];if(h==="capacity"){return yield r.instance._drainAll(s.length>0?~~s:void 0)}else if(h==="capacity-priority"){var p=s.split(":");var g=_slicedToArray(p,3);l=g[0];c=g[1];n=g[2];e=l.length>0?~~l:void 0;if(c===r.clientId){i=yield r.instance._drainAll(e);u=e!=null?e-(i||0):"";return yield r.clients.client.publish(r.instance.channel(),`capacity-priority:${u}::${n}`)}else if(c===""){clearTimeout(r.capacityPriorityCounters[n]);delete r.capacityPriorityCounters[n];return r.instance._drainAll(e)}else{return r.capacityPriorityCounters[n]=setTimeout(_asyncToGenerator(function*(){var t;try{delete r.capacityPriorityCounters[n];yield r.runScript("blacklist_client",[c]);return yield r.instance._drainAll(e)}catch(e){t=e;return r.instance.Events.trigger("error",t)}}),1e3)}}else if(h==="message"){return r.instance.Events.trigger("message",s)}else if(h==="blocked"){return yield r.instance._dropAllQueued()}}catch(e){o=e;return r.instance.Events.trigger("error",o)}})()}__disconnect__(e){clearInterval(this.heartbeat);if(this.sharedConnection){return this.connection.__removeLimiter__(this.instance)}else{return this.connection.disconnect(e)}}runScript(e,t){var r=this;return _asyncToGenerator(function*(){if(!(e==="init"||e==="register_client")){yield r.ready}return new r.Promise((n,s)=>{var i,o;i=[Date.now(),r.clientId].concat(t);r.instance.Events.trigger("debug",`Calling Redis script: ${e}.lua`,i);o=r.connection.__scriptArgs__(e,r.originalId,i,function(e,t){if(e!=null){return s(e)}return n(t)});return r.connection.__scriptFn__(e)(...o)}).catch(n=>{if(n.message==="SETTINGS_KEY_NOT_FOUND"){if(e==="heartbeat"){return r.Promise.resolve()}else{return r.runScript("init",r.prepareInitSettings(false)).then(()=>{return r.runScript(e,t)})}}else if(n.message==="UNKNOWN_CLIENT"){return r.runScript("register_client",[r.instance.queued()]).then(()=>{return r.runScript(e,t)})}else{return r.Promise.reject(n)}})})()}prepareArray(e){var t,r,n,s;n=[];for(t=0,r=e.length;t<r;t++){s=e[t];n.push(s!=null?s.toString():"")}return n}prepareObject(e){var t,r,n;t=[];for(r in e){n=e[r];t.push(r,n!=null?n.toString():"")}return t}prepareInitSettings(e){var t;t=this.prepareObject(Object.assign({},this.storeOptions,{id:this.originalId,version:this.instance.version,groupTimeout:this.timeout,clientTimeout:this.clientTimeout}));t.unshift(e?1:0,this.instance.version);return t}convertBool(e){return!!e}__updateSettings__(e){var t=this;return _asyncToGenerator(function*(){yield t.runScript("update_settings",t.prepareObject(e));return u.overwrite(e,e,t.storeOptions)})()}__running__(){return this.runScript("running",[])}__queued__(){return this.runScript("queued",[])}__done__(){return this.runScript("done",[])}__groupCheck__(){var e=this;return _asyncToGenerator(function*(){return e.convertBool(yield e.runScript("group_check",[]))})()}__incrementReservoir__(e){return this.runScript("increment_reservoir",[e])}__currentReservoir__(){return this.runScript("current_reservoir",[])}__check__(e){var t=this;return _asyncToGenerator(function*(){return t.convertBool(yield t.runScript("check",t.prepareArray([e])))})()}__register__(e,t,r){var n=this;return _asyncToGenerator(function*(){var s,i,o;var u=yield n.runScript("register",n.prepareArray([e,t,r]));var a=_slicedToArray(u,3);i=a[0];o=a[1];s=a[2];return{success:n.convertBool(i),wait:o,reservoir:s}})()}__submit__(e,t){var r=this;return _asyncToGenerator(function*(){var s,i,o,u,a,c;try{var l=yield r.runScript("submit",r.prepareArray([e,t]));var h=_slicedToArray(l,3);a=h[0];s=h[1];c=h[2];return{reachedHWM:r.convertBool(a),blocked:r.convertBool(s),strategy:c}}catch(e){i=e;if(i.message.indexOf("OVERWEIGHT")===0){var d=i.message.split(":");var p=_slicedToArray(d,3);u=p[0];t=p[1];o=p[2];throw new n(`Impossible to add a job having a weight of ${t} to a limiter having a maxConcurrent setting of ${o}`)}else{throw i}}})()}__free__(e,t){var r=this;return _asyncToGenerator(function*(){var t;t=yield r.runScript("free",r.prepareArray([e]));return{running:t}})()}};e.exports=o},4169:(e,t,r)=>{"use strict";var n,s,i;s=r(3122);n={refs:s["refs.lua"],validate_keys:s["validate_keys.lua"],validate_client:s["validate_client.lua"],refresh_expiration:s["refresh_expiration.lua"],process_tick:s["process_tick.lua"],conditions_check:s["conditions_check.lua"],get_time:s["get_time.lua"]};t.allKeys=function(e){return[`b_${e}_settings`,`b_${e}_job_weights`,`b_${e}_job_expirations`,`b_${e}_job_clients`,`b_${e}_client_running`,`b_${e}_client_num_queued`,`b_${e}_client_last_registered`,`b_${e}_client_last_seen`]};i={init:{keys:t.allKeys,headers:["process_tick"],refresh_expiration:true,code:s["init.lua"]},group_check:{keys:t.allKeys,headers:[],refresh_expiration:false,code:s["group_check.lua"]},register_client:{keys:t.allKeys,headers:["validate_keys"],refresh_expiration:false,code:s["register_client.lua"]},blacklist_client:{keys:t.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:false,code:s["blacklist_client.lua"]},heartbeat:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:false,code:s["heartbeat.lua"]},update_settings:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:true,code:s["update_settings.lua"]},running:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:false,code:s["running.lua"]},queued:{keys:t.allKeys,headers:["validate_keys","validate_client"],refresh_expiration:false,code:s["queued.lua"]},done:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:false,code:s["done.lua"]},check:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:false,code:s["check.lua"]},submit:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:true,code:s["submit.lua"]},register:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick","conditions_check"],refresh_expiration:true,code:s["register.lua"]},free:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:true,code:s["free.lua"]},current_reservoir:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:false,code:s["current_reservoir.lua"]},increment_reservoir:{keys:t.allKeys,headers:["validate_keys","validate_client","process_tick"],refresh_expiration:true,code:s["increment_reservoir.lua"]}};t.names=Object.keys(i);t.keys=function(e,t){return i[e].keys(t)};t.payload=function(e){var t;t=i[e];return Array.prototype.concat(n.refs,t.headers.map(function(e){return n[e]}),t.refresh_expiration?n.refresh_expiration:"",t.code).join("\n")}},2527:(e,t,r)=>{"use strict";var n,s;n=r(3529);s=class States{constructor(e){this.status=e;this._jobs={};this.counts=this.status.map(function(){return 0})}next(e){var t,r;t=this._jobs[e];r=t+1;if(t!=null&&r<this.status.length){this.counts[t]--;this.counts[r]++;return this._jobs[e]++}else if(t!=null){this.counts[t]--;return delete this._jobs[e]}}start(e){var t;t=0;this._jobs[e]=t;return this.counts[t]++}remove(e){var t;t=this._jobs[e];if(t!=null){this.counts[t]--;delete this._jobs[e]}return t!=null}jobStatus(e){var t;return(t=this.status[this._jobs[e]])!=null?t:null}statusJobs(e){var t,r,s,i,o;if(e!=null){r=this.status.indexOf(e);if(r<0){throw new n(`status must be one of ${this.status.join(", ")}`)}s=this._jobs;i=[];for(t in s){o=s[t];if(o===r){i.push(t)}}return i}else{return Object.keys(this._jobs)}}statusCounts(){return this.counts.reduce((e,t,r)=>{e[this.status[r]]=t;return e},{})}};e.exports=s},6029:(e,t,r)=>{"use strict";function asyncGeneratorStep(e,t,r,n,s,i,o){try{var u=e[i](o);var a=u.value}catch(e){r(e);return}if(u.done){t(a)}else{Promise.resolve(a).then(n,s)}}function _asyncToGenerator(e){return function(){var t=this,r=arguments;return new Promise(function(n,s){var i=e.apply(t,r);function _next(e){asyncGeneratorStep(i,n,s,_next,_throw,"next",e)}function _throw(e){asyncGeneratorStep(i,n,s,_next,_throw,"throw",e)}_next(undefined)})}}var n,s;n=r(8579);s=class Sync{constructor(e,t){this.schedule=this.schedule.bind(this);this.name=e;this.Promise=t;this._running=0;this._queue=new n}isEmpty(){return this._queue.length===0}_tryToRun(){var e=this;return _asyncToGenerator(function*(){var t,r,n,s,i,o,u;if(e._running<1&&e._queue.length>0){e._running++;var a=e._queue.shift();u=a.task;t=a.args;i=a.resolve;s=a.reject;r=yield _asyncToGenerator(function*(){try{o=yield u(...t);return function(){return i(o)}}catch(e){n=e;return function(){return s(n)}}})();e._running--;e._tryToRun();return r()}})()}schedule(e,...t){var r,n,s;s=n=null;r=new this.Promise(function(e,t){s=e;return n=t});this._queue.push({task:e,args:t,resolve:s,reject:n});this._tryToRun();return r}};e.exports=s},7356:(e,t,r)=>{"use strict";e.exports=r(3911)},7823:(e,t)=>{"use strict";t.load=function(e,t,r={}){var n,s,i;for(n in t){i=t[n];r[n]=(s=e[n])!=null?s:i}return r};t.overwrite=function(e,t,r={}){var n,s;for(n in e){s=e[n];if(t[n]!==void 0){r[n]=s}}return r}},8222:(e,t,r)=>{t=e.exports=r(8564);t.log=log;t.formatArgs=formatArgs;t.save=save;t.load=load;t.useColors=useColors;t.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:localstorage();t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){if(typeof window!=="undefined"&&window.process&&window.process.type==="renderer"){return true}if(typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)){return false}return typeof document!=="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!=="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!=="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}};function formatArgs(e){var r=this.useColors;e[0]=(r?"%c":"")+this.namespace+(r?" %c":" ")+e[0]+(r?"%c ":" ")+"+"+t.humanize(this.diff);if(!r)return;var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var s=0;var i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){if("%%"===e)return;s++;if("%c"===e){i=s}});e.splice(i,0,n)}function log(){return"object"===typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function save(e){try{if(null==e){t.storage.removeItem("debug")}else{t.storage.debug=e}}catch(e){}}function load(){var e;try{e=t.storage.debug}catch(e){}if(!e&&typeof process!=="undefined"&&"env"in process){e=process.env.DEBUG}return e}t.enable(load());function localstorage(){try{return window.localStorage}catch(e){}}},8564:(e,t,r)=>{t=e.exports=createDebug.debug=createDebug["default"]=createDebug;t.coerce=coerce;t.disable=disable;t.enable=enable;t.enabled=enabled;t.humanize=r(900);t.instances=[];t.names=[];t.skips=[];t.formatters={};function selectColor(e){var r=0,n;for(n in e){r=(r<<5)-r+e.charCodeAt(n);r|=0}return t.colors[Math.abs(r)%t.colors.length]}function createDebug(e){var r;function debug(){if(!debug.enabled)return;var e=debug;var n=+new Date;var s=n-(r||n);e.diff=s;e.prev=r;e.curr=n;r=n;var i=new Array(arguments.length);for(var o=0;o<i.length;o++){i[o]=arguments[o]}i[0]=t.coerce(i[0]);if("string"!==typeof i[0]){i.unshift("%O")}var u=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(r,n){if(r==="%%")return r;u++;var s=t.formatters[n];if("function"===typeof s){var o=i[u];r=s.call(e,o);i.splice(u,1);u--}return r});t.formatArgs.call(e,i);var a=debug.log||t.log||console.log.bind(console);a.apply(e,i)}debug.namespace=e;debug.enabled=t.enabled(e);debug.useColors=t.useColors();debug.color=selectColor(e);debug.destroy=destroy;if("function"===typeof t.init){t.init(debug)}t.instances.push(debug);return debug}function destroy(){var e=t.instances.indexOf(this);if(e!==-1){t.instances.splice(e,1);return true}else{return false}}function enable(e){t.save(e);t.names=[];t.skips=[];var r;var n=(typeof e==="string"?e:"").split(/[\s,]+/);var s=n.length;for(r=0;r<s;r++){if(!n[r])continue;e=n[r].replace(/\*/g,".*?");if(e[0]==="-"){t.skips.push(new RegExp("^"+e.substr(1)+"$"))}else{t.names.push(new RegExp("^"+e+"$"))}}for(r=0;r<t.instances.length;r++){var i=t.instances[r];i.enabled=t.enabled(i.namespace)}}function disable(){t.enable("")}function enabled(e){if(e[e.length-1]==="*"){return true}var r,n;for(r=0,n=t.skips.length;r<n;r++){if(t.skips[r].test(e)){return false}}for(r=0,n=t.names.length;r<n;r++){if(t.names[r].test(e)){return true}}return false}function coerce(e){if(e instanceof Error)return e.stack||e.message;return e}},8237:(e,t,r)=>{if(typeof process==="undefined"||process.type==="renderer"){e.exports=r(8222)}else{e.exports=r(5332)}},5332:(e,t,r)=>{var n=r(3867);var s=r(1669);t=e.exports=r(8564);t.init=init;t.log=log;t.formatArgs=formatArgs;t.save=save;t.load=load;t.useColors=useColors;t.colors=[6,2,3,4,5,1];try{var i=r(132);if(i&&i.level>=2){t.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221]}}catch(e){}t.inspectOpts=Object.keys(process.env).filter(function(e){return/^debug_/i.test(e)}).reduce(function(e,t){var r=t.substring(6).toLowerCase().replace(/_([a-z])/g,function(e,t){return t.toUpperCase()});var n=process.env[t];if(/^(yes|on|true|enabled)$/i.test(n))n=true;else if(/^(no|off|false|disabled)$/i.test(n))n=false;else if(n==="null")n=null;else n=Number(n);e[r]=n;return e},{});function useColors(){return"colors"in t.inspectOpts?Boolean(t.inspectOpts.colors):n.isatty(process.stderr.fd)}t.formatters.o=function(e){this.inspectOpts.colors=this.useColors;return s.inspect(e,this.inspectOpts).split("\n").map(function(e){return e.trim()}).join(" ")};t.formatters.O=function(e){this.inspectOpts.colors=this.useColors;return s.inspect(e,this.inspectOpts)};function formatArgs(e){var r=this.namespace;var n=this.useColors;if(n){var s=this.color;var i="[3"+(s<8?s:"8;5;"+s);var o="  "+i+";1m"+r+" "+"[0m";e[0]=o+e[0].split("\n").join("\n"+o);e.push(i+"m+"+t.humanize(this.diff)+"[0m")}else{e[0]=getDate()+r+" "+e[0]}}function getDate(){if(t.inspectOpts.hideDate){return""}else{return(new Date).toISOString()+" "}}function log(){return process.stderr.write(s.format.apply(s,arguments)+"\n")}function save(e){if(null==e){delete process.env.DEBUG}else{process.env.DEBUG=e}}function load(){return process.env.DEBUG}function init(e){e.inspectOpts={};var r=Object.keys(t.inspectOpts);for(var n=0;n<r.length;n++){e.inspectOpts[r[n]]=t.inspectOpts[r[n]]}}t.enable(load())},7707:(e,t,r)=>{var n=r(8835);var s=r(8605);var i=r(7211);var o=r(2357);var u=r(2413).Writable;var a=r(8237)("follow-redirects");var c={GET:true,HEAD:true,OPTIONS:true,TRACE:true};var l=Object.create(null);["abort","aborted","error","socket","timeout"].forEach(function(e){l[e]=function(t){this._redirectable.emit(e,t)}});function RedirectableRequest(e,t){u.call(this);e.headers=e.headers||{};this._options=e;this._redirectCount=0;this._redirects=[];this._requestBodyLength=0;this._requestBodyBuffers=[];if(e.host){if(!e.hostname){e.hostname=e.host}delete e.host}if(t){this.on("response",t)}var r=this;this._onNativeResponse=function(e){r._processResponse(e)};if(!e.pathname&&e.path){var n=e.path.indexOf("?");if(n<0){e.pathname=e.path}else{e.pathname=e.path.substring(0,n);e.search=e.path.substring(n)}}this._performRequest()}RedirectableRequest.prototype=Object.create(u.prototype);RedirectableRequest.prototype.write=function(e,t,r){if(!(typeof e==="string"||typeof e==="object"&&"length"in e)){throw new Error("data should be a string, Buffer or Uint8Array")}if(typeof t==="function"){r=t;t=null}if(e.length===0){if(r){r()}return}if(this._requestBodyLength+e.length<=this._options.maxBodyLength){this._requestBodyLength+=e.length;this._requestBodyBuffers.push({data:e,encoding:t});this._currentRequest.write(e,t,r)}else{this.emit("error",new Error("Request body larger than maxBodyLength limit"));this.abort()}};RedirectableRequest.prototype.end=function(e,t,r){if(typeof e==="function"){r=e;e=t=null}else if(typeof t==="function"){r=t;t=null}var n=this._currentRequest;this.write(e||"",t,function(){n.end(null,null,r)})};RedirectableRequest.prototype.setHeader=function(e,t){this._options.headers[e]=t;this._currentRequest.setHeader(e,t)};RedirectableRequest.prototype.removeHeader=function(e){delete this._options.headers[e];this._currentRequest.removeHeader(e)};["abort","flushHeaders","getHeader","setNoDelay","setSocketKeepAlive","setTimeout"].forEach(function(e){RedirectableRequest.prototype[e]=function(t,r){return this._currentRequest[e](t,r)}});["aborted","connection","socket"].forEach(function(e){Object.defineProperty(RedirectableRequest.prototype,e,{get:function(){return this._currentRequest[e]}})});RedirectableRequest.prototype._performRequest=function(){var e=this._options.protocol;var t=this._options.nativeProtocols[e];if(!t){this.emit("error",new Error("Unsupported protocol "+e));return}if(this._options.agents){var r=e.substr(0,e.length-1);this._options.agent=this._options.agents[r]}var s=this._currentRequest=t.request(this._options,this._onNativeResponse);this._currentUrl=n.format(this._options);s._redirectable=this;for(var i in l){if(i){s.on(i,l[i])}}if(this._isRedirect){var o=0;var u=this._requestBodyBuffers;(function writeNext(){if(o<u.length){var e=u[o++];s.write(e.data,e.encoding,writeNext)}else{s.end()}})()}};RedirectableRequest.prototype._processResponse=function(e){if(this._options.trackRedirects){this._redirects.push({url:this._currentUrl,headers:e.headers,statusCode:e.statusCode})}var t=e.headers.location;if(t&&this._options.followRedirects!==false&&e.statusCode>=300&&e.statusCode<400){if(++this._redirectCount>this._options.maxRedirects){this.emit("error",new Error("Max redirects exceeded."));return}var r;var s=this._options.headers;if(e.statusCode!==307&&!(this._options.method in c)){this._options.method="GET";this._requestBodyBuffers=[];for(r in s){if(/^content-/i.test(r)){delete s[r]}}}if(!this._isRedirect){for(r in s){if(/^host$/i.test(r)){delete s[r]}}}var i=n.resolve(this._currentUrl,t);a("redirecting to",i);Object.assign(this._options,n.parse(i));this._isRedirect=true;this._performRequest();e.destroy()}else{e.responseUrl=this._currentUrl;e.redirects=this._redirects;this.emit("response",e);this._requestBodyBuffers=[]}};function wrap(e){var t={maxRedirects:21,maxBodyLength:10*1024*1024};var r={};Object.keys(e).forEach(function(s){var i=s+":";var u=r[i]=e[s];var c=t[s]=Object.create(u);c.request=function(e,s){if(typeof e==="string"){e=n.parse(e);e.maxRedirects=t.maxRedirects}else{e=Object.assign({protocol:i,maxRedirects:t.maxRedirects,maxBodyLength:t.maxBodyLength},e)}e.nativeProtocols=r;o.equal(e.protocol,i,"protocol mismatch");a("options",e);return new RedirectableRequest(e,s)};c.get=function(e,t){var r=c.request(e,t);r.end();return r}});return t}e.exports=wrap({http:s,https:i});e.exports.wrap=wrap},991:(e,t,r)=>{var n=r(7211);function isEmpty(e){for(var t in e){if(e.hasOwnProperty(t))return false}return true}function pemEncode(e,t){var r=[];for(var n=1;n<=e.length;n++){r.push(e[n-1]);var s=n%t;if(s===0){r.push("\n")}}var i=`-----BEGIN CERTIFICATE-----\n${r.join("")}\n-----END CERTIFICATE-----`;return i}function getOptions(e,t,r){return{hostname:e,agent:false,rejectUnauthorized:false,ciphers:"ALL",port:t,protocol:r}}function validateUrl(e){if(e.length<=0||typeof e!=="string"){throw Error("A valid URL is required")}}function handleRequest(e,t,r){return n.get(e,function(e){var n=e.socket.getPeerCertificate();if(isEmpty(n)||n===null){r({message:"The website did not provide a certificate"})}else{if(n.raw){n.pemEncoded=pemEncode(n.raw.toString("base64"),64)}t(n)}})}function get(e,t,r,n){validateUrl(e);r=r||443;n=n||"https:";var s=getOptions(e,r,n);return new Promise(function(e,r){var n=handleRequest(s,e,r);if(t){n.setTimeout(t,function(){r({message:"Request timed out."});n.abort()})}n.on("error",function(e){r(e)});n.end()})}e.exports={get:get}},900:e=>{var t=1e3;var r=t*60;var n=r*60;var s=n*24;var i=s*365.25;e.exports=function(e,t){t=t||{};var r=typeof e;if(r==="string"&&e.length>0){return parse(e)}else if(r==="number"&&isNaN(e)===false){return t.long?fmtLong(e):fmtShort(e)}throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function parse(e){e=String(e);if(e.length>100){return}var o=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(!o){return}var u=parseFloat(o[1]);var a=(o[2]||"ms").toLowerCase();switch(a){case"years":case"year":case"yrs":case"yr":case"y":return u*i;case"days":case"day":case"d":return u*s;case"hours":case"hour":case"hrs":case"hr":case"h":return u*n;case"minutes":case"minute":case"mins":case"min":case"m":return u*r;case"seconds":case"second":case"secs":case"sec":case"s":return u*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return u;default:return undefined}}function fmtShort(e){if(e>=s){return Math.round(e/s)+"d"}if(e>=n){return Math.round(e/n)+"h"}if(e>=r){return Math.round(e/r)+"m"}if(e>=t){return Math.round(e/t)+"s"}return e+"ms"}function fmtLong(e){return plural(e,s,"day")||plural(e,n,"hour")||plural(e,r,"minute")||plural(e,t,"second")||e+" ms"}function plural(e,t,r){if(e<t){return}if(e<t*1.5){return Math.floor(e/t)+" "+r}return Math.ceil(e/t)+" "+r+"s"}},8039:(e,t,r)=>{"use strict";const n=r(7548),s=r(3305),i=r(1810);e.exports={v3:n,discovery:s,ApiError:i}},1810:(e,t,r)=>{"use strict";const n=r(7253);class ApiError extends Error{constructor(...e){super(...e);Error.captureStackTrace(this,ApiError);if(e[0]instanceof n){this._hueError=e[0];this.message=this._hueError.message}else if(e[1]&&e[1]instanceof n){this._hueError=e[1]}}getHueError(){return this._hueError}getHueErrorType(){return this._hueError?this._hueError.type:-1}getHueErrorAddress(){return this._hueError?this._hueError.address:null}getHueErrorDescription(){return this._hueError?this._hueError.description:null}getHueErrorMessage(){return this._hueError?this._hueError.message:null}}e.exports=ApiError},7253:e=>{"use strict";const t={1:"unauthorized user",2:"body contains invalid JSON",3:"resource not found",4:"method not available for resource",5:"missing paramters in body",6:"parameter not available",7:"invalid value for parameter",8:"parameter not modifiable",11:"too many items in list",12:"portal connection is required",901:"bridge internal error"};class HueError{constructor(e){this.payload=e}get type(){return this.payload.type||-1}get address(){return this.payload.address}get description(){return this.payload.description}get message(){let e=this.payload.message,t=this.type;if(t===5||t===6){e=`${e}: ${this.address}`}return e}get rawError(){return this.payload}}e.exports=HueError},5830:(e,t,r)=>{"use strict";const n=r(6986),s=r(2494),i=r(5380),o=r(6952),u=r(9644),a=r(6071),c=r(5902),l=r(9987),h=r(9439),d=r(899),p=r(5435),g=r(789),f=r(4443);e.exports=class Api{constructor(e,t,r){const g=this;g._config=new f(e,t,r);g._api={capabilities:new n(g),configuration:new o(g),lights:new s(g),groups:new i(g),sensors:new a(g),schedules:new c(g),scenes:new l(g),users:new u(g),rules:new d(g),resourceLinks:new p(g)};if(g._config.isRemote){g._api.remote=new h(g)}g._lastSyncTime=-1;g._state=null;g.syncWithBridge()}get capabilities(){return this._api.capabilities}get configuration(){return this._api.configuration}get lights(){return this._api.lights}get groups(){return this._api.groups}get sensors(){return this._api.sensors}get schedules(){return this._api.schedules}get scenes(){return this._api.scenes}get users(){return this._api.users}get rules(){return this._api.rules}get resourceLinks(){return this._api.resourceLinks}get remote(){return this._api.remote}getCachedState(){const e=this;if(e.isSyncing()){return e._syncPromise.then(()=>{return e._state})}else{return Promise.resolve(e._state)}}isSyncing(){return this._syncPromise!=null}getLastSyncTime(){return this._lastSyncTime}syncWithBridge(){const e=this;if(!e.isSyncing()){if(e._config.username){e._syncPromise=e.configuration.getAll()}else{e._syncPromise=e.configuration.getUnauthenticatedConfig()}e._syncPromise=e._syncPromise.then(t=>{e._syncPromise=null;e._state=new g(t);e._lastSyncTime=(new Date).getTime()}).catch(()=>{e._syncPromise=null})}}getLightDefinition(e){return this.getCachedState().then(()=>{return this._state.getLight(e)})}_getConfig(){return this._config}_getTransport(){return this._config.transport}_getRemote(){return this._config.remote}}},789:(e,t,r)=>{"use strict";const n=r(4465),s=r(6881);const i=new s;e.exports=class Cache{constructor(e){this.data=e;this._lights={}}getLight(e){const t=i.getValue({id:e});let r=this._lights[t];if(!r){let e=this.data.lights[t];if(e){r=n.createFromBridge("light",t,e);this._lights[t]=r}}return r}get modelid(){return this.data.config.modelid}get apiversion(){return this.data.config.apiversion}}},6986:(e,t,r)=>{"use strict";const n=r(1209),s=r(3770);e.exports=class Capabilities extends s{constructor(e){super(e)}getAll(){return this.execute(n.getAll,{baseUrl:this.hueApi._getConfig().baseUrl})}}},6952:(e,t,r)=>{"use strict";const n=r(2415),s=r(3770),i=r(7516);e.exports=class Configuration extends s{constructor(e){super(e)}getAll(){return this.execute(n.getFullState)}getUnauthenticatedConfig(){return this.execute(n.getUnauthenticatedConfig)}update(e){i.deprecatedFunction("5.x","configuration.update(data)","Use configuration.updateConfiguration(data) instead");return this.updateConfiguration(e)}updateConfiguration(e){return this.execute(n.updateConfiguration,{config:e})}get(){i.deprecatedFunction("5.x","configuration.get()","Use configuration.getConfiguration() instead");return this.getConfiguration()}getConfiguration(){return this.execute(n.getConfiguration)}pressLinkButton(){return this.execute(n.updateConfiguration,{linkbutton:true})}}},5380:(e,t,r)=>{"use strict";const n=r(7356),s=r(7177),i=r(3770),o=r(4465),u=r(7516);e.exports=class Groups extends i{constructor(e){super(e);this._groupStateLimiter=new n({maxConcurrent:1,minTime:1e3})}getAll(){return Promise.all([this.execute(s.getGroupAttributes,{id:0}),this.execute(s.getAllGroups)]).then(e=>{e[1].unshift(e[0]);return e[1]})}getGroup(e){return this.execute(s.getGroupAttributes,{id:e})}get(e){u.deprecatedFunction("5.x","groups.get(id)","Use groups.getGroup(id) instead.");return this.getGroup(e)}getByName(e){u.deprecatedFunction("5.x","groups.getByName(name)","Use groups.getGroupByName(name) instead.");return this.getGroupByName(e)}getGroupByName(e){return this.getAll().then(t=>{return t.filter(t=>t.name===e)})}createGroup(e){const t=this;if(arguments.length===1&&o.isGroupInstance(e)){return this.execute(s.createGroup,{group:e}).then(e=>{return t.getGroup(e.id)})}u.deprecatedFunction("5.x","groups.createGroup(name, lights)","Use groups.createGroup(group) instead.");const r=o.createLightGroup();r.name=arguments[0];r.lights=arguments[1];return t.createGroup(r)}createRoom(e,t,r){u.deprecatedFunction("5.x","groups.createRoom(name, lights, roomClass)","Use groups.createGroup(group) instead.");const n=o.createRoom();n.name=e;n.lights=t;n.class=r;return this.createGroup(n)}createZone(e,t,r){u.deprecatedFunction("5.x","groups.createZone(name, lights, roomClass)","Use groups.createGroup(group) instead.");const n=o.createZone();n.name=e;n.lights=t;n.class=r;return this.createGroup(n)}updateGroupAttributes(e){return this.execute(s.setGroupAttributes,{id:e.id,group:e})}updateAttributes(e,t){u.deprecatedFunction("5.x","groups.updateAttributes(id, data)","Use groups.updateGroupAttributes(group) instead.");return this.execute(s.setGroupAttributes,{id:e,group:t})}deleteGroup(e){return this.execute(s.deleteGroup,{id:e})}getGroupState(e){return this.get(e).then(e=>{return e.state})}setGroupState(e,t){const r=this;return r._groupStateLimiter.schedule(()=>{return r.execute(s.setGroupState,{id:e,state:t})})}getLightGroups(){return this._getByType("LightGroup")}getLuminaries(){return this._getByType("Luminaire")}getLightSources(){return this._getByType("Lightsource")}getRooms(){return this._getByType("Room")}getZones(){return this._getByType("Zone")}getEntertainment(){return this._getByType("Entertainment")}enableStreaming(e){return this.execute(s.setStreaming,{id:e,active:true})}disableStreaming(e){return this.execute(s.setStreaming,{id:e,active:false})}_getByType(e){return this.getAll().then(t=>{return t.filter(t=>t.type===e)})}}},4443:(e,t,r)=>{"use strict";const n=r(1810);e.exports=class HueApiConfig{constructor(e,t,r){this._config=e;this._remoteApi=r;this._transport=t;this._isRemote=!!e.remote&&!!r}get isRemote(){return this._isRemote}get transport(){return this._transport}get remote(){if(this.isRemote){return this._remoteApi}else{throw new n("This API has not been set up as a remote API")}}get username(){return this._config.username}get clientId(){this._requireRemote();return this._config.clientId}get clientSecret(){this._requireRemote();return this._config.clientSecret}get baseUrl(){return this._config.baseUrl}get clientKey(){this._requireLocal();return this._config.clientkey}get accessToken(){this._requireRemote();return this._remoteApi.accessToken}get accessTokenExpiry(){this._requireRemote();return this._remoteApi.accessTokenExpiry}get refreshToken(){this._requireRemote();return this._remoteApi.refreshToken}get refreshTokenExpiry(){this._requireRemote();return this._remoteApi.refreshTokenExpiry}_requireRemote(){if(!this.isRemote){throw new n("The function is only valid on a remote Hue API instance")}}_requireLocal(){if(this.isRemote){throw new n("The function is only valid on a local Hue API instance")}}}},2494:(e,t,r)=>{"use strict";const n=r(7356),s=r(6846),i=r(3770),o=r(1810),u=r(7516),a=r(4465);e.exports=class Lights extends i{constructor(e){super(e);this._lightStateLimiter=new n({maxConcurrent:1,minTime:60})}getAll(){return this.execute(s.getAllLights)}getLight(e){const t=e.id||e;return this.getAll().then(e=>{const r=e.filter(e=>e.id===t);if(r.length===0){throw new o(`Light ${t} not found`)}return r[0]})}getLightById(e){u.deprecatedFunction("5.x","lights.getLightById(id)","Use lights.getLight(id) instead.");return this.getLight(e)}getLightByName(e){return this.getAll().then(t=>{return t.find(t=>{return t.name===e})})}getNew(){return this.execute(s.getNewLights)}searchForNew(){return this.execute(s.searchForNewLights)}getLightAttributesAndState(e){return this.execute(s.getLightAttributesAndState,{id:e})}getLightState(e){return this.getLightAttributesAndState(e).then(e=>{return e.state})}setLightState(e,t){let r=e;if(a.isLightInstance(e)){r=e.id}return this.hueApi.getLightDefinition(r).then(n=>{if(!n){throw new o(`Light with id:${r} was not found on this bridge`)}return this._setLightState(e,t,n)})}renameLight(e){if(a.isLightInstance(e)){return this.execute(s.setLightAttributes,{id:e,light:e})}else{throw new o("Light parameter is not an instance of a light")}}rename(e,t){if(arguments.length===1){u.deprecatedFunction("5.x","lights.rename(id, name)","Use lights.renameLight(light) instead.");return this.renameLight(e)}else{u.deprecatedFunction("5.x","lights.rename(id, name)","Use lights.renameLight(light) instead.");return this.execute(s.setLightAttributes,{id:e,name:t})}}deleteLight(e){return this.execute(s.deleteLight,{id:e})}_setLightState(e,t,r){const n=this;return this._lightStateLimiter.schedule(()=>{return n.execute(s.setLightState,{id:e,state:t,device:r})})}}},9439:e=>{"use strict";e.exports=class Remote{constructor(e){this._hueApi=e}getToken(e){return this._getRemoteApi().getToken(e)}refreshTokens(){const e=this,t=e._getRemoteApi();return t.refreshTokens(t.refreshToken).then(t=>{e._getHueApi()._getTransport().refreshAuthorizationHeader(t.access);return t})}createRemoteUser(e,t){return this._getRemoteApi().createRemoteUsername(e,t)}getRemoteAccessCredentials(){const e=this._getHueApi()._getConfig();const t={clientId:e.clientId,clientSecret:e.clientSecret,username:e.username,tokens:{}};if(e.accessToken){t.tokens.access={value:e.accessToken,expiresAt:e.accessTokenExpiry}}if(e.refreshToken){t.tokens.refresh={value:e.refreshToken,expiresAt:e.refreshTokenExpiry}}return t}_getHueApi(){return this._hueApi}_getRemoteApi(){return this._getHueApi()._getRemote()}}},5435:(e,t,r)=>{"use strict";const n=r(252),s=r(3526),i=r(3770);e.exports=class ResourceLinks extends i{constructor(e){super(e)}getAll(){return this.execute(n.getAll)}getResourceLink(e){return this.execute(n.getResourceLink,{id:e})}getResourceLinkByName(e){return this.getAll().then(t=>{return t.filter(t=>t.name===e)})}createResourceLink(e){const t=this;return t.execute(n.createResourceLink,{resourceLink:e}).then(e=>{return t.getResourceLink(e.id)})}deleteResourceLink(e){let t=e;if(e instanceof s){t=e.id}return this.execute(n.deleteResourceLink,{id:t})}updateResourceLink(e){return this.execute(n.updateResourceLink,{id:e.id,resourceLink:e})}}},899:(e,t,r)=>{"use strict";const n=r(5113),s=r(8326),i=r(3770),o=r(7516);e.exports=class Sensors extends i{constructor(e){super(e)}getAll(){return this.execute(n.getAll)}getRule(e){return this.execute(n.getRule,{id:e})}get(e){o.deprecatedFunction("5.x","rules.get(id)","Use rules.getRule(id) instead.");return this.getRule(e)}getRuleByName(e){return this.getAll().then(t=>{return t.filter(t=>t.name===e)})}createRule(e){const t=this;return t.execute(n.createRule,{rule:e}).then(e=>{return t.getRule(e.id)})}deleteRule(e){if(e instanceof s){return this.execute(n.deleteRule,{id:e.id})}else{return this.execute(n.deleteRule,{id:e})}}updateRule(e){return this.execute(n.updateRule,{id:e.id,rule:e})}_filterRules(e){return this.getAll().then(t=>{return t.filter(e)})}}},9987:(e,t,r)=>{"use strict";const n=r(9917),s=r(3770),i=r(1166),o=r(4465),u=r(7516);e.exports=class Scenes extends s{constructor(e){super(e)}getAll(){return this.execute(n.getAll)}get(e){u.deprecatedFunction("5.x","scenes.get(id)","Use scenes.getScene(id) instead.");return this.getScene(e)}getScene(e){return this.execute(n.getScene,{id:e})}getByName(e){u.deprecatedFunction("5.x","scenes.getByName(name)","Use scenes.getSceneByName(name) instead.");return this.getSceneByName(e)}getSceneByName(e){return this.getAll().then(t=>{return t.filter(t=>t.name===e)})}createScene(e){const t=this;return this.execute(n.createScene,{scene:e}).then(e=>{return t.getScene(e.id)})}update(e,t){u.deprecatedFunction("5.x","scenes.update(id, scene)","Use scenes.updateScene(scene) instead.");return this.execute(n.updateScene,{id:e,scene:t})}updateScene(e){return this.execute(n.updateScene,{id:e,scene:e})}updateLightState(e,t,r){return this.execute(n.updateSceneLightState,{id:e,lightStateId:t,lightState:r})}deleteScene(e){return this.execute(n.deleteScene,{id:e})}activateScene(e){let t=e;if(o.isSceneInstance(e)){t=e.id}return this.hueApi.groups.setGroupState(0,(new i).scene(t))}}},5902:(e,t,r)=>{"use strict";const n=r(2783),s=r(3770),i=r(7516);e.exports=class Schedules extends s{constructor(e){super(e)}getAll(){return this.execute(n.getAll)}get(e){i.deprecatedFunction("5.x","schedules.get(id)","Use schedules.getSchedule(id) instead.");return this.getSchedule(e)}getSchedule(e){return this.execute(n.getScheduleAttributes,{id:e})}getScheduleByName(e){return this.getAll().then(t=>{return t.filter(t=>t.name===e)})}createSchedule(e){const t=this;return t.execute(n.createSchedule,{schedule:e}).then(e=>{return t.getSchedule(e.id)})}updateSchedule(e){return this.execute(n.setScheduleAttributes,{id:e,schedule:e})}deleteSchedule(e){return this.execute(n.deleteSchedule,{id:e})}}},6071:(e,t,r)=>{"use strict";const n=r(2838),s=r(3770),i=r(7516);e.exports=class Sensors extends s{constructor(e){super(e)}getAll(){return this.execute(n.getAllSensors)}get(e){i.deprecatedFunction("5.x","sensors.get(id)","Use sensors.getSensor(id) instead.");return this.getSensor(e)}getSensor(e){return this.execute(n.getSensor,{id:e})}searchForNew(){return this.execute(n.findNewSensors)}getNew(){return this.execute(n.getNewSensors)}renameSensor(e){return this.execute(n.updateSensor,{id:e,name:e.name})}updateName(e,t){i.deprecatedFunction("5.x","sensors.updateName(id, name)","Use sensors.rename(sensor) instead.");return this.execute(n.updateSensor,{id:e,name:t})}createSensor(e){const t=this;return t.execute(n.createSensor,{sensor:e}).then(e=>{return t.getSensor(e.id)})}deleteSensor(e){return this.execute(n.deleteSensor,{id:e})}updateSensorConfig(e){return this.execute(n.changeSensorConfig,{id:e.id,sensor:e})}updateSensorState(e,t){return this.execute(n.changeSensorState,{id:e.id,sensor:e,filterStateNames:t})}}},9644:(e,t,r)=>{"use strict";const n=r(2415),s=r(3770),i=r(7516);e.exports=class Users extends s{constructor(e){super(e)}getAll(){return getAllUsersAsArray(this)}getUser(e){return getAllUsers(this).then(t=>{let r=null;if(t[e]){r=Object.assign({username:e},t[e])}return r})}get(e){i.deprecatedFunction("5.x","users.get(username)","Use users.getUser(username) instead.");return this.getUser(e)}getUserByName(e,t){let r;if(arguments.length===0){return Promise.resolve(null)}else if(arguments.length===1){r=e}else{r=`${e}#${t}`}return getAllUsersAsArray(this).then(e=>{return e.filter(e=>e.name===r)})}getByName(e,t){i.deprecatedFunction("5.x","scenes.get(id)","Use scenes.getScene(id) instead.");return this.getUserByName(e,t)}createUser(e,t){return this.hueApi.getCachedState().then(r=>{const s=r.modelid==="BSB001";return this.execute(n.createUser,{appName:e,deviceName:t,generateKey:!s})})}deleteUser(e){return this.execute(n.deleteUser,{element:e})}};function getAllUsers(e){return e.execute(n.getConfiguration).then(e=>{return e.whitelist||null})}function getAllUsersAsArray(e){return getAllUsers(e).then(e=>{const t=[];Object.keys(e).forEach(r=>{t.push(Object.assign({username:r},e[r]))});return t})}},8185:(e,t,r)=>{"use strict";const n=r(6200),s=r(8614).EventEmitter;class SSDPSearch{constructor(){const e=this;this.responseEmitter=new s;this.socket=n.createSocket("udp4");this.socket.on("error",function(t){e.responseEmitter.emit("error",t)});this.socket.on("message",function onMessage(t,r){const n=t.toString().split("\r\n");if(n[0].match(/HTTP\/(\d{1})\.(\d{1}) (\d+) (.*)/)){e.responseEmitter.emit("response",_parseSearchResponse(n.slice(1)))}});process.on("exit",this._finished.bind(this))}search(e){const t=this;return new Promise((r,n)=>{const s=[];t.responseEmitter.on("error",e=>{t.finished();n(e)});t.responseEmitter.on("response",e=>{s.push(e)});setTimeout(()=>{t._finished();r(_processResults(s))},e||5e3);t._start()})}_start(){const e="239.255.255.250",t=1900;const r=Buffer.from(_buildSearchPacket({HOST:e+":"+t,MAN:"ssdp:discover",MX:10,ST:"urn:schemas-upnp-org:device:Basic:1"}));this.socket.send(r,0,r.length,t,e)}_finished(){if(this.socket){this.socket.close();this.socket=null}}}e.exports=SSDPSearch;function _buildSearchPacket(e){let t="M-SEARCH * HTTP/1.1\r\n";Object.keys(e).forEach(function(r){t+=r+": "+e[r]+"\r\n"});return t+"\r\n"}function _parseSearchResponse(e){const t={};e.forEach(e=>{const r=e.indexOf(":");if(r>0&&r<e.length){const n=e.substring(0,r).toLowerCase();const s=e.substring(r+1,e.length).trim();t[n]=s}});return t}function _processResults(e){const t={};e.forEach(e=>{const r=e.location;let n=e["hue-bridgeid"];if(n==undefined){n=e["hue-bridgeId"]}if(r&&n){if(!t[r]){const e=/\/\/(.*):/.exec(r);if(e){t[r]={id:n,internalipaddress:e[1]}}}}});return Object.values(t)}},8741:(e,t,r)=>{"use strict";const n=r(6545),s=r(1810);const i=/<friendlyName>(.*)<\/friendlyName/ms,o=/<modelName>(.*)<\/modelName/ms,u=/<modelNumber>(.*)<\/modelNumber/ms,a=/<modelDescription>(.*)<\/modelDescription>/ms,c=/<manufacturer>(.*)<\/manufacturer>/ms,l=/<serialNumber>(.*)<\/serialNumber/ms,h=/<URLBase>http[s]?:\/\/(.*):.*<\/URLBase/ms,d=/<specVersion>.*<major>(.*)<\/.*<minor>(.*)<\/.*<\/specVersion/ms,p=/<iconList>(.*)<\/iconList>/ms,g=/<mimetype>(.*)<\/mimetype>/ms,f=/<height>(.*)<\/height>/ms,m=/<width>(.*)<\/width>/ms,_=/<depth>(.*)<\/depth>/ms,y=/<url>(.*)<\/url>/ms;const b=6e3;e.exports.getBridgeConfig=((e,t)=>{const r=e.internalipaddress;return n.request({method:"get",url:`http://${r}/api/config`,timeout:t|b,json:true}).catch(e=>{throw new s(`Problem connecting to bridge '${r}': ${e.message}`)}).then(e=>{if(e.status!==200){throw new s(`Unexpected status when getting unauthenticated configuration date from bridge at ${r}`)}const t={};t.name=e.data.name;t.ipaddress=r;t.modelid=e.data.modelid;t.swversion=e.data.swversion;return t})});e.exports.getBridgeDescription=((t,r)=>{const i=t.internalipaddress;return n.request({method:"GET",url:`http://${i}/description.xml`,timeout:r|b,headers:{accept:"text/xml"}}).catch(e=>{throw new s(`Failed to resolve the XML Description for the bridge at ${i}`)}).then(t=>{if(t.status!==200){throw new s(`Unexpected status when getting XML Description from bridge at ${i}`)}return e.exports.parseXmlDescription(t.data)})});e.exports.parseXmlDescription=(e=>{const t={};Object.assign(t,extractValue("name",e,i));Object.assign(t,extractValue("manufacturer",e,c));Object.assign(t,extractValue("ipaddress",e,h));const r=getModel(e);if(r){t.model=r}const n=getSpecVersion(e);if(n){t.version=n}const s=getIcons(e);if(s){t.icons=s}return t});function extractValue(e,t,r){const n=r.exec(t);if(!n){return null}const s={};s[e]=n[1];return s}function getModel(e){const t={};Object.assign(t,extractValue("number",e,u));Object.assign(t,extractValue("description",e,a));Object.assign(t,extractValue("name",e,o));Object.assign(t,extractValue("serial",e,l));return t}function getIcons(e){const t=p.exec(e);if(t){const e=t[1],r=e.split("</icon>"),n=[];r.forEach(e=>{const t=getIcon(e);if(t){n.push(t)}});return n}return null}function getIcon(e){const t={};Object.assign(t,extractValue("mimetype",e,g));Object.assign(t,extractValue("height",e,f));Object.assign(t,extractValue("width",e,m));Object.assign(t,extractValue("depth",e,_));Object.assign(t,extractValue("url",e,y));if(Object.keys(t).length>0){return t}return null}function getSpecVersion(e){const t=d.exec(e);if(t){return{major:t[1],minor:t[2]}}return null}},3250:(e,t,r)=>{"use strict";const n=r(7211).Agent;e.exports.getDiscoveryMeetHueHttpsAgent=(()=>{const e=new n;e.options.ca="-----BEGIN CERTIFICATE-----\n"+"MIIGLTCCBRWgAwIBAgIQDRFjcdUbFwTU3xg1Bre3yzANBgkqhkiG9w0BAQsFADBN\n"+"MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMScwJQYDVQQDEx5E\n"+"aWdpQ2VydCBTSEEyIFNlY3VyZSBTZXJ2ZXIgQ0EwHhcNMTkwNjE0MDAwMDAwWhcN\n"+"MjAwNjEzMTIwMDAwWjByMQswCQYDVQQGEwJOTDESMBAGA1UEBxMJRWluZGhvdmVu\n"+"MSEwHwYDVQQKExhTaWduaWZ5IE5ldGhlcmxhbmRzIEIuVi4xDDAKBgNVBAsTA0h1\n"+"ZTEeMBwGA1UEAxMVZGlzY292ZXJ5Lm1lZXRodWUuY29tMIIBIjANBgkqhkiG9w0B\n"+"AQEFAAOCAQ8AMIIBCgKCAQEAxaH5IfwVRAH/2/y4SlGOXTiLjXXm8Zto8YJsMVmv\n"+"2rqzxA3niZZfJ6SNFJUqWQ+M1Lhcn+yhKp//nrPiG4jUh7m0CWAQ+EgzrNkiYa9U\n"+"vC/yGqm2pwxDuPoT90ZdTHgH7+One1bNMn+YNH1/S+sLLf4I1vDwblijynN43cE1\n"+"02/HbCkAQ0PajRwOqsq8nxWTE6UV5qOWmkvlQuUQAC0zPd9a3bMax0PtY9Ld9ikL\n"+"2qoM+YbVcL7WvaS4YWm92z4bSZK/CIQmZYiB1Xat5TYQg0YxM1Iqj3wYV7lTdWgD\n"+"rfqds5z6I2jGZr72neI7BwJU6j+fHyc8wPbsudjYrDpnBQIDAQABo4IC4jCCAt4w\n"+"HwYDVR0jBBgwFoAUD4BhHIIxYdUvKOeNRji0LOHG2eIwHQYDVR0OBBYEFAgIvzOi\n"+"I5OaFQIExTAvb41w54ENMCAGA1UdEQQZMBeCFWRpc2NvdmVyeS5tZWV0aHVlLmNv\n"+"bTAOBgNVHQ8BAf8EBAMCBaAwHQYDVR0lBBYwFAYIKwYBBQUHAwEGCCsGAQUFBwMC\n"+"MGsGA1UdHwRkMGIwL6AtoCuGKWh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9zc2Nh\n"+"LXNoYTItZzYuY3JsMC+gLaArhilodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vc3Nj\n"+"YS1zaGEyLWc2LmNybDBMBgNVHSAERTBDMDcGCWCGSAGG/WwBATAqMCgGCCsGAQUF\n"+"BwIBFhxodHRwczovL3d3dy5kaWdpY2VydC5jb20vQ1BTMAgGBmeBDAECAjB8Bggr\n"+"BgEFBQcBAQRwMG4wJAYIKwYBBQUHMAGGGGh0dHA6Ly9vY3NwLmRpZ2ljZXJ0LmNv\n"+"bTBGBggrBgEFBQcwAoY6aHR0cDovL2NhY2VydHMuZGlnaWNlcnQuY29tL0RpZ2lD\n"+"ZXJ0U0hBMlNlY3VyZVNlcnZlckNBLmNydDAJBgNVHRMEAjAAMIIBBQYKKwYBBAHW\n"+"eQIEAgSB9gSB8wDxAHcA7ku9t3XOYLrhQmkfq+GeZqMPfl+wctiDAMR7iXqo/csA\n"+"AAFrVySi8gAABAMASDBGAiEAsQVAcK6mBEQy5gU4dgYdpzdGiU1SdzVHWi1ixio+\n"+"9WoCIQDd0UcKTiUmaVlOznXwfLzwCtKyIyDWqMF7bhlTKzdz9wB2AId1v+dZfPiM\n"+"Q5lfvfNu/1aNR1Y2/0q1YMG06v9eoIMPAAABa1ckny4AAAQDAEcwRQIhAKmIpwg4\n"+"w9nYb62Y45CWzsBOVp2Gy+7F4nAyf80MjXi8AiAkkXumIKT5ixe4v697u+dRcaxm\n"+"75EgRp51ifMIJKmwaTANBgkqhkiG9w0BAQsFAAOCAQEAXTejYipPw7rmH+IYqR4r\n"+"CmcaDTI3CUvr05QSCPsrD7/rkS/SDP2Z0ZRqHyfDUhYkxrrrBJMcDd28sLm//YJ+\n"+"+gbGfu+L24cXn3iXyBRliLvFCTRwZfA+347C97y2L0IFQV0S5YSHUr2u7PqG7Jcl\n"+"qF5rLPgOYcBNxkjuksqhZZfElVzwwtc/qTAsPAn4PKnJ/gtcb2Dj+41BgZ/lFGDP\n"+"Cv/SjNQxw6gNHG5UtEu9qJ0xFVjAC9E13yHezDjKpZs7aBgAD8sWTffp1jJAVkyU\n"+"mHpUGHe72H75CnlF6jGu2djDcLkXrWWqd/vw6vFx4oMgBwCHF8IWexUIbJQ5LUHZ\n"+"iQ==\n"+"-----END CERTIFICATE-----\n"+"\n"+"-----BEGIN CERTIFICATE-----\n"+"MIIElDCCA3ygAwIBAgIQAf2j627KdciIQ4tyS8+8kTANBgkqhkiG9w0BAQsFADBh\n"+"MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\n"+"d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD\n"+"QTAeFw0xMzAzMDgxMjAwMDBaFw0yMzAzMDgxMjAwMDBaME0xCzAJBgNVBAYTAlVT\n"+"MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxJzAlBgNVBAMTHkRpZ2lDZXJ0IFNIQTIg\n"+"U2VjdXJlIFNlcnZlciBDQTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEB\n"+"ANyuWJBNwcQwFZA1W248ghX1LFy949v/cUP6ZCWA1O4Yok3wZtAKc24RmDYXZK83\n"+"nf36QYSvx6+M/hpzTc8zl5CilodTgyu5pnVILR1WN3vaMTIa16yrBvSqXUu3R0bd\n"+"KpPDkC55gIDvEwRqFDu1m5K+wgdlTvza/P96rtxcflUxDOg5B6TXvi/TC2rSsd9f\n"+"/ld0Uzs1gN2ujkSYs58O09rg1/RrKatEp0tYhG2SS4HD2nOLEpdIkARFdRrdNzGX\n"+"kujNVA075ME/OV4uuPNcfhCOhkEAjUVmR7ChZc6gqikJTvOX6+guqw9ypzAO+sf0\n"+"/RR3w6RbKFfCs/mC/bdFWJsCAwEAAaOCAVowggFWMBIGA1UdEwEB/wQIMAYBAf8C\n"+"AQAwDgYDVR0PAQH/BAQDAgGGMDQGCCsGAQUFBwEBBCgwJjAkBggrBgEFBQcwAYYY\n"+"aHR0cDovL29jc3AuZGlnaWNlcnQuY29tMHsGA1UdHwR0MHIwN6A1oDOGMWh0dHA6\n"+"Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RDQS5jcmwwN6A1\n"+"oDOGMWh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEdsb2JhbFJvb3RD\n"+"QS5jcmwwPQYDVR0gBDYwNDAyBgRVHSAAMCowKAYIKwYBBQUHAgEWHGh0dHBzOi8v\n"+"d3d3LmRpZ2ljZXJ0LmNvbS9DUFMwHQYDVR0OBBYEFA+AYRyCMWHVLyjnjUY4tCzh\n"+"xtniMB8GA1UdIwQYMBaAFAPeUDVW0Uy7ZvCj4hsbw5eyPdFVMA0GCSqGSIb3DQEB\n"+"CwUAA4IBAQAjPt9L0jFCpbZ+QlwaRMxp0Wi0XUvgBCFsS+JtzLHgl4+mUwnNqipl\n"+"5TlPHoOlblyYoiQm5vuh7ZPHLgLGTUq/sELfeNqzqPlt/yGFUzZgTHbO7Djc1lGA\n"+"8MXW5dRNJ2Srm8c+cftIl7gzbckTB+6WohsYFfZcTEDts8Ls/3HB40f/1LkAtDdC\n"+"2iDJ6m6K7hQGrn2iWZiIqBtvLfTyyRRfJs8sjX7tN8Cp1Tm5gr8ZDOo0rwAhaPit\n"+"c+LJMto4JQtV05od8GiG7S5BNO98pVAdvzr508EIDObtHopYJeS4d60tbvVS3bR0\n"+"j6tJLp07kzQoH3jOlOrHvdPJbRzeXDLz\n"+"-----END CERTIFICATE-----\n"+"\n"+"-----BEGIN CERTIFICATE-----\n"+"MIIDrzCCApegAwIBAgIQCDvgVpBCRrGhdWrJWZHHSjANBgkqhkiG9w0BAQUFADBh\n"+"MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3\n"+"d3cuZGlnaWNlcnQuY29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBD\n"+"QTAeFw0wNjExMTAwMDAwMDBaFw0zMTExMTAwMDAwMDBaMGExCzAJBgNVBAYTAlVT\n"+"MRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5j\n"+"b20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IENBMIIBIjANBgkqhkiG\n"+"9w0BAQEFAAOCAQ8AMIIBCgKCAQEA4jvhEXLeqKTTo1eqUKKPC3eQyaKl7hLOllsB\n"+"CSDMAZOnTjC3U/dDxGkAV53ijSLdhwZAAIEJzs4bg7/fzTtxRuLWZscFs3YnFo97\n"+"nh6Vfe63SKMI2tavegw5BmV/Sl0fvBf4q77uKNd0f3p4mVmFaG5cIzJLv07A6Fpt\n"+"43C/dxC//AH2hdmoRBBYMql1GNXRor5H4idq9Joz+EkIYIvUX7Q6hL+hqkpMfT7P\n"+"T19sdl6gSzeRntwi5m3OFBqOasv+zbMUZBfHWymeMr/y7vrTC0LUq7dBMtoM1O/4\n"+"gdW7jVg/tRvoSSiicNoxBN33shbyTApOB6jtSj1etX+jkMOvJwIDAQABo2MwYTAO\n"+"BgNVHQ8BAf8EBAMCAYYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUA95QNVbR\n"+"TLtm8KPiGxvDl7I90VUwHwYDVR0jBBgwFoAUA95QNVbRTLtm8KPiGxvDl7I90VUw\n"+"DQYJKoZIhvcNAQEFBQADggEBAMucN6pIExIK+t1EnE9SsPTfrgT1eXkIoyQY/Esr\n"+"hMAtudXH/vTBH1jLuG2cenTnmCmrEbXjcKChzUyImZOMkXDiqw8cvpOp/2PV5Adg\n"+"06O/nVsJ8dWO41P0jmP6P6fbtGbfYmbW0W5BjfIttep3Sp+dWOIrWcBAI+0tKIJF\n"+"PnlUkiaY4IBIqDfv8NZ5YBberOgOzW6sRBc4L0na4UU+Krk2U886UAb3LujEV0ls\n"+"YSEY1QSteDwsOoBrp+uvFRTp2InBuThs4pFsiv9kuXclVzDAGySj4dzp30d8tbQk\n"+"CAUw7C29C79Fv1C5qfPrmAESrciIxpg0X40KPMbp1ZWVbd4=\n"+"-----END CERTIFICATE-----\n";return e})},3305:(e,t,r)=>{"use strict";const n=r(8185),s=r(541),i=r(8741),o=r(8039).ApiError;e.exports.upnpSearch=function(e){const t=new n;return t.search(e).then(loadDescriptions)};e.exports.nupnpSearch=function(){return s.nupnp().then(loadConfigurations)};e.exports.description=function(e){if(!e){throw new o(`A bridge ip address must be provided`)}return loadDescriptions([{internalipaddress:e}]).then(e=>{if(e){return e[0]}return null})};function loadDescriptions(e){const t=e.map(e=>{return i.getBridgeDescription(e)});return Promise.all(t)}function loadConfigurations(e){const t=e.map(e=>{return i.getBridgeConfig(e).catch(t=>{return{error:{message:t.message,description:`Failed to connect and load configuration from the bridge at ip address ${e.ipaddress}`,ipaddress:e.internalipaddress,id:e.id}}})});return Promise.all(t)}},541:(e,t,r)=>{"use strict";const n=r(6545),s=r(3250),i=r(1810);e.exports.nupnp=function(){return n.get("https://discovery.meethue.com",{headers:{accept:"application/json"},httpsAgent:s.getDiscoveryMeetHueHttpsAgent()}).catch(e=>{throw new i(`Problems resolving hue bridges, ${e.message}`)}).then(e=>{if(e.status===200){return e.data}else{throw new i(`Status code unexpected when using N-UPnP endpoint: ${e.status}`)}})}},3770:e=>{"use strict";e.exports=class ApiDefinition{constructor(e){this._hueApi=e}execute(e,t){return this.transport.execute(e,t)}get hueApi(){return this._hueApi}get transport(){return this.hueApi._getTransport()}}},507:(e,t,r)=>{"use strict";const n=r(8835),s=r(7211),i=r(991),o=r(6545),u=r(1810),a=r(4622),c=r(5830);const l=/node-hue-api/.test(process.env.NODE_DEBUG);e.exports=class LocalBootstrap{constructor(e,t){this._baseUrl=n.format({protocol:"https",hostname:e,port:t||443});this._hostname=e}get baseUrl(){return this._baseUrl}get hostname(){return this._hostname}connect(e,t,r){const n=this,h=n.hostname,d=n.baseUrl;return o.get(`${d}/api/config`,{httpsAgent:new s.Agent({rejectUnauthorized:false})}).then(n=>{const p=n.data.bridgeid.toLowerCase();return i.get(h).then(e=>{const t=e.subject.CN.toLowerCase();if(l){console.log("Bridge Certificate:\n"+`  subject:       ${JSON.stringify(e.subject)}\n`+`  issuer:        ${JSON.stringify(e.subject)}\n`+`  valid from:    ${e.valid_from}\n`+`  valid to:      ${e.valid_to}\n`+`  serial number: ${e.serialNumber}\n`);console.log(`Performing validation of bridgeId "${p}" against certifcate subject "${t}"; matched? ${t===p}`)}if(t===p){return new s.Agent({keepAlive:true,keepAliveMsecs:1e4,maxSockets:50,timeout:getTimeout(r),rejectUnauthorized:false})}else{throw new u("The hue bridge certificate does not match the expected issuer")}}).catch(e=>{throw new u(e)}).then(r=>{const n=`${d}/api`,s=new a(e,o.create({baseURL:n,httpsAgent:r})),i={remote:false,baseUrl:n,clientkey:t,username:e};return new c(i,s)})})}};function getTimeout(e){return e||2e4}},620:(e,t,r)=>{"use strict";const n=r(8835),s=r(6545),i=r(4622),o=r(5830);const u=process.env.NODE_HUE_API_USE_INSECURE_CONNECTION!=null;e.exports=class LocalInsecureBootstrap{constructor(e,t){this._baseUrl=n.format({protocol:"http",hostname:e,port:t||80});this._hostname=e}get baseUrl(){return this._baseUrl}get hostname(){return this._hostname}connect(e,t){const r=this.baseUrl;if(!u){console.log("WARNING: You are using this library in an insecure way!\n"+"The Hue bridge supports HTTPS connections locally and it is highly recommended that you use an HTTPS\n"+"method to communicate with the bridge.")}return s.get(`${r}/api/config`).then(()=>{const n=`${r}/api`,u=new i(e,s.create({baseURL:n})),a={remote:false,baseUrl:n,clientkey:t,username:e};return new o(a,u)})}}},8956:e=>{"use strict";e.exports=class OAuthTokens{constructor(e){this._data={accessToken:{value:null,expiresAt:-1},refreshToken:{value:null,expiresAt:-1}};if(e){this._setAccessToken(e.accessToken,e.accessTokenExpiresAt);this._setRefreshToken(e.refreshToken,e.refreshTokenExpiresAt)}}_setAccessToken(e,t){this._data.accessToken.value=e;this._data.accessToken.expiresAt=t||-1}_setRefreshToken(e,t){this._data.refreshToken.value=e;this._data.refreshToken.expiresAt=t||-1}get refreshToken(){return this._data.refreshToken.value}get accessToken(){return this._data.accessToken.value}get accessTokenExpiresAt(){return this._data.accessToken.expiresAt}get refreshTokenExpiresAt(){return this._data.refreshToken.expiresAt}toString(){return JSON.stringify(this._data,null,2)}}},5889:(e,t,r)=>{"use strict";const n=r(6417),s=r(6545),i=r(1810),o=r(8956),u=r(7516);e.exports=class RemoteApi{constructor(e,t){this._config={clientId:e,clientSecret:t,baseUrl:"https://api.meethue.com"};this._tokens=new o}get clientId(){return this._config.clientId}get clientSecret(){return this._config.clientSecret}get baseUrl(){return this._config.baseUrl}get accessToken(){return this._tokens.accessToken}get accessTokenExpiry(){return this._tokens.accessTokenExpiresAt}get refreshToken(){return this._tokens.refreshToken}get refreshTokenExpiry(){return this._tokens.refreshTokenExpiresAt}setAccessToken(e,t){this._tokens._setAccessToken(e,t);return this}setRefreshToken(e,t){this._tokens._setRefreshToken(e,t);return this}getDigestResponse(e,t,r,s){const o=this.clientId,u=this.clientSecret,a=n.createHash("md5").update(`${o}:${e}:${u}`).digest("hex"),c=n.createHash("md5").update(`${r.toUpperCase()}:${s}`).digest("hex"),l=n.createHash("md5").update(`${a}:${t}:${c}`).digest("hex");if(!o){throw new i("clientId has not been provided, unable to build a digest response")}if(!u){throw new i("clientSecret has not been provided, unable to build a digest response")}return l}getAuthorizationHeaderDigest(e,t,r,n){const s=this.clientId,i=this.getDigestResponse(e,t,r,n);return`Digest username="${s}", realm="${e}", nonce="${t}", uri="${n}", response="${i}"`}getAuthorizationHeaderBasic(){const e=this.clientId,t=this.clientSecret,r=Buffer.from(`${e}:${t}`,"ascii").toString("base64");return`Basic ${r}`}getToken(e){const t=this,r={baseURL:t.baseUrl,url:"/oauth2/token",method:"POST",params:{code:e,grant_type:"authorization_code"},headers:{Accept:"application/json"},responseType:"json"},n=Date.now();return s.request(r).catch(e=>{return t._respondWithDigest(e,r)}).then(e=>{if(e.status===200){return t._processTokens(n,e.data)}else{throw new i(`Unexpected status code from getting token: ${e.status}`)}})}refreshTokens(e){const t=this,r={baseURL:t.baseUrl,url:"/oauth2/refresh",method:"POST",data:`refresh_token=${e}`,params:{grant_type:"refresh_token"},headers:{"content-type":"application/x-www-form-urlencoded",Accept:"application/json"},responseType:"json"},n=Date.now();return s.request(r).catch(e=>{return t._respondWithDigest(e,r)}).then(e=>{if(e.status===200){return t._processTokens(n,e.data)}else{throw new i(`Unexpected status code from refreshing tokens: ${e.status}`)}})}createRemoteUsername(e,t){const r=this,n=r.accessToken;if(Number.isNaN(Number.parseInt(e))){e=0}if(!n){throw new i("No current valid access token, you need to fetch an access token before continuing.")}const o=s.create({baseURL:r.baseUrl,headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},responseType:"json"});return o.put(`/bridge/${e}/config`,{linkbutton:true}).then(e=>{if(!u.wasSuccessful(e.data)){throw new i(`Issue with activating remote link button, attempt was not successful: ${JSON.stringify(e.data)}`)}return o.post("/bridge",{devicetype:t||"node-hue-api-remote"}).then(e=>{if(u.wasSuccessful(e.data)){return e.data[0].success.username}else{throw new i(`Failed to create a remote whitelist user: ${JSON.stringify(e.data)}`)}})})}_respondWithDigest(e,t){if(!e.response){throw new i(`Did not get expected error response from remote API: ${e.message}`)}const r=e.response.status;if(r!==401){throw new i(`Did not get the expected 401 response from the remote API that contains the www-authenticate details needed to proceed, got status ${r}`)}const n=getAuthenticationDetailsFromHeader(e.response),o=this.getAuthorizationHeaderDigest(n.realm,n.nonce,t.method,t.url);t.headers={Authorization:o};return s.request(t)}_processTokens(e,t){this.setAccessToken(t.access_token,e+t.access_token_expires_in*1e3);this.setRefreshToken(t.refresh_token,e+t.refresh_token_expires_in*1e3);return new o(this._tokens)}};function getAuthenticationDetailsFromHeader(e){if(!e||!e.headers){throw new i("Response object is missing headers property")}if(!e.headers["www-authenticate"]){throw new i('Response is missing the "www-authenticate" header')}const t=e.headers["www-authenticate"],r=/realm="(.*?)"/.exec(t)[1],n=/nonce="(.*?)"/.exec(t)[1];return{realm:r,nonce:n}}},9734:(e,t,r)=>{"use strict";const n=r(6545),s=r(5889),i=r(4622),o=r(5830),u=r(1810);e.exports=class RemoteBootstrap{constructor(e,t){this.clientId=e;this.clientSecret=t;this.remoteApi=new s(e,t)}getAuthCodeUrl(e,t,r){if(!e){throw new u("A unique deviceid is required for your application when accessing the Remote API")}if(!r){throw new u("A state value must be provided to mitigate against cross-site request forgeries")}if(!t){throw new u("An Application ID (appId parameter) must be provided that matches the AppId for the remote application you registered with the Hue Portal")}return`${this.remoteApi.baseUrl}/oauth2/auth?clientid=${this.clientId}&state=${r}&deviceid=${e}&appid=${t}&response_type=code`}connectWithCode(e,t,r,n,s){const i=this;return i.remoteApi.getToken(e).then(e=>{if(t){return Promise.resolve(t)}else{return i.remoteApi.createRemoteUsername(s,n)}}).then(e=>{return i._getRemoteApi(e,r)})}connectWithTokens(e,t,r,n,s){const i=this;i.remoteApi.setAccessToken(e);i.remoteApi.setRefreshToken(t);let o;if(r){o=Promise.resolve(r)}else{o=i.remoteApi.createRemoteUsername(s)}return o.then(e=>{return i._getRemoteApi(e,n)})}_getRemoteApi(e,t){const r=this,s=`${r.remoteApi.baseUrl}/bridge`,u={remote:true,clientId:this.clientId,clientSecret:this.clientSecret,baseUrl:s,username:e};const a={baseURL:s,headers:{Authorization:`Bearer ${r.remoteApi.accessToken}`},timeout:getTimeout(t)},c=new i(e,n.create(a)),l=new o(u,c,r.remoteApi);return Promise.resolve(l)}};function getTimeout(e){return e||12e3}},4622:(e,t,r)=>{"use strict";const n=r(7356),s=r(1810),i=r(7253),o=r(7516);const u=/node-hue-api/.test(process.env.NODE_DEBUG);const a={maxConcurrent:4,minTime:50};e.exports=class Transport{constructor(e,t,r){this._username=e;this._axios=t;if(u){this._axios.interceptors.request.use(e=>{const t={};["method","baseURL","url","data"].forEach(r=>{if(e[r]){t[r]=e[r]}});console.log(JSON.stringify(t,null,2));return e})}this.configureLimiter(r||a)}configureLimiter(e){this._limiter=new n(e)}get limiter(){return this._limiter}execute(e,t){let r=this,n=this.limiter,i=r._axios,u=Object.assign({username:r._username},t),a;if(!e){throw new Error("An API must be provided")}a=n.schedule(()=>{return i.request(e.getRequest(u))}).catch(e=>{throw extractError(e,e.response)}).then(e=>{const t=o.parseErrors(e.data);if(t){throw new s(t[0])}return e.data});if(e.getErrorHandler()){a=a.catch(e.getErrorHandler())}if(e.getPostProcessing()){a=a.then(t=>{return e.getPostProcessing()(t,u)})}return a}refreshAuthorizationHeader(e){this._axios.defaults.headers.common["Authorization"]=`Bearer ${e}`}};function extractError(e,t){if(!t){throw new s(e.message)}const r=t.headers,n=r?r["www-authenticate"]:null;let o;if(n){const e=/error="(.*?)"/.exec(n),r=/error_description="(.*?)"/.exec(n);o=new i({type:t.status,message:(e?e[1]:t.data)||"Error",description:r?r[1]:null,address:t.config.url})}else{o=new i({type:t.status,error:t.data||"Error",address:t.config.url})}const u=new s(o);return u}},1209:(e,t,r)=>{"use strict";const n=r(2809),s=r(4465);function getAllCapabilities(){return(new n).get().acceptJson().uri("/<username>/capabilities").pureJson().postProcess(buildCapabilities)}e.exports={getAll:getAllCapabilities()};function buildCapabilities(e,t){return s.createFromBridge("capabilities",null,e)}},2415:(e,t,r)=>{"use strict";const n=r(2809),s=r(8378),i=r(7516),o=r(1810),u=r(4465);e.exports={createUser:(new n).post().acceptJson().uri("/").payload(buildUserPayload).pureJson().postProcess(processCreateUser),getConfiguration:(new n).get().acceptJson().uri("/<username>/config").pureJson().postProcess(createBridgeConfiguration),updateConfiguration:(new n).put().acceptJson().uri("/<username>/config").payload(buildConfigurationPayload).pureJson().postProcess(i.wasSuccessful),deleteUser:(new n).delete().acceptJson().uri("/<username>/config/whitelist/<userid>").placeholder(new s("userid")).pureJson().postProcess(i.wasSuccessful),getFullState:(new n).get().acceptJson().uri("/<username>").pureJson(),getUnauthenticatedConfig:(new n).get().acceptJson().uri("/config").pureJson().postProcess(processUnauthenticatedData)};function processCreateUser(e){if(i.wasSuccessful(e)){return e[0].success}else{throw new o(`Failed to create new user: ${JSON.stringify(e)}`)}}function createBridgeConfiguration(e){return u.createFromBridge("configuration",null,e)}function processUnauthenticatedData(e){return{config:e}}function buildUserPayload(e){const t={devicetype:`${e.appName}#${e.deviceName}`};if(e.generateKey){t.generateclientkey=true}return{type:"application/json",body:t}}function buildConfigurationPayload(e){const t=e.config;let r;if(u.isBridgeConfigurationInstance(t)){r=t}else{r=createBridgeConfiguration(t)}return{type:"application/json",body:r.getHuePayload()}}},2809:(e,t,r)=>{"use strict";const n=r(8378);const s=/node-hue-api/.test(process.env["NODE_DEBUG"]);class ApiEndpoint{constructor(){this._data={placeholders:[new n],headers:{}}}placeholder(e){if(e){this._getData().placeholders.push(e)}return this}version(e){this.version=e;return this}uri(e){this._getData().url=e;return this}get(){return this.method("GET")}post(){return this.method("POST")}put(){return this.method("PUT")}delete(){return this.method("DELETE")}method(e){this._getData().method=e;return this}acceptJson(){return this.setHeader("Accept","application/json")}acceptXml(){return this.setHeader("Accept","application/xml")}pureJson(){this._getData().json=true;return this}postProcess(e){if(typeof e==="function"){this._getData().postProcessing=e}return this}errorHandler(e){if(typeof e==="function"){this._getData().errorHandler=e}return this}statusCode(e){this._getData().statusCode=e;return this}setHeader(e,t){this._getData().headers[e]=t;return this}getRequest(e){let t=this,r=Object.assign({},t._getData());r.url=replacePlaceholders(r.url,r.placeholders,e);if(r._payloadFn){let t=r._payloadFn(e),n=r.headers;r.data=t.body;if(t.type){n["Content-Type"]=t.type}}if(s){if(r.placeholders){console.log("URL Placeholders:");r.placeholders.forEach(e=>{console.log(`  ${e.toString()}`)})}if(r.headers){console.log(`Headers: ${JSON.stringify(r.headers)}`)}}if(r.statusCode){r.validateStatus=function(e){return e===r.statusCode}}if(!t.requiresJsonConversion()){r.transformResponse=function(e){return e}}return r}getPostProcessing(){return this._getData().postProcessing}getErrorHandler(){return this._getData().errorHandler}payload(e){this._getData()._payloadFn=e;return this}requiresJsonConversion(){const e=this._getData();return e.json||e.headers&&e.headers["Accept"]==="application/json"}get successCode(){return this._getData().statusCode||200}get headers(){return this._getData().headers}_getData(){return this._data}}e.exports=ApiEndpoint;function replacePlaceholders(e,t,r){let n=e;if(t){t.forEach(function(e){n=e.inject(n,r)})}return n}},7177:(e,t,r)=>{"use strict";const n=r(2809),s=r(1810),i=r(7516),o=r(7069),u=r(4465),a=r(1166);const c=new o;e.exports={getAllGroups:(new n).get().uri("/<username>/groups").acceptJson().pureJson().postProcess(buildGroupsResult),createGroup:(new n).post().uri("/<username>/groups").payload(buildGroupBody).acceptJson().pureJson().postProcess(buildCreateGroupResult),getGroupAttributes:(new n).get().uri("/<username>/groups/<id>").placeholder(c).acceptJson().pureJson().postProcess(buildGroup),setGroupAttributes:(new n).put().uri("/<username>/groups/<id>").placeholder(c).acceptJson().payload(buildGroupAttributeBody).pureJson().postProcess(i.wasSuccessful),setGroupState:(new n).put().uri("/<username>/groups/<id>/action").placeholder(c).payload(buildGroupStateBody).pureJson().postProcess(i.wasSuccessful),deleteGroup:(new n).delete().uri("/<username>/groups/<id>").placeholder(c).pureJson().postProcess(validateGroupDeletion),setStreaming:(new n).put().uri("/<username>/groups/<id>").placeholder(c).payload(buildStreamBody).pureJson().postProcess(i.wasSuccessful)};function buildGroupsResult(e){const t=[];Object.keys(e).forEach(r=>{const n=e[r],s=n.type.toLowerCase(),i=u.createFromBridge(s,r,n);t.push(i)});return t}function buildCreateGroupResult(e){const t=i.parseErrors(e);if(t){throw new s(`Error creating group: ${t[0].description}`,t[0])}return{id:Number(e[0].success.id)}}function buildGroupStateBody(e){if(!e||!e.state){throw new s("A GroupState must be provided")}let t;if(e.state instanceof a){t=e.state}else{t=(new a).populate(e.state)}return{type:"application/json",body:t.getPayload()}}function buildGroupBody(e){const t=e.group;if(!t){throw new s("A group must be provided")}if(!u.isGroupInstance(t)){throw new s("group parameter must be an instance of a Group")}const r={type:"application/json",body:{name:t.name,type:t.type}};if(t.lights){r.body.lights=t.lights}else if(t.type==="Entertainment"){r.body.lights=[]}if(t.class){r.body.class=t.class}else{r.body.recycle=t.recycle}return r}function buildGroupAttributeBody(e){const t={},r=e.group;if(!r){throw new s("A group is required to update attributes")}let n;if(u.isGroupInstance(r)){n=r.getHuePayload()}else{n=r}["name","lights","class"].forEach(e=>{if(n[e]){t[e]=n[e]}});return{type:"application/json",body:t}}function buildStreamBody(e){const t={stream:{active:!!e.active}};return{type:"application/json",body:t}}function buildGroup(e,t){const r=e.type.toLowerCase(),n=c.getValue(t);return u.createFromBridge(r,n,e)}function validateGroupDeletion(e){if(!i.wasSuccessful(e)){throw new s(i.parseErrors(e).join(", "))}return true}},6846:(e,t,r)=>{"use strict";const n=r(2809),s=r(6881),i=r(3243),o=r(1810),u=r(7516),a=r(4465),c=r(9818);const l=new s;e.exports={getAllLights:(new n).version("1.0").get().uri("/<username>/lights").acceptJson().pureJson().postProcess(buildLightsResult),getNewLights:(new n).version("1.0").get().uri("/<username>/lights/new").acceptJson().pureJson(),searchForNewLights:(new n).post().uri("/<username>/lights").acceptJson().pureJson().postProcess(u.wasSuccessful),getLightAttributesAndState:(new n).get().uri("/<username>/lights/<id>").placeholder(l).acceptJson().pureJson().postProcess(injectLightId),setLightAttributes:(new n).put().uri("/<username>/lights/<id>").placeholder(l).acceptJson().pureJson().payload(buildLightNamePayload).postProcess(u.wasSuccessful),setLightState:(new n).put().uri("/<username>/lights/<id>/state").placeholder(l).acceptJson().pureJson().payload(buildLightStateBody).postProcess(validateLightStateResult),deleteLight:(new n).delete().uri("/<username>/lights/<id>").placeholder(l).acceptJson().pureJson()};function buildLightsResult(e){let t=[];if(e){Object.keys(e).forEach(function(r){const n=a.createFromBridge("light",r,e[r]);t.push(n)})}return t}function buildLightNamePayload(e){let t=null;if(e.light){t=e.light}else{t=a.createFromBridge("light",0,{name:e.name})}return{type:"application/json",body:{name:t.name}}}function injectLightId(e,t){const r=l.getValue(t);return Object.assign({id:r},e)}function buildLightStateBody(e){const t=getStateForDevice(e.device,e.state);return{type:"application/json",body:t}}function validateLightStateResult(e){if(!u.wasSuccessful(e)){throw new o(u.parseErrors(e).join(", "))}return true}function getStateForDevice(e,t){if(!e){throw new o("No light device provided")}const r=e.getSupportedStates(),n={};let s;if(t instanceof i){s=t.getPayload()}else{const e=new i;e.populate(t);s=e.getPayload()}if(s.rgb){const t=e.colorGamut;if(!t){throw new o("Cannot set an RGB color on a light that does not support a Color Gamut")}n.xy=c.rgbToXY(s.rgb,t);delete s.rgb}Object.keys(s).forEach(t=>{if(r.indexOf(t)>-1){n[t]=s[t]}else{console.error(`Attempting to set a state ${t} on a light that does not support it, ${e.id}`)}});return n}},252:(e,t,r)=>{"use strict";const n=r(2809),s=r(2458),i=r(4465),o=r(1810),u=r(7516);const a=new s;e.exports={getAll:(new n).get().uri("/<username>/resourcelinks").acceptJson().pureJson().postProcess(buildResourceLinkResults),getResourceLink:(new n).get().uri("/<username>/resourcelinks/<id>").placeholder(a).acceptJson().pureJson().postProcess(buildResourceLink),createResourceLink:(new n).post().uri("/<username>/resourcelinks").payload(createResourceLinkPayload).acceptJson().pureJson().postProcess(buildCreateResourceLinkResult),updateResourceLink:(new n).put().uri("/<username>/resourcelinks/<id>").placeholder(a).payload(buildResourceLinkUpdatePayload).acceptJson().pureJson().postProcess(u.extractUpdatedAttributes),deleteResourceLink:(new n).delete().uri("/<username>/resourcelinks/<id>").placeholder(a).acceptJson().pureJson().postProcess(u.wasSuccessful)};function buildResourceLinkResults(e){const t=[];if(e){Object.keys(e).forEach(r=>{t.push(i.createFromBridge("resourcelink",r,e[r]))})}return t}function buildResourceLink(e,t){if(e){const r=a.getValue(t);return i.createFromBridge("resourcelink",r,e)}return null}function buildCreateResourceLinkResult(e){const t=u.parseErrors(e);if(t){throw new o(`Error creating resourcelink: ${t[0].description}`,t[0])}return{id:Number(e[0].success.id)}}function buildResourceLinkUpdatePayload(e){const t=e.resourceLink;if(!t){throw new o("No ResourceLink provided")}else if(!i.isResourceLinkInstance(t)){throw new o("Must provide a valid ResourceLink object")}const r=buildResourceLinkBody(t);delete r.type;delete r.recycle;delete r.owner;return{type:"application/json",body:r}}function createResourceLinkPayload(e){const t=e.resourceLink;if(!t){throw new o("No ResourceLink provided")}else if(!i.isResourceLinkInstance(t)){throw new o("Must provide a valid ResourceLink object")}const r=buildResourceLinkBody(t);if(!r.links||r.links.length===0){throw new o("You must provide a ResourceLink with some links defined")}return{type:"application/json",body:r}}function buildResourceLinkBody(e){const t=e.getHuePayload();delete t.id;return t}},5113:(e,t,r)=>{"use strict";const n=r(2809),s=r(3383),i=r(4465),o=r(1810),u=r(7516);const a=new s;e.exports={getAll:(new n).get().acceptJson().uri("/<username>/rules").pureJson().postProcess(createAllRulesResult),getRule:(new n).get().acceptJson().uri("<username>/rules/<id>").placeholder(a).pureJson().postProcess(createGetRuleResult),createRule:(new n).post().acceptJson().uri("/<username>/rules").pureJson().payload(createRulePayload).postProcess(getCreateRuleResult),updateRule:(new n).put().acceptJson().uri("/<username>/rules/<id>").placeholder(a).pureJson().payload(createRuleUpdatePayload).postProcess(u.extractUpdatedAttributes),deleteRule:(new n).delete().acceptJson().uri("/<username>/rules/<id>").placeholder(a).pureJson().postProcess(validateRuleDeletion)};function createAllRulesResult(e){let t=[];Object.keys(e).forEach(function(r){const n=i.createFromBridge("rule",r,e[r]);t.push(n)});return t}function createGetRuleResult(e,t){const r=a.getValue(t);return i.createFromBridge("rule",r,e)}function validateRuleDeletion(e){if(!u.wasSuccessful(e)){throw new o(u.parseErrors(e).join(", "))}return true}function createRulePayload(e){const t=e.rule;if(!t){throw new o("No rule provided")}else if(!i.isRuleInstance(t)){throw new o("Must provide a valid Rule object")}const r=t.getHuePayload();validateRulePayloadForBridge(r);return{type:"application/json",body:r}}function createRuleUpdatePayload(e){const t=e.rule;if(!t){throw new o("No rule provided")}else if(!i.isRuleInstance(t)){throw new o("Must provide a valid Rule object")}const r=t.getHuePayload(),n={name:r.name,conditions:r.conditions,actions:r.actions};validateRulePayloadForBridge(n);return{type:"application/json",body:n}}function getCreateRuleResult(e){const t=u.parseErrors(e);if(t){throw new o(`Error creating rule: ${t[0].description}`,t[0])}return{id:e[0].success.id}}function validateRulePayloadForBridge(e){if(!e.name){throw new o("A name must be provided for the Rule")}if(!e.conditions||e.conditions.length<1){throw new o("A Rule must have at least one condition")}if(!e.actions||e.actions.length<1){throw new o("A Rule must have at least one action")}}},9917:(e,t,r)=>{"use strict";const n=r(2809),s=r(3116),i=r(6881),o=r(4465),u=r(9302),a=r(1810),c=r(7516);const l=new s;e.exports={getAll:(new n).get().acceptJson().uri("/<username>/scenes").pureJson().postProcess(buildScenesResult),createScene:(new n).post().acceptJson().uri("/<username>/scenes").pureJson().payload(getCreateScenePayload).postProcess(buildCreateSceneResult),updateScene:(new n).put().acceptJson().uri("/<username>/scenes/<id>").placeholder(new s).pureJson().payload(buildBasicSceneUpdatePayload).postProcess(c.extractUpdatedAttributes),updateSceneLightState:(new n).put().acceptJson().uri("/<username>/scenes/<id>/lightstates/<lightStateId>").placeholder(l).placeholder(new i("lightStateId")).pureJson().payload(buildUpdateSceneLightStatePayload).postProcess(c.extractUpdatedAttributes),getScene:(new n).get().acceptJson().uri("/<username>/scenes/<id>").placeholder(l).pureJson().postProcess(buildSceneResult),deleteScene:(new n).delete().acceptJson().uri("/<username>/scenes/<id>").placeholder(l).pureJson().postProcess(validateSceneDeletion)};function buildScenesResult(e){let t=[];Object.keys(e).forEach(function(r){const n=e[r],s=n.type.toLowerCase();const i=o.createFromBridge(s,r,n);t.push(i)});return t}function buildSceneResult(e,t){const r=e.type.toLowerCase(),n=l.getValue(t);return o.createFromBridge(r,n,e)}function validateSceneDeletion(e){if(!c.wasSuccessful(e)){throw new a(c.parseErrors(e).join(", "))}return true}function getCreateScenePayload(e){const t=e.scene;if(!t){throw new a("No scene provided")}else if(!o.isSceneInstance(t)){throw new a("Must provide a valid Scene object")}const r=t.getHuePayload();delete r.id;delete r.locked;delete r.owner;delete r.lastupdated;delete r.version;return{type:"application/json",body:r}}function buildUpdateSceneLightStatePayload(e){const t=e.lightState;if(!t){throw new a("No SceneLightState provided")}else if(!(t instanceof u)){throw new a("Must provide a valid SceneLightState object")}const r=t.getPayload();return{type:"application/json",body:r}}function buildBasicSceneUpdatePayload(e){const t=e.scene;if(!t){throw new a("No scene provided")}else if(!o.isSceneInstance(t)){throw new a("Must provide a valid Scene object")}const r=t.getHuePayload(),n={};["name","lights","lightstates","storelightstate"].forEach(e=>{const t=r[e];if(t!==null){n[e]=t}});return{type:"application/json",body:n}}function buildCreateSceneResult(e){const t=c.parseErrors(e);if(t){throw new a(`Error creating scene: ${t[0].description}`,t[0])}return{id:e[0].success.id}}},2783:(e,t,r)=>{"use strict";const n=r(2809),s=r(9488),i=r(4465),o=r(1810),u=r(7516);const a=new s;e.exports={getAll:(new n).get().acceptJson().uri("/<username>/schedules").pureJson().postProcess(buildSchedulesResult),createSchedule:(new n).post().acceptJson().uri("/<username>/schedules").pureJson().payload(buildSchedulePayload).postProcess(buildCreateScheduleResult),getScheduleAttributes:(new n).get().uri("/<username>/schedules/<id>").placeholder(a).acceptJson().pureJson().postProcess(buildSchedule),setScheduleAttributes:(new n).put().uri("/<username>/schedules/<id>").placeholder(a).acceptJson().payload(buildUpdateSchedulePayload).pureJson().postProcess(u.extractUpdatedAttributes),deleteSchedule:(new n).delete().acceptJson().uri("/<username>/schedules/<id>").placeholder(a).pureJson().postProcess(u.wasSuccessful)};function buildSchedulesResult(e){let t=[];Object.keys(e).forEach(function(r){t.push(i.createFromBridge("schedule",r,e[r]))});return t}function buildSchedule(e,t){const r=a.getValue(t);return i.createFromBridge("schedule",r,e)}function buildSchedulePayload(e){const t=e.schedule;if(!t){throw new o("Schedule to create must be provided")}else if(!i.isScheduleInstance(t)){throw new o("You must provide a valid instance of a Schedule to be created")}const r=getSchedulePayload(e.username,t);return{type:"application/json",body:r}}function buildUpdateSchedulePayload(e){const t=e.schedule;if(!t){throw new o("Schedule to update must be provided")}else if(!i.isScheduleInstance(t)){throw new o("You must provide a valid instance of a Schedule when updating")}const r=getSchedulePayload(e.username,t);const n={};["name","description","command","localtime","status","autodelete"].forEach(e=>{if(r[e]!==null){n[e]=r[e]}});return{type:"application/json",body:n}}function buildCreateScheduleResult(e){const t=u.parseErrors(e);if(t){throw new o(`Error creating group: ${t[0].description}`,t[0])}const r=e[0].success.id;return{id:a.getValue({id:r})}}function getSchedulePayload(e,t){const r=t.getHuePayload();if(i.timePatterns.isRecurring(r.localtime)){delete r.autodelete}const n=r.command.address;if(!/^\/api\//.test(n)){r.command.address=`/api/${e}${n}`}return r}},2838:(e,t,r)=>{"use strict";const n=r(2809),s=r(412),i=r(4465),o=r(1810),u=r(7516);const a=new s;e.exports={getAllSensors:(new n).get().uri("/<username>/sensors").acceptJson().pureJson().postProcess(buildAllSensorsResult),createSensor:(new n).post().uri("/<username>/sensors").payload(buildSensorPayload).acceptJson().pureJson().postProcess(buildCreateSensorResult),findNewSensors:(new n).post().uri("/<username>/sensors").acceptJson().pureJson().postProcess(u.wasSuccessful),getNewSensors:(new n).get().uri("/<username>/sensors/new").acceptJson().pureJson().postProcess(createNewSensorResponse),getSensor:(new n).get().uri("/<username>/sensors/<id>").placeholder(a).acceptJson().pureJson().postProcess(createSensorResponse),updateSensor:(new n).put().uri("/<username>/sensors/<id>").placeholder(a).payload(createUpdateSensorPayload).acceptJson().pureJson().postProcess(u.wasSuccessful),deleteSensor:(new n).delete().uri("/<username>/sensors/<id>").placeholder(a).acceptJson().pureJson().postProcess(u.wasSuccessful),changeSensorConfig:(new n).put().uri("/<username>/sensors/<id>/config").placeholder(a).payload(buildSensorConfigPayload).acceptJson().pureJson().postProcess(u.wasSuccessful),changeSensorState:(new n).put().uri("/<username>/sensors/<id>/state").placeholder(a).payload(buildSensorStatePayload).acceptJson().pureJson().postProcess(u.extractUpdatedAttributes)};function buildSensorPayload(e){let t=e.sensor;if(!t){throw new o("Sensor to create must be provided")}else if(!i.isSensorInstance(t)){throw new o("You must provide a valid instance of a Sensor to be created")}const r=t.getHuePayload();delete r.id;return{type:"application/json",body:r}}function buildAllSensorsResult(e){const t=[];if(e){Object.keys(e).forEach(r=>{const n=e[r],s=n.type.toLowerCase(),o=i.createFromBridge(s,r,n);t.push(o)})}return t}function createSensorResponse(e,t){const r=a.getValue(t),n=e.type.toLowerCase();return i.createFromBridge(n,r,e)}function createNewSensorResponse(e){const t={lastscan:null,sensors:[]};if(e){Object.keys(e).forEach(r=>{if(r==="lastscan"){t.lastscan=e.lastscan}else{const n=e.type.toLowerCase(),s=i.createFromBridge(n,r,e[r],r);t.sensors.push(s)}})}return t}function createUpdateSensorPayload(e){if(!e||!e.name){throw new o("A name must be provided")}return{type:"application/json",body:{name:e.name}}}function buildCreateSensorResult(e){const t=u.parseErrors(e);if(t){throw new o(`Error creating group: ${t[0].description}`,t[0])}return{id:Number(e[0].success.id)}}function buildSensorConfigPayload(e){if(!e||!e.sensor){throw new o("A sensor must be provided")}if(!i.isSensorInstance(e.sensor)){throw new o("Sensor parameter is not a valid type, must be a Sensor")}const t=e.sensor.getHuePayload(),r=t.config;delete r.reachable;return{type:"application/json",body:r}}function buildSensorStatePayload(e){if(!e||!e.sensor){throw new o("A sensor must be provided")}if(!i.isSensorInstance(e.sensor)){throw new o("Sensor parameter is not a valid type, must be a Sensor")}let t;if(e.filterStateNames){t={};e.filterStateNames.forEach(r=>{t.stateName=e.sensor.state[r]})}else{t=e.sensor.getHuePayload().state}delete t.lastupdated;return{type:"application/json",body:t}}},4305:(e,t,r)=>{"use strict";const n=r(9734),s=r(507),i=r(620);e.exports.createRemote=function(e,t){return new n(e,t)};e.exports.createLocal=function(e,t){return new s(e,t)};e.exports.createInsecureLocal=function(e,t){return new i(e,t)}},8857:(e,t,r)=>{"use strict";const n=r(2353),s=r(996);const i=[s.uint16({name:"proxyport"}),s.string({name:"proxyaddress",minLength:0,maxLength:40}),s.string({name:"name",minLength:4,maxLength:16}),s.boolean({name:"linkbutton"}),s.string({name:"ipaddress"}),s.string({name:"netmask"}),s.string({name:"gateway"}),s.boolean({name:"dhcp"}),s.string({name:"timezone"}),s.boolean({name:"touchlink"}),s.choice({name:"zigbeechannel",validValues:[11,15,20,25]}),s.string({name:"UTC"}),s.string({name:"localtime"}),s.object({name:"swupdate2",types:[s.boolean({name:"checkforupdate"}),s.string({name:"lastchange"}),s.choice({name:"state",validValues:["unknown","noupdates","transferring","anyreadytoinstall","allreadytoinstall","installing"]}),s.object({name:"autoinstall",types:[s.string({name:"updatetime"}),s.boolean({name:"on"})]}),s.object({name:"bridge",types:[s.string({name:"state"}),s.string({name:"lastinstall"})]})]}),s.object({name:"whitelist"}),s.boolean({name:"portalservices"}),s.string({name:"portalconnection"}),s.object({name:"portalstate",types:[s.boolean({name:"signedon"}),s.boolean({name:"incoming"}),s.boolean({name:"outgoing"}),s.string({name:"communication"})]}),s.object({name:"internetservices",types:[s.choice({name:"internet",validValues:["connected","disconnected"]}),s.choice({name:"remoteaccess",validValues:["connected","disconnected"]}),s.choice({name:"time",validValues:["connected","disconnected"]}),s.choice({name:"swupdate",validValues:["connected","disconnected"]})]}),s.object({name:"backup",types:[s.choice({name:"status",validValues:["idle","startmigration","fileready_disabled","prepare_restore","restoring"]}),s.uint8({name:"errorcode"})]}),s.string({name:"apiversion"}),s.string({name:"swversion"}),s.string({name:"mac"}),s.string({name:"modelid"}),s.string({name:"bridgeid"}),s.boolean({name:"factorynew"}),s.string({name:"replacesbridgeid"}),s.string({name:"datastoreversion"}),s.string({name:"starterkitid"})];e.exports=class BridgeConfiguration extends n{constructor(){super(i)}set proxyport(e){return this.setAttributeValue("proxyport",e)}set proxyaddress(e){return this.setAttributeValue("proxyaddress",e)}set name(e){return this.setAttributeValue("name",e)}set linkbutton(e){return this.setAttributeValue("linkbutton",e)}set ipaddress(e){return this.setAttributeValue("ipaddress",e)}set netmask(e){return this.setAttributeValue("netmask",e)}set gateway(e){return this.setAttributeValue("gateway",e)}set dhcp(e){return this.setAttributeValue("dhcp",e)}set timezone(e){return this.setAttributeValue("timezone",e)}set touchlink(e){return this.setAttributeValue("touchlink",e)}set zigbeechannel(e){return this.setAttributeValue("zigbeechannel",e)}set UTC(e){return this.setAttributeValue("UTC",e)}get portalservices(){return this.getAttributeValue("portalservices")}get portalconnection(){return this.getAttributeValue("portalconnection")}get portalstate(){return this.getAttributeValue("portalstate")}get localtime(){return this.getAttributeValue("localtime")}get proxyport(){return this.getAttributeValue("proxyport")}get proxyaddress(){return this.getAttributeValue("proxyaddress")}get name(){return this.getAttributeValue("name")}get linkbutton(){return this.getAttributeValue("linkbutton")}get ipaddress(){return this.getAttributeValue("ipaddress")}get netmask(){return this.getAttributeValue("netmask")}get gateway(){return this.getAttributeValue("gateway")}get dhcp(){return this.getAttributeValue("dhcp")}get timezone(){return this.getAttributeValue("timezone")}get zigbeechannel(){return this.getAttributeValue("zigbeechannel")}get UTC(){return this.getAttributeValue("UTC")}get swupdate2(){return this.getAttributeValue("swupdate2")}get whitelist(){return this.getAttributeValue("whitelist")}get internetservices(){return this.getAttributeValue("internetservices")}get backup(){return this.getAttributeValue("backup")}get apiversion(){return this.getAttributeValue("apiversion")}get swversion(){return this.getAttributeValue("swversion")}get mac(){return this.getAttributeValue("mac")}get modelid(){return this.getAttributeValue("modelid")}get bridgeid(){return this.getAttributeValue("bridgeid")}get factorynew(){return this.getAttributeValue("factorynew")}get replacesbridgeid(){return this.getAttributeValue("replacesbridgeid")}get datastoreversion(){return this.getAttributeValue("datastoreversion")}get starterkitid(){return this.getAttributeValue("starterkitid")}}},2353:(e,t,r)=>{"use strict";const n=r(1810);e.exports=class BridgeObject{constructor(e){this._attributes={};this._data={};e.forEach(e=>{this._attributes[e.name]=e})}getAttributeValue(e){const t=this._attributes[e];if(t){return t.getValue(this._data[e])}else{throw new n(`Requesting value for invalid attribute '${e}'`)}}setAttributeValue(e,t){const r=this._attributes[e];if(r){this._data[r.name]=r.getValue(t)}else{throw new n(`Attempted to set attribute '${e}', but do not have a definition registered`)}return this}toString(){return`${this.constructor.name}`}toStringDetailed(){let e=`${this.constructor.name}`;Object.keys(this._data).forEach(t=>{e+=`\n  ${t}: ${JSON.stringify(this._data[t])}`});return e}getJsonPayload(){const e=this._bridgeData;e.node_hue_api={type:this.constructor.name.toLowerCase(),version:1};return e}getHuePayload(){const e={};Object.keys(this._attributes).forEach(t=>{const r=this.getAttributeValue(t);if(r!==null&&r!==undefined){e[t]=r}});return e}get _bridgeData(){return Object.assign({},this._data)}_populate(e){const t=this;if(e){Object.keys(e).forEach(r=>{if(t._attributes[r]){t.setAttributeValue(r,e[r])}})}this._populationData=e;return t}}},2374:(e,t,r)=>{"use strict";const n=r(2353),s=r(1810);e.exports=class BridgeObjectWithId extends n{constructor(e,t){super(e);if(!this._attributes.id){throw new s('All bridge objects must have an "id" definition')}this.setAttributeValue("id",t)}get id(){return this.getAttributeValue("id")}}},109:(e,t,r)=>{"use strict";const n=r(2353),s=r(996);const i=[s.object({name:"lights",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"sensors",types:[s.uint16({name:"available"}),s.uint16({name:"total"}),s.object({name:"clip",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"zll",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"zgp",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]})]}),s.object({name:"groups",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"scenes",types:[s.uint16({name:"available"}),s.uint16({name:"total"}),s.object({name:"lightstates",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]})]}),s.object({name:"schedules",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"rules",types:[s.uint16({name:"available"}),s.uint16({name:"total"}),s.object({name:"conditions",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"actions",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]})]}),s.object({name:"resourcelinks",types:[s.uint16({name:"available"}),s.uint16({name:"total"})]}),s.object({name:"streaming",types:[s.uint16({name:"available"}),s.uint16({name:"total"}),s.uint16({name:"channels"})]}),s.object({name:"timezones",types:[s.list({name:"values",minEntries:0,listType:s.string({name:"timezone"})})]})];e.exports=class Capabilities extends n{constructor(){super(i)}get lights(){return this.getAttributeValue("lights")}get sensors(){return this.getAttributeValue("sensors")}get groups(){return this.getAttributeValue("groups")}get scenes(){return this.getAttributeValue("scenes")}get schedules(){return this.getAttributeValue("schedules")}get rules(){return this.getAttributeValue("rules")}get resourceLinks(){return this.getAttributeValue("resourcelinks")}get resourcelinks(){return this.getAttributeValue("resourcelinks")}get streaming(){return this.getAttributeValue("streaming")}get timezones(){return this.getAttributeValue("timezones").values}}},5697:(e,t,r)=>{"use strict";const n=r(2374),s=r(1040),i=r(996),o=r(7516);const u={LCT001:"B",LCT007:"B",LCT010:"C",LCT014:"C",LCT015:"C",LCT016:"C",LCT002:"B",LCT003:"B",LCT011:"C",LTW011:"2200K-6500K",LST001:"A",LLC010:"A",LLC011:"A",LLC012:"A",LLC006:"A",LLC005:"A",LLC007:"A",LLC014:"A",LLC013:"A",LLM001:"B",LLM010:"2200K-6500K",LLM011:"2200K-6500K",LTW001:"2200K-6500K",LTW004:"2200K-6500K",LTW010:"2200K-6500K",LTW015:"2200K-6500K",LTW013:"2200K-6500K",LTW014:"2200K-6500K",LLC020:"C",LST002:"C",LCT012:"C",LTW012:"2200K-6500K",LTP001:"2200K-6500K",LTP002:"2200K-6500K",LTP003:"2200K-6500K",LTP004:"2200K-6500K",LTP005:"2200K-6500K",LTF001:"2200K-6500K",LTF002:"2200K-6500K",LTC001:"2200K-6500K",LTC002:"2200K-6500K",LTC003:"2200K-6500K",LTC004:"2200K-6500K",LTC011:"2200K-6500K",LTC012:"2200K-6500K",LTD001:"2200K-6500K",LTD002:"2200K-6500K",LFF001:"2200K-6500K",LTT001:"2200K-6500K",LDT001:"2200K-6500K"};const a=[i.uint8({name:"id"}),i.string({name:"name",min:0,max:32}),i.string({name:"type"}),i.string({name:"modelid"}),i.string({name:"manufacturername"}),i.string({name:"uniqueid"}),i.string({name:"productname"}),i.string({name:"productid"}),i.object({name:"state"}),i.object({name:"capabilities"}),i.object({name:"config"}),i.object({name:"swupdate",types:[i.string({name:"state"}),i.string({name:"lastinstall"})]}),i.string({name:"swversion"}),i.string({name:"swconfigid"})];e.exports=class Light extends n{constructor(e){super(a,e)}get id(){return this.getAttributeValue("id")}get name(){return this.getAttributeValue("name")}set name(e){return this.setAttributeValue("name",e)}get type(){return this.getAttributeValue("type")}get modelid(){return this.getAttributeValue("modelid")}get manufacturername(){return this.getAttributeValue("manufacturername")}get uniqueid(){return this.getAttributeValue("uniqueid")}get productid(){return this.getAttributeValue("productid")}get productname(){return this.getAttributeValue("productname")}get swversion(){return this.getAttributeValue("swversion")}get swupdate(){return this.getAttributeValue("swupdate")}get state(){return this.getAttributeValue("state")}get capabilities(){return this.getAttributeValue("capabilities")}get colorGamut(){if(this.mappedColorGamut&&this.mappedColorGamut!=="2200K-6500K"){return s.getColorGamut(this.mappedColorGamut)}else{return null}}getSupportedStates(){const e=Object.keys(this.state);e.push("transitiontime");["bri","sat","hue","ct","xy"].forEach(t=>{if(e.indexOf(t)>-1){e.push(`${t}_inc`)}});return e}_populate(e){if(e){this.mappedColorGamut=getColorGamut(e)}else{this.mappedColorGamut=null}return super._populate(e)}};function getColorGamut(e){let t=o.getValueForKey("capabilities.control.colorgamuttype",e);if(!t){t=u[e.modelid]}return t}},3526:(e,t,r)=>{"use strict";const n=r(1810),s=r(2374),i=r(996);const o=["lights","sensors","groups","scenes","rules","schedules","resourcelinks"];const u=[i.uint16({name:"id"}),i.string({name:"name",min:1,max:32}),i.string({name:"description",min:0,max:64}),i.choice({name:"type",validValues:["Link"],defaultValue:"Link"}),i.uint16({name:"classid"}),i.string({name:"owner"}),i.boolean({name:"recycle"})];e.exports=class ResourceLink extends s{constructor(e){super(u,e);this.resetLinks()}set name(e){return this.setAttributeValue("name",e)}get name(){return this.getAttributeValue("name")}get description(){return this.getAttributeValue("description")}set description(e){return this.setAttributeValue("description",e)}get type(){return this.getAttributeValue("type")}get classid(){return this.getAttributeValue("classid")}set classid(e){return this.setAttributeValue("classid",e)}get owner(){return this.getAttributeValue("owner")}get recycle(){return this.getAttributeValue("recycle")}set recycle(e){return this.setAttributeValue("recycle",e)}get links(){return Object.assign({},this._links)}resetLinks(){this._links={};return this}addLink(e,t){const r=this._links,n=validateLinkType(e);if(!r[n]){r[n]=[]}r[n].push(t);return this}removeLink(e,t){const r=this._links,n=validateLinkType(e),s=r[n];if(s){const e=s.indexOf(`${t}`);if(e>-1){s.splice(e,1)}}return this}toStringDetailed(){let e=super.toStringDetailed();const t=this.links;e+=`\n  links: ${JSON.stringify(t)}`;return e}getJsonPayload(){const e=this.links,t=super.getJsonPayload();t.links=JSON.parse(JSON.stringify(e));return t}getHuePayload(){const e=super.getHuePayload(),t=this.links,r=[];Object.keys(t).forEach(e=>{const n=t[e];if(n){n.forEach(t=>{r.push(`/${e}/${t}`)})}});e.links=r;return e}_populate(e){const t=Object.assign({},e);const r=t.links;delete t.links;super._populate(t);this._links=processLinks(r);return this}};function processLinks(e){const t={};if(e){if(Array.isArray(e)){e.forEach(e=>{const r=/\/(.*)\/(.*)/.exec(e),n=r[1],s=r[2];const i=validateLinkType(n);let o=t[i];if(!o){o=[];t[i]=o}o.push(s)})}else{Object.keys(e).forEach(r=>{const n=validateLinkType(r);let s=e[r];t[n]=s})}}return t}function validateLinkType(e){if(!e){throw new n("A ResourceLink Type must be provided")}const t=e.toLowerCase(),r=o.indexOf(t);if(r===-1){throw new n(`Invalid resource link type ${e}`)}return t}},7631:(e,t,r)=>{"use strict";const n=r(2374),s=r(996);const i=[s.uint8({name:"id"}),s.string({name:"name",min:0,max:32,optional:true}),s.string({name:"description",min:0,max:64,optional:true}),s.object({name:"command",optional:false,types:[s.string({name:"address",optional:false}),s.choice({name:"method",optional:false,validValues:["POST","PUT","DELETE"]}),s.object({name:"body",optional:false})]}),s.string({name:"time"}),s.timePattern({name:"localtime"}),s.string({name:"created"}),s.choice({name:"status",validValues:["enabled","disabled"],defaultValue:"enabled"}),s.boolean({name:"autodelete"}),s.boolean({name:"recycle",defaultValue:false}),s.string({name:"starttime"})];e.exports=class Schedule extends n{constructor(e){super(i,e)}get name(){return this.getAttributeValue("name")}set name(e){return this.setAttributeValue("name",e)}get description(){return this.getAttributeValue("description")}set description(e){return this.setAttributeValue("description",e)}get command(){return this.getAttributeValue("command")}set command(e){return this.setAttributeValue("command",e)}get time(){return this.getAttributeValue("time")}get localtime(){return this.getAttributeValue("localtime")}set localtime(e){return this.setAttributeValue("localtime",e)}get status(){return this.getAttributeValue("status")}set status(e){return this.setAttributeValue("status",e)}get autodelete(){return this.getAttributeValue("autodelete")}set autodelete(e){return this.setAttributeValue("autodelete",e)}get recycle(){return this.getAttributeValue("recycle")}set recycle(e){return this.setAttributeValue("recycle",e)}get created(){return this.getAttributeValue("created")}}},2162:(e,t,r)=>{"use strict";const n=r(2353),s=r(996),i=r(7516),o=r(1810);const u=[s.choice({name:"method",validValues:["PUT","POST","DELETE"]}),s.choice({name:"target",validValues:["rule","schedule"]})];e.exports=class BridgeAction extends n{constructor(e,t){super(i.flatten(u,e));this.withMethod(t)}get method(){return this.getAttributeValue("method")}get isRuleAction(){return this.getAttributeValue("target")==="rule"}get isScheduleAction(){return this.getAttributeValue("target")==="schedule"}withMethod(e){return this.setAttributeValue("method",e)}get payload(){return{address:this.address,method:this.method,body:this.body}}toString(){return JSON.stringify(this.payload)}}},7134:(e,t,r)=>{"use strict";const n=r(2162),s=r(1166),i=r(1810),o=r(996),u=r(7069);const a=new u;const c=[o.uint8({name:"group"}),o.object({name:"state"})];e.exports=class GroupStateAction extends n{constructor(e){super(c,"PUT");this.group=e}get address(){return`/groups/${this.group}/action`}get group(){return this.getAttributeValue("group")}set group(e){const t=a.getValue({id:e});this.setAttributeValue("group",t)}withState(e){let t=e;if(!(e instanceof s)){t=(new s).populate(e)}this.setAttributeValue("state",t.getPayload());return this}get body(){const e=this.getAttributeValue("state");if(e){return e}throw new i("No state has been set on the GroupStateAction")}}},9737:(e,t,r)=>{"use strict";const n=r(2162),s=r(3243),i=r(1810),o=r(996),u=r(6881);const a=new u;const c=[o.uint8({name:"light"}),o.object({name:"body"}),o.object({name:"state"})];e.exports=class LightStateAction extends n{constructor(e){super(c,"PUT");this.light=e}get address(){return`/lights/${this.light}/state`}get light(){return this.getAttributeValue("light")}set light(e){const t=a.getValue({id:e});this.setAttributeValue("light",t)}withState(e){let t=e;if(!(e instanceof s)){t=(new s).populate(e)}this.setAttributeValue("state",t.getPayload());return this}get body(){const e=this.getAttributeValue("state");if(e){return e}throw new i("No state has been set on the LightStateAction")}}},3431:(e,t,r)=>{"use strict";const n=r(2162),s=r(1810),i=r(996),o=r(3116);const u=new o;const a=[i.string({name:"scene"}),i.object({name:"body"}),i.object({name:"state"})];e.exports=class SceneAction extends n{constructor(e){super(a,"PUT");this.scene=e}get address(){return`/scenes/${this.scene}`}get scene(){return this.getAttributeValue("scene")}set scene(e){const t=u.getValue({id:e});this.setAttributeValue("scene",t)}withState(e){this.setAttributeValue("state",e);return this}get body(){const e=this.getAttributeValue("state");if(e){return e}throw new s("No state has been set on the SceneAction")}}},2799:(e,t,r)=>{"use strict";const n=r(2162),s=r(1810);e.exports=class ScheduleStateAction extends n{constructor(e){super(e,"PUT");this._state=null}get address(){if(this.id===null||this.id===undefined){return"/schedules"}return`/schedules/${this.id}`}withState(e){this._state=e;return this}get body(){if(this._state){return this._state}throw new s("No state has been set on the Rule Action")}}},4383:(e,t,r)=>{"use strict";const n=r(2162),s=r(1810),i=r(996),o=r(412);const u=new o;const a=[i.uint8({name:"sensor"}),i.object({name:"body"}),i.object({name:"state"})];e.exports=class SensorStateAction extends n{constructor(e){super(a,"PUT");this.sensor=e}get address(){return`/sensors/${this.sensor}/state`}get sensor(){return this.getAttributeValue("sensor")}set sensor(e){const t=u.getValue({id:e});this.setAttributeValue("sensor",t)}withState(e){this.setAttributeValue("state",e);return this}get body(){const e=this.getAttributeValue("state");if(e){return e}throw new s("No state has been set on the SensorStateAction")}}},5269:(e,t,r)=>{"use strict";const n=r(1810),s=r(2162),i=r(9737),o=r(7134),u=r(4383),a=r(3431),c=r(2799);const l=/\/groups\/(.*)\/action/,h=/\/sensors\/(.*)\/state/,d=/\/lights\/(.*)\//,p=/\/schedules\/(.*)/,g=/\/schedules$/,f=/\/scenes\/(.*)/;e.exports.create=function(e){if(e){if(e instanceof s){return e}else if(e.address){if(l.exec(e.address)){return createGroupAction(e.address,e.body)}else if(d.exec(e.address)){return createLightStateAction(e.address,e.body)}else if(h.exec(e.address)){return createSensorStateAction(e.address,e.body)}else if(f.exec(e.address)){return createSceneAction(e.address,e.body)}else if(p.exec(e.address)){return createScheduleAction(e.address,e.body)}else if(g.exec(e.address)){return createSchedulesAction(e.address,e.body)}else{throw new n(`Failed to match an action to the address ${e.address}`)}}else{throw new n("No address property for action")}}else{throw new n("No data provided to build a RuleAction instance from.")}};function createLightStateAction(e,t){const r=d.exec(e),n=r[1];return new i(n).withState(t)}function createGroupAction(e,t){const r=l.exec(e),n=r[1];return new o(n).withState(t)}function createSensorStateAction(e,t){const r=h.exec(e),n=r[1];return new u(n).withState(t)}function createScheduleAction(e,t){const r=p.exec(e),n=r[1];return new c(n).withState(t)}function createSchedulesAction(e,t){const r=g.exec(e);if(!r){throw new n(`Not a valid schedules action, '${e}'`)}return new c(null).withState(t)}function createSceneAction(e,t){const r=f.exec(e),s=r[1];if(!r){throw new n(`Not a valid scenes action, '${e}'`)}return new a(s).withState(t)}},1040:e=>{"use strict";const t={A:{red:{x:.704,y:.296},green:{x:.2151,y:.7106},blue:{x:.138,y:.08}},B:{red:{x:.675,y:.322},green:{x:.409,y:.518},blue:{x:.167,y:.04}},C:{red:{x:.692,y:.308},green:{x:.17,y:.7},blue:{x:.153,y:.048}}};e.exports=t;e.exports.getColorGamut=(e=>{return t[e]})},5245:(e,t,r)=>{"use strict";const n=r(3895),s=r(996);const i=[s.string({name:"type",defaultValue:"Entertainment"}),s.choice({name:"class",defaultValue:"TV",validValues:["TV","Other"]}),s.object({name:"stream",types:[s.string({name:"proxymode"}),s.string({name:"proxynode"}),s.boolean({name:"active"}),s.string({name:"owner"})]}),s.object({name:"locations"}),s.list({name:"lights",minEntries:0,listType:s.string({name:"lightId"})})];e.exports=class Entertainment extends n{constructor(e){super(i,e)}set lights(e){return this.setAttributeValue("lights",e)}get lights(){return this.getAttributeValue("lights")}set class(e){return this.setAttributeValue("class",e)}get class(){return this.getAttributeValue("class")}get stream(){return this.getAttributeValue("stream")}get locations(){return this.getAttributeValue("locations")}}},3895:(e,t,r)=>{"use strict";const n=r(2374),s=r(1810),i=r(996),o=r(7516);const u=["Living room","Kitchen","Dining","Bedroom","Kids bedroom","Bathroom","Nursery","Recreation","Office","Gym","Hallway","Toilet","Front door","Garage","Terrace","Garden","Driveway","Carport","Other","Home","Downstairs","Upstairs","Top floor","Attic","Guest room","Staircase","Lounge","Man cave","Computer","Studio","Music","TV","Reading","Closet","Storage","Laundry room","Balcony","Porch","Barbecue","Pool"];const a=[i.int8({name:"id"}),i.string({name:"name",min:0,max:32}),i.list({name:"sensors",minEntries:0,listType:i.string({name:"sensorId"})}),i.object({name:"action"}),i.object({name:"state",types:[i.boolean({name:"all_on"}),i.boolean({name:"any_on"})]}),i.object({name:"presence",types:[i.string({name:"lastupdated"}),i.boolean({name:"presence"}),i.boolean({name:"presence_all"})]}),i.object({name:"lightlevel",types:[i.string({name:"lastupdated"}),i.boolean({name:"dark"}),i.boolean({name:"dark_all"}),i.boolean({name:"daylight"}),i.boolean({name:"daylight_any"}),i.uint16({name:"lightlevel"}),i.uint16({name:"lightlevel_min"}),i.uint16({name:"lightlevel_max"})]}),i.boolean({name:"recycle",defaultValue:false})];e.exports=class Group extends n{constructor(e,t){super(o.flatten(a,e),t);if(!this._attributes.type){throw new s("Missing a valid type attribute for the Group")}if(!this._attributes.lights){throw new s("Missing a valid lights attribute for the Group")}}get name(){return this.getAttributeValue("name")}set name(e){return this.setAttributeValue("name",e)}set sensors(e){return this.setAttributeValue("sensors",e)}get sensors(){return this.getAttributeValue("sensors")}get type(){return this.getAttributeValue("type")}get action(){return this.getAttributeValue("action")}get recycle(){return this.getAttributeValue("recycle")}get state(){return this.getAttributeValue("state")}static getAllGroupClasses(){return u}}},2468:(e,t,r)=>{"use strict";const n=r(3895),s=r(996);const i=[s.string({name:"type",defaultValue:"LightGroup"}),s.list({name:"lights",minEntries:1,listType:s.string({name:"lightId"})})];e.exports=class LightGroup extends n{constructor(e){super(i,e)}set lights(e){return this.setAttributeValue("lights",e)}get lights(){return this.getAttributeValue("lights")}}},3782:(e,t,r)=>{"use strict";const n=r(3895),s=r(996);const i=[s.string({name:"type",defaultValue:"Lightsource"}),s.list({name:"lights",minEntries:1,listType:s.string({name:"lightId"})})];e.exports=class Luminaire extends n{constructor(e){super(i,e)}get lights(){return this.getAttributeValue("lights")}}},7682:(e,t,r)=>{"use strict";const n=r(3895),s=r(996);const i=[s.string({name:"type",defaultValue:"Luminaire"}),s.list({name:"lights",minEntries:1,listType:s.string({name:"lightId"})})];e.exports=class Luminaire extends n{constructor(e){super(i,e)}get lights(){return this.getAttributeValue("lights")}}},633:(e,t,r)=>{"use strict";const n=r(3895),s=r(996);const i=[s.string({name:"type",defaultValue:"Room"}),s.choice({name:"class",defaultValue:"Other",validValues:n.getAllGroupClasses()}),s.list({name:"lights",minEntries:0,listType:s.string({name:"lightId"})})];e.exports=class Room extends n{constructor(e){super(i,e)}get lights(){return this.getAttributeValue("lights")}set lights(e){return this.setAttributeValue("lights",e)}set class(e){return this.setAttributeValue("class",e)}get class(){return this.getAttributeValue("class")}}},3080:(e,t,r)=>{"use strict";const n=r(3895),s=r(996);const i=[s.string({name:"type",defaultValue:"Zone"}),s.choice({name:"class",defaultValue:"Other",validValues:n.getAllGroupClasses()}),s.list({name:"lights",minEntries:0,listType:s.string({name:"lightId"})})];e.exports=class Zone extends n{constructor(e){super(i,e)}get lights(){return this.getAttributeValue("lights")}set lights(e){return this.setAttributeValue("lights",e)}set class(e){return this.setAttributeValue("class",e)}get class(){return this.getAttributeValue("class")}}},4465:(e,t,r)=>{"use strict";const n=r(1810),s=r(7516),i=r(2217),o=r(2499),u=r(109),a=r(8857),c=r(5697),l=r(3895),h=r(5245),d=r(2468),p=r(3782),g=r(7682),f=r(633),m=r(3080),_=r(3526),y=r(3299),b=r(5875),v=r(888),w=r(7631),x=r(8326),A=r(3109),S=r(449),k=r(7134),V=r(9737),C=r(4383),R=r(3431),T=r(5114),L=r(4226),P=r(3450),B=r(4107),E=r(8964),j=r(3942),I=r(4120),D=r(268),O=r(5638),q=r(5993),U=r(6153),F=r(8105),N=r(8055),G=r(7128),$=r(8776),M=r(5543);const J={light:c,capabilities:u,configuration:a,entertainment:h,lightgroup:d,lightsource:p,luminaire:g,room:f,zone:m,resourcelink:_,lightscene:b,groupscene:v,schedule:w,rule:x,clipgenericflag:P,clipgenericstatus:B,cliphumidity:E,cliplightlevel:j,clipopenclose:I,clippresence:D,clipswitch:O,cliptemperature:q,daylight:U,zgpswitch:F,zlllightlevel:N,zllpresence:G,zllswitch:$,zlltemperature:M};e.exports.lightStates=i;e.exports.timePatterns=o;e.exports.isLightInstance=function(e){return e instanceof c};e.exports.isSceneInstance=function(e){return e instanceof y};e.exports.isGroupSceneInstance=function(e){return e instanceof v};e.exports.isLightSceneInstance=function(e){return e instanceof b};e.exports.isRuleInstance=function(e){return e instanceof x};e.exports.isResourceLinkInstance=function(e){return e instanceof _};e.exports.isScheduleInstance=function(e){return e instanceof w};e.exports.isSensorInstance=function(e){return e instanceof L};e.exports.isGroupInstance=function(e){return e instanceof l};e.exports.isBridgeConfigurationInstance=function(e){return e instanceof a};e.exports.createBridgeConfiguration=function(){return new a};e.exports.createEntertainment=function(){return new h};e.exports.createLightGroup=function(){return new d};e.exports.createRoom=function(){return new f};e.exports.createZone=function(){return new m};e.exports.createCLIPGenericFlagSensor=function(){return new P};e.exports.createCLIPGenericStatusSensor=function(){return new B};e.exports.createCLIPHumiditySensor=function(){return new E};e.exports.createCLIPLightlevelSensor=function(){return new j};e.exports.createCLIPOpenCloseSensor=function(){return new I};e.exports.createCLIPPresenceSensor=function(){return new D};e.exports.createCLIPTemperatureSensor=function(){return new q};e.exports.createCLIPSwitchSensor=function(){return new O};e.exports.createLightScene=function(){return new b};e.exports.createGroupScene=function(){return new v};e.exports.createSchedule=function(){return new w};e.exports.actions={light:function(e){return new V(e)},group:function(e){return new k(e)},sensor:function(e){return new C(e)},scene:function(e){return new R(e)}};e.exports.createRule=function(){return new x};e.exports.ruleConditions={sensor:function(e){return new A(e)},group:function(e){return new S(e)}};e.exports.ruleConditionOperators=T;e.exports.ruleActions={light:function(e){s.deprecatedFunction("5.x","model.ruleActions.light(light)","Use model.actions.light(light) instead");return new V(e)},group:function(e){s.deprecatedFunction("5.x","model.ruleActions.group(group)","Use model.actions.group(group) instead");return new k(e)},sensor:function(e){s.deprecatedFunction("5.x","model.ruleActions.sensor(sensor)","Use model.actions.sensor(sensor) instead");return new C(e)},scene:function(e){s.deprecatedFunction("5.x","model.ruleActions.scene(scene)","Use model.actions.scene(scene) instead");return new R(e)}};e.exports.createResourceLink=function(){return new _};e.exports.createFromBridge=function(e,t,r){const s=J[e];if(!s){throw new n(`Unknown type '${e}' to create Bridge Model Object from.`)}const i=new s(t);i._populate(r);return i};e.exports.createFromJson=function(t){if(!t){throw new n("No payload provided to build object from")}const r=t.node_hue_api;if(!r){throw new n("Missing payload Data Type definition")}const s=r.type,i=r.version||0;if(!s){throw new n("Invalid payload, missing type from the Data Type")}if(i===0){throw new n(`Unsupported version number ${i}, for JSON payload`)}return e.exports.createFromBridge(s,t.id,t)}},4680:(e,t,r)=>{"use strict";const n=r(1668);class BaseStates extends n{constructor(){super("on","bri","hue","sat","xy","ct","effect","transitiontime",Array.from(arguments))}on(e){if(e!==undefined){return this._setStateValue("on",e)}else{return this._setStateValue("on",true)}}off(){return this._setStateValue("on",false)}bri(e){return this._setStateValue("bri",e)}hue(e){return this._setStateValue("hue",e)}sat(e){return this._setStateValue("sat",e)}xy(e,t){if(Array.isArray(e)){return this._setStateValue("xy",e)}else{return this._setStateValue("xy",[e,t])}}ct(e){return this._setStateValue("ct",e)}effect(e){return this._setStateValue("effect",e)}transitiontime(e){return this._setStateValue("transitiontime",e)}brightness(e){const t=this._convertPercentageToStateValue(e,"bri");return this.bri(t)}saturation(e){const t=this._convertPercentageToStateValue(e,"sat");return this.sat(t)}effectColorLoop(){return this.effect("colorloop")}effectNone(){return this.effect("none")}transition(e){return this.transitionInMillis(e)}transitionSlow(){return this.transitiontime(8)}transitionFast(){return this.transitiontime(2)}transitionInstant(){return this.transitiontime(0)}transitionInMillis(e){return this.transitiontime(e/100)}transitionDefault(){return this.transitiontime(4)}}e.exports=BaseStates},337:(e,t,r)=>{"use strict";const n=r(4680);class CommonStates extends n{constructor(){super("alert","bri_inc","sat_inc","hue_inc","ct_inc","xy_inc",Array.from(arguments))}alert(e){return this._setStateValue("alert",e)}bri_inc(e){return this._setStateValue("bri_inc",e)}sat_inc(e){return this._setStateValue("sat_inc",e)}hue_inc(e){return this._setStateValue("hue_inc",e)}ct_inc(e){return this._setStateValue("ct_inc",e)}xy_inc(e,t){if(Array.isArray(e)){return this._setStateValue("xy_inc",e)}else{return this._setStateValue("xy_inc",[e,t])}}alertLong(){return this.alert("lselect")}alertShort(){return this.alert("select")}alertNone(){return this.alert("none")}}e.exports=CommonStates;CommonStates.prototype.incrementBrightness=CommonStates.prototype.bri_inc;CommonStates.prototype.incrementSaturation=CommonStates.prototype.sat_inc;CommonStates.prototype.incrementHue=CommonStates.prototype.hue_inc;CommonStates.prototype.incrementCt=CommonStates.prototype.ct_inc;CommonStates.prototype.incrementColorTemp=CommonStates.prototype.ct_inc},1166:(e,t,r)=>{"use strict";const n=r(337);e.exports=class GroupState extends n{constructor(){super("scene")}scene(e){return this._setStateValue("scene",e)}}},3243:(e,t,r)=>{"use strict";const n=r(337);e.exports=class LightState extends n{constructor(){super("rgb")}white(e,t){this.ct(e);this.brightness(t);return this}hsb(e,t,r){this.hue(this._convertDegreesToStateValue(e,"hue"));this.brightness(r);this.saturation(t);return this}hsl(e,t,r){const n=t*(r<50?r:100-r)/100,s=Math.round(200*n/(r+n))|0,i=Math.round(n+r);this.brightness(i);this.hue(this._convertDegreesToStateValue(e,"hue"));this.sat(this._convertPercentageToStateValue(s,"sat"));return this}rgb(e,t,r){if(Array.isArray(e)){return this._setStateValue("rgb",e)}else{return this._setStateValue("rgb",[e,t,r])}}}},9302:(e,t,r)=>{"use strict";const n=r(4680);e.exports=class SceneLightState extends n{constructor(){super()}}},1668:(e,t,r)=>{"use strict";const n=r(9204),s=r(1810),i=r(996);const o=i.uint8({name:"percentage",min:0,max:100}),u=i.uint8({name:"degrees",min:0,max:360});e.exports=class States{constructor(){if(arguments.length===0){throw new s("You must provide some Light State Attributes")}const e={};function appendStateParameter(t){const r=n[t];if(!r){throw new s(`Unknown Light State Parameter: "${t}"`)}e[t]=r}const t=flatten(Array.from(arguments));t.forEach(e=>{if(Array.isArray(e)){e.forEach(appendStateParameter)}else{appendStateParameter(e)}});this._allowedStates=e;this._state={}}reset(){this._state={};return this}getPayload(){return Object.assign({},this._state)}getAllowedStateNames(){const e=[];Object.keys(this._allowedStates).forEach(t=>{e.push(t)});return e}populate(e){const t=this;if(e){Object.keys(e).forEach(r=>{if(t._allowedStates[r]){t._setStateValue(r,e[r])}})}return t}_setStateValue(e,t){const r=this,n=r._allowedStates[e];if(n){this._state[e]=n.getValue(t)}else{throw new s(`Attempted to set a state '${e}' that is not one of the allowed states`)}return r}_convertPercentageToStateValue(e,t,r){return this._convertToStateValue(o,e,t,r)}_convertDegreesToStateValue(e,t,r){return this._convertToStateValue(u,e,t,r)}_convertToStateValue(e,t,r,n){const s=this._allowedStates[r],i=e.getValue(t);if(i===e.getMinValue()){return s.getMinValue()}else if(i===e.getMaxValue()){return s.getMaxValue()}else{if(n){return s.getRange()*i/e.getMaxValue()}return Math.round(s.getRange()*i/e.getMaxValue())}}};function flatten(e){const t=[];!function flat(e){e.forEach(function(e){if(Array.isArray(e))flat(e);else t.push(e)})}(e);return t}},2217:(e,t,r)=>{"use strict";const n=r(3243),s=r(1166),i=r(9302);e.exports={LightState:n,GroupLightState:s,SceneLightState:i}},9204:(e,t,r)=>{"use strict";const n=r(996);e.exports={on:n.boolean({name:"on",optional:true}),bri:n.uint8({name:"bri",min:1,max:254,optional:true}),hue:n.uint16({name:"hue",optional:true}),sat:n.uint8({name:"sat",min:0,max:254,optional:true}),xy:n.list({name:"xy",minEntries:2,maxEntries:2,listType:n.float({name:"xyValue",min:0,max:1,optional:false}),optional:true}),ct:n.uint16({name:"ct",min:153,max:500,optional:true}),alert:n.choice({name:"alert",type:"string",defaultValue:"none",validValues:["none","select","lselect"],optional:true}),effect:n.choice({name:"effect",type:"string",defaultValue:"none",validValues:["none","colorloop"],optional:true}),transitiontime:n.uint16({name:"transitiontime",defaultValue:4,optional:true}),bri_inc:n.int8({name:"bri_inc",min:-254,max:254,optional:true}),sat_inc:n.int8({name:"sat_inc",min:-254,max:254,optional:true}),hue_inc:n.int16({name:"hue_inc",min:-65534,max:65534,optional:true}),ct_inc:n.int16({name:"ct_inc",min:-65534,max:65534,optional:true}),xy_inc:n.list({name:"xy_inc",minEntries:2,maxEntries:2,listType:n.float({name:"xyValue",min:-.5,max:.5,optional:false}),optional:true}),scene:n.string({name:"scene",type:"string",optional:true}),rgb:n.list({name:"rgb",minEntries:3,maxEntries:3,listType:n.uint8({name:"rgbValue"})})}},8326:(e,t,r)=>{"use strict";const n=r(2374),s=r(5269),i=r(3918),o=r(996);const u=[o.string({name:"id"}),o.string({name:"name",maxLength:32}),o.string({name:"owner"}),o.string({name:"created"}),o.boolean({name:"recycle"}),o.string({name:"lasttrigered"}),o.string({name:"timestriggered"}),o.choice({name:"status",validValues:["enabled","disabled","resourcedeleted","looperror"],defaultValue:"enabled"})];e.exports=class Rule extends n{constructor(e){super(u,e);this._conditions=buildConditions();this._actions=buildActions()}get name(){return this.getAttributeValue("name")}set name(e){return this.setAttributeValue("name",e)}get created(){return this.getAttributeValue("created")}get owner(){return this.getAttributeValue("owner")}get lasttriggered(){return this.getAttributeValue("lasttriggered")}get timestriggered(){return this.getAttributeValue("timestriggered")}get status(){return this.getAttributeValue("status")}set recycle(e){return this.setAttributeValue("recycle",e)}get recycle(){return this.getAttributeValue("recycle")}get conditions(){return this._conditions}addCondition(e){this._conditions.push(buildCondition(e));return this}removeConditionAt(e){this._conditions.splice(e,1)}resetConditions(){this._conditions=buildConditions()}get actions(){return this._actions}addAction(e){this._actions.push(buildAction(e));return this}removeActionAt(e){this._actions.splice(e,1)}resetActions(){this._actions=buildActions()}getConditionsPayload(){return getPayloads(this.conditions)}getActionsPayload(){return getPayloads(this.actions)}toStringDetailed(){let e=super.toStringDetailed();e+="\n  Conditions:";this.conditions.forEach(t=>{e+=`\n    ${t.toString()}`});e+="\n  Actions:";this.actions.forEach(t=>{e+=`\n    ${t.toString()}`});return e}_populate(e){super._populate(e);this._conditions=buildConditions(e?e.conditions:null);this._actions=buildActions(e?e.actions:null);return this}getHuePayload(){const e=super.getHuePayload();e.conditions=this.getConditionsPayload();e.actions=this.getActionsPayload();return e}getJsonPayload(){const e=super.getJsonPayload();e.conditions=this.getConditionsPayload();e.actions=this.getActionsPayload();return e}};function buildCondition(e){return i.create(e)}function buildConditions(e){const t=[];if(e){e.forEach(e=>{t.push(buildCondition(e))})}return t}function buildAction(e){return s.create(e)}function buildActions(e){const t=[];if(e){e.forEach(e=>{t.push(buildAction(e))})}return t}function getPayloads(e){const t=[];if(e){e.forEach(e=>{t.push(e.payload)})}return t}},449:(e,t,r)=>{"use strict";const n=r(6734),s=r(3895),i=r(1810),o=r(5114);e.exports=class GroupCondition{constructor(e){if(e instanceof s){this._id=e.id}else{this._id=e}this._groupStateAttribute=null;this._operator=null;this._value=null}when(){return new SelectAttribute(this)}getRuleCondition(){validateState(this);const e={address:`/groups/${this._id}/state/${this._groupStateAttribute}`,operator:this._operator,value:this._value};return(new n).populate(e)}_setOperator(e){this._operator=o.getOperator(e);return this}_setRequiredValue(e){if(e===null||e===undefined){throw new i("A value is required when using this operator")}this._value=e;return this}};function validateState(e){let t=null;if(e._id===null||e._id===undefined){t="a group id is required"}else if(!e._groupStateAttribute){t="a state of the group is required"}else if(!e._operator){t="an operator for the group state value is required"}if(t){throw new i(`Invalid Condition, ${t}`)}}class SelectAttribute{constructor(e){this._condition=e;this._selectOperator=new SelectOperator(e)}allOn(){this._condition._groupStateAttribute="all_on";return this._selectOperator}anyOn(){this._condition._groupStateAttribute="any_on";return this._selectOperator}}class SelectOperator{constructor(e){this._condition=e}equals(e){this._condition._setOperator("eq");this._condition._setRequiredValue(e);return this._condition}changed(){this._condition._setOperator("dx");this._condition.value=null;return this._condition}changedDelayed(e){this._condition._setOperator("ddx");this._condition._setRequiredValue(e);return this._condition}}},6734:(e,t,r)=>{"use strict";const n=r(5114);e.exports=class RuleCondition{constructor(e,t,r){this.populate({address:e,operator:t,value:r})}get address(){return this._address}get operator(){return this._operator}set operator(e){this._operator=n.getOperator(e)}get value(){return this._value}set value(e){this._value=e}get payload(){const e={address:this.address,operator:this.operator.payload};if(this.value!==null&&this.value!==undefined){e.value=`${this.value}`}return e}populate(e){let t=null,r=null,s=null;if(e){t=e.address||null;r=n.getOperator(e.operator||null);s=e.value!==undefined&&e.value!==null?e.value:null}this._address=t;this._operator=r;this._value=s;return this}toString(){return JSON.stringify(this.payload)}}},3109:(e,t,r)=>{"use strict";const n=r(6734),s=r(4226),i=r(1810),o=r(5114);e.exports=class SensorCondition{constructor(e){if(!(e instanceof s)){throw new i("You must provide a valid Sensor object")}this._sensor=e;this._sensorStateAttribute=null;this._operator=null;this._value=null}when(e){const t=this;validateSensorAttribute(this._sensor,e);this._sensorStateAttribute=e;return new SelectOperator(t)}getRuleCondition(){validateState(this);const e={address:`/sensors/${this._sensor.id}/state/${this._sensorStateAttribute}`,operator:this._operator,value:this._value};return(new n).populate(e)}_setOperator(e){this._operator=o.getOperator(e);return this}_setRequiredValue(e){if(e===null||e===undefined){throw new i("A value is required when using this operator")}this._value=e;return this}};function validateState(e){let t=null;if(!e._sensor){t="a sensor is required"}else if(!e._sensorStateAttribute){t="a state of the sensor is required"}else if(!e._operator){t="an operator for the sensor state value is required"}if(t){throw new i(`Invalid Condition, ${t}`)}}function validateSensorAttribute(e,t){if(!e){throw new i("No Sensor provided to get attribute from")}const r=e.getStateAttributeNames();if(r.indexOf(t)>-1){return t}else{throw new i(`Attribute '${t}' not found in sensor attributes, ${JSON.stringify(r)}`)}}class SelectOperator{constructor(e){this._sensorCondition=e}equals(e){const t=this._sensorCondition;t._setOperator("eq");t._setRequiredValue(e);return t}greaterThan(e){const t=this._sensorCondition;t._setOperator("gt");t._setRequiredValue(e);return t}lessThan(e){const t=this._sensorCondition;t._setOperator("lt");t._setRequiredValue(e);return t}changed(){const e=this._sensorCondition;e._setOperator("dx");return e}changedDelayed(e){const t=this._sensorCondition;t._setOperator("ddx");t._setRequiredValue(e);return t}stable(e){const t=this._sensorCondition;t._setOperator("stable");t._setRequiredValue(e);return t}notStable(e){const t=this._sensorCondition;t._setOperator("not stable");t._setRequiredValue(e);return t}in(e){const t=this._sensorCondition;t._setOperator("in");t._setRequiredValue(e);return t}notIn(e){const t=this._sensorCondition;t("not in");t._setRequiredValue(e);return t}}},3918:(e,t,r)=>{"use strict";const n=r(1810),s=r(6734),i=r(3109),o=r(449);e.exports.create=function(e){if(e){if(e instanceof i||e instanceof o){return e.getRuleCondition()}else if(e instanceof s){return e}else{return(new s).populate(e)}}else{throw new n("No data provided to build RuleCondition instance from.")}}},1381:e=>{"use strict";e.exports=class RuleConditionOperator{constructor(e,t){this._type=e;this._matchValues=[e];if(t){this._matchValues=this._matchValues.concat(t)}}get type(){return this._type}matches(e){let t=false;if(e instanceof RuleConditionOperator){return this.type===e.type}else{this._matchValues.some(r=>{if(r===e){t=true;return true}})}return t}get payload(){return this.type}}},5114:(e,t,r)=>{"use strict";const n=r(1381);const s=new n("eq",["=","==","equals","==="]),i=new n("dx"),o=new n("ddx"),u=new n("stable"),a=new n("not stable"),c=new n("in"),l=new n("not in"),h=new n("lt",["<"]),d=new n("gt",[">"]);e.exports.getOperator=function(e){if(e instanceof n){return e}else{let t=null;if(e){[s,i,o,u,a,c,l,h,d].some(r=>{if(r.matches(e)){t=r;return true}})}return t}};e.exports.equals=s;e.exports.changed=i;e.exports.changedDelayed=o;e.exports.greaterThan=d;e.exports.lessThan=h;e.exports.stable=u;e.exports.notStable=a;e.exports.in=c;e.exports.notIn=l},888:(e,t,r)=>{"use strict";const n=r(3299),s=r(996);const i=[s.string({name:"group"}),s.list({name:"lights",optional:true,minEntries:1,listType:s.string({name:"lightId"})}),s.object({name:"lightstates"})];e.exports=class GroupScene extends n{constructor(e){super(i,"GroupScene",e)}get group(){return this.getAttributeValue("group")}set group(e){return this.setAttributeValue("group",e)}get lights(){return this.getAttributeValue("lights")}get lightstates(){return this.getAttributeValue("lightstates")}}},5875:(e,t,r)=>{"use strict";const n=r(3299),s=r(996);const i=[s.list({name:"lights",minEntries:1,listType:s.string({name:"lightId"})}),s.object({name:"lightstates"})];e.exports=class LightScene extends n{constructor(e){super(i,"LightScene",e)}get lights(){return this.getAttributeValue("lights")}set lights(e){return this.setAttributeValue("lights",e)}get lightstates(){return this.getAttributeValue("lightstates")}set lightstates(e){return this.setAttributeValue("lightstates",e)}}},3299:(e,t,r)=>{"use strict";const n=r(2374),s=r(996),i=r(7516);const o=[s.string({name:"id",min:1,max:16}),s.string({name:"name",min:1,max:32}),s.choice({name:"type",validValues:["LightScene","GroupScene"],defaultValue:"LightScene"}),s.string({name:"owner"}),s.boolean({name:"recycle",defaultValue:false}),s.boolean({name:"locked"}),s.object({name:"appdata",types:[s.int8({name:"version"}),s.string({name:"data",min:1,max:16,optional:true})]}),s.string({name:"picture",min:0,max:16}),s.string({name:"lastupdated"}),s.int8({name:"version"})];e.exports=class Scene extends n{constructor(e,t,r){super(i.flatten(o,e),r);this.setAttributeValue("type",t)}get name(){return this.getAttributeValue("name")}set name(e){return this.setAttributeValue("name",e)}get type(){return this.getAttributeValue("type")}get owner(){return this.getAttributeValue("owner")}get recycle(){return this.getAttributeValue("recycle")}set recycle(e){return this.setAttributeValue("recycle",e)}get locked(){return this.getAttributeValue("locked")}get appdata(){return this.getAttributeValue("appdata")}set appdata(e){return this.setAttributeValue("appdata",e)}set picture(e){return this.setAttributeValue("picture",e)}get picture(){return this.getAttributeValue("picture")}get lastupdated(){return this.getAttributeValue("lastupdated")}get version(){return this.getAttributeValue("version")}}},3450:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.boolean({name:"flag"})];e.exports=class CLIPGenericFlag extends n{constructor(e){super(i,o,e)}get flag(){return this.getStateAttributeValue("flag")}set flag(e){return this._updateStateAttributeValue("flag",e)}}},4107:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.int16({name:"status"})];e.exports=class CLIPGenericStatus extends n{constructor(e){super(i,o,e)}get status(){return this.getStateAttributeValue("status")}set status(e){return this._updateStateAttributeValue("status",e)}}},8964:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.uint16({name:"humidity"})];e.exports=class CLIPHumidity extends n{constructor(e){super(i,o,e)}get humidity(){return this.getStateAttributeValue("humidity")}set humidity(e){return this._updateStateAttributeValue("humidity",e)}}},3942:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[s.uint16({name:"tholddark",defaultValue:16e3}),s.uint16({name:"tholdoffset",minValue:1,defaultValue:7e3})];const o=[s.uint16({name:"lightlevel"}),s.boolean({name:"dark"}),s.boolean({name:"daylight"})];e.exports=class CLIPLightlevel extends n{constructor(e){super(i,o,e)}get tholddark(){return this.getConfigAttributeValue("tholddark")}set tholddark(e){return this._updateConfigAttributeValue("tholddark",e)}get thresholdDark(){return this.tholddark}get tholdoffset(){return this.getConfigAttributeValue("tholdoffset")}set tholdoffset(e){return this._updateConfigAttributeValue("tholdoffset",e)}get thresholdOffset(){return this.tholdoffset}get lightlevel(){return this.getStateAttributeValue("lightlevel")}set lightlevel(e){return this._updateStateAttributeValue("lightlevel",e)}get dark(){return this.getStateAttributeValue("dark")}set dark(e){return this._updateStateAttributeValue("dark",e)}get daylight(){return this.getStateAttributeValue("daylight")}set daylight(e){return this._updateStateAttributeValue("daylight",e)}}},4120:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.boolean({name:"open"})];e.exports=class CLIPOpenClose extends n{constructor(e){super(i,o,e)}get open(){return this.getStateAttributeValue("open")}set open(e){return this._updateStateAttributeValue("open",e)}}},268:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.boolean({name:"presence"})];e.exports=class CLIPPresence extends n{constructor(e){super(i,o,e)}get presence(){return this.getStateAttributeValue("presence")}set presence(e){return this._updateStateAttributeValue("presence",e)}}},4319:(e,t,r)=>{"use strict";const n=r(4226),s=r(996),i=r(7516);const o=[s.boolean({name:"reachable"}),s.uint8({name:"battery",optional:true}),s.string({name:"url",minLength:0,maxLength:64})];e.exports=class CLIPSensor extends n{constructor(e,t,r){super(i.flatten(o,e),t,r)}get reachable(){return this.getConfigAttributeValue("reachable")}set reachable(e){return this._updateConfigAttributeValue("reachable",e)}get battery(){return this.getConfigAttributeValue("battery")}set battery(e){return this._updateConfigAttributeValue("battery",e)}get url(){return this.getConfigAttributeValue("url")}set url(e){return this.setAttributeValue("url",e)}set modelid(e){return this.setAttributeValue("modelid",e)}set swversion(e){return this.setAttributeValue("swversion",e)}set uniqueid(e){return this.setAttributeValue("uniqueid",e)}set manufacturername(e){return this.setAttributeValue("manufacturername",e)}get recycle(){return this.getAttributeValue("recycle")}}},5638:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.uint16({name:"buttonevent"})];e.exports=class CLIPSwitch extends n{constructor(e){super(i,o,e)}get buttonevent(){return this.getStateAttributeValue("buttonevent")}set buttonevent(e){return this._updateStateAttributeValue("buttonevent",e)}}},5993:(e,t,r)=>{"use strict";const n=r(4319),s=r(996);const i=[];const o=[s.int16({name:"temperature"})];e.exports=class CLIPTemperature extends n{constructor(e){super(i,o,e)}get temperature(){return this.getStateAttributeValue("temperature")}set temperature(e){return this._updateStateAttributeValue("temperature",e)}}},6153:(e,t,r)=>{"use strict";const n=r(4226),s=r(996);const i=[s.boolean({name:"configured"}),s.int8({name:"sunriseoffset",defaultValue:30,minValue:-120,maxValue:120}),s.int8({name:"sunsetoffset",defaultValue:-30,minValue:-120,maxValue:120}),s.string({name:"long"}),s.string({name:"lat"})],o=[s.boolean({name:"daylight"}),s.string({name:"lastupdated"})];e.exports=class Daylight extends n{constructor(e){super(i,o,e)}set long(e){this._updateConfigAttributeValue("long",e);return this}set lat(e){this._updateConfigAttributeValue("lat",e);return this}get configured(){return this.getConfigAttributeValue("configured")}get sunriseoffset(){return this.getConfigAttributeValue("sunriseoffset")}set sunriseoffset(e){this._updateConfigAttributeValue("sunriseoffset",e);return this}get sunsetoffset(){return this.getConfigAttributeValue("sunsetoffset")}set sunsetoffset(e){this._updateConfigAttributeValue("sunsetoffset",e);return this}get daylight(){return this.getStateAttributeValue("daylight")}set daylight(e){this._updateStateAttributeValue("daylight",!!e);return this}}},4226:(e,t,r)=>{"use strict";const n=r(2374),s=r(996),i=r(7516);const o=[s.int8({name:"id"}),s.string({name:"name"}),s.string({name:"type"}),s.string({name:"modelid"}),s.string({name:"manufacturername"}),s.string({name:"uniqueid"}),s.string({name:"swversion"}),s.string({name:"swconfigid"}),s.object({name:"capabilities"}),s.string({name:"productname"}),s.object({name:"swupdate"}),s.string({name:"diversityid"}),s.boolean({name:"recycle"})];const u=[s.string({name:"lastupdated",defaultValue:"none"})];const a=[s.boolean({name:"on",defaultValue:true})];e.exports=class Sensor extends n{constructor(e,t,r,n){const c=s.object({name:"state",types:i.flatten(u,t)}),l=s.object({name:"config",types:i.flatten(a,e)}),h=i.flatten(o,c,l);super(h,r);this._populate(n);this.setAttributeValue("type",this.constructor.name);this._configAttributes={};l.types.forEach(e=>{this._configAttributes[e.name]=e});this._stateAttributes={};c.types.forEach(e=>{this._stateAttributes[e.name]=e})}set name(e){return this.setAttributeValue("name",e)}get name(){return this.getAttributeValue("name")}get modelid(){return this.getAttributeValue("modelid")}get manufacturername(){return this.getAttributeValue("manufacturername")}get swversion(){return this.getAttributeValue("swversion")}get swconfigid(){return this.getAttributeValue("swconfigid")}get type(){return this.getAttributeValue("type")}get uniqueid(){return this.getAttributeValue("uniqueid")}get capabilities(){return this.getAttributeValue("capabilities")}get lastupdated(){return this.getStateAttributeValue("lastupdated")}get on(){return this.getConfigAttributeValue("on")}set on(e){this._updateConfigAttributeValue("on",e);return this}getConfig(){return this.getAttributeValue("config")}getConfigAttribute(e){return this._configAttributes[e]}getStateAttribute(e){return this._stateAttributes[e]}getStateAttributeNames(){return Object.keys(this._stateAttributes)}getConfigAttributeValue(e){const t=this.getAttributeValue("config"),r=this.getConfigAttribute(e);if(r){return r.getValue(t[e])}else{const r=t[e];if(r!==undefined){return r}}return null}getStateAttributeValue(e){const t=this.getAttributeValue("state"),r=this.getStateAttribute(e);if(r){return r.getValue(t[e])}else{const r=t[e];if(r!==undefined){return r}}return null}_updateStateAttributeValue(e,t){let r=this.getAttributeValue("state")||{};r[e]=t;return this.setAttributeValue("state",r)}_updateConfigAttributeValue(e,t){const r=this.getAttributeValue("config")||{};r[e]=t;return this.setAttributeValue("config",r)}getHuePayload(){const e=super.getHuePayload();Sensor.removeNullValues(e.config);Sensor.removeNullValues(e.state);return e}static removeNullValues(e){if(e){Object.keys(e).forEach(t=>{const r=e[t];if(r===null){delete e[t]}})}}}},8105:(e,t,r)=>{"use strict";const n=r(4226),s=r(996);const i=[];const o=[s.uint16({name:"buttonevent"})];e.exports=class ZGPSwitch extends n{constructor(e){super(i,o,e)}get buttonevent(){return this.getStateAttributeValue("buttonevent")}}},8055:(e,t,r)=>{"use strict";const n=r(4226),s=r(996);const i=[s.uint16({name:"tholddark",defaultValue:16e3}),s.uint16({name:"tholdoffset",minValue:1,defaultValue:7e3})];const o=[s.uint16({name:"lightlevel"}),s.boolean({name:"dark"}),s.boolean({name:"daylight"})];e.exports=class ZLLLightlevel extends n{constructor(e){super(i,o,e)}get tholddark(){return this.getConfigAttributeValue("tholddark")}set tholddark(e){return this._updateConfigAttributeValue("tholddark",e)}get thresholdDark(){return this.tholddark}get tholdoffset(){return this.getConfigAttributeValue("tholdoffset")}set tholdoffset(e){return this._updateConfigAttributeValue("tholdoffset",e)}get thresholdOffset(){return this.tholdoffset}get lightlevel(){return this.getStateAttributeValue("lightlevel")}set lightlevel(e){return this._updateStateAttributeValue("lightlevel",e)}get dark(){return this.getStateAttributeValue("dark")}get daylight(){return this.getStateAttributeValue("daylight")}}},7128:(e,t,r)=>{"use strict";const n=r(4226),s=r(996);const i=[s.uint8({name:"battery"}),s.choice({name:"alert",validValues:["none","select","lselect"],defaultValue:"none"}),s.boolean({name:"reachable"}),s.uint16({name:"sensitivity"}),s.uint16({name:"sensitivitymax"})];const o=[s.boolean({name:"presence"})];e.exports=class ZLLPresense extends n{constructor(e){super(i,o,e)}get battery(){return this.getConfigAttributeValue("battery")}set battery(e){return this._updateConfigAttributeValue("battery",e)}get alert(){return this.getConfigAttributeValue("alert")}set alert(e){return this._updateConfigAttributeValue("alert",e)}get reachable(){return this.getConfigAttributeValue("reachable")}set reachable(e){return this._updateConfigAttributeValue("reachable",e)}get sensitivity(){return this.getConfigAttributeValue("sensitivity")}set sensitivity(e){return this._updateConfigAttributeValue("sensitivity",e)}get sensitivitymax(){return this.getConfigAttributeValue("sensitivitymax")}set sensitivitymax(e){return this._updateConfigAttributeValue("sensitivitymax",e)}get presence(){return this.getStateAttributeValue("presence")}}},8776:(e,t,r)=>{"use strict";const n=r(4226),s=r(996);const i=[s.boolean({name:"reachable"}),s.uint8({name:"battery"}),s.choice({name:"alert",validValues:["none","select","lselect"],defaultValue:"none"}),s.list({name:"pending",listType:s.string({name:"pendingChange"}),minEntries:0})];const o=[s.int16({name:"buttonevent"})];e.exports=class ZLLSwitch extends n{constructor(e){super(i,o,e)}get battery(){return this.getConfigAttributeValue("battery")}set battery(e){return this._updateConfigAttributeValue("battery",e)}get alert(){return this.getConfigAttributeValue("alert")}set alert(e){return this._updateConfigAttributeValue("alert",e)}get reachable(){return this.getConfigAttributeValue("reachable")}set reachable(e){return this._updateConfigAttributeValue("reachable",e)}get pending(){return this.getConfigAttributeValue("pending")}get buttonevent(){return this.getStateAttributeValue("buttonevent")}}},5543:(e,t,r)=>{"use strict";const n=r(4226),s=r(996);const i=[];const o=[s.int16({name:"temperature"})];e.exports=class ZLLTemperature extends n{constructor(e){super(i,o,e)}get temperature(){return this.getStateAttributeValue("temperature")}}},5400:(e,t,r)=>{"use strict";const n=r(7331),s=r(47),i=r(9427),o=r(7576),u=r(1810);const a=new RegExp(`${n.getDatePattern()}T${n.getTimePattern()}`);e.exports=class AbsoluteTime extends o{constructor(e){super();this._time=new s;this._date=new i;if(e){this.value=e}}static matches(e){return a.test(e)}set value(e){if(e instanceof AbsoluteTime){return this.value=e.toString()}else if(e instanceof Date){this._time.fromDate(e);this._date.fromDate(e);return this}const t=a.exec(e);if(t){const e=this._time;e.hours=t.groups.hours;e.minutes=t.groups.minutes;e.seconds=t.groups.seconds;const r=this._date;r.year=t.groups.year;r.month=t.groups.month;r.day=t.groups.day;return this}throw new u(`Cannot create an absolute time from ${e}`)}year(e){this._date.year=e;return this}month(e){this._date.month=e;return this}day(e){this._date.day=e;return this}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}toString(){return`${this._date.toString()}T${this._time.toString()}`}}},7576:e=>{"use strict";e.exports=class BridgeTime{}},9427:(e,t,r)=>{"use strict";const n=r(1810),s=r(2353),i=r(996),o=r(7331);const u=new RegExp(`^${o.getDatePattern()}`);const a=["January","Feburary","March","April","May","June","July","August","September","October","November","December"];const c=[i.uint8({name:"year",min:1900,max:3e3}),i.choice({name:"month",validValues:a}),i.uint8({name:"day",min:0,max:31})];e.exports=class HueDate extends s{constructor(e){super(c);if(e instanceof Date){this.fromDate(e)}else{this.fromString(e)}}get year(){return this.getAttributeValue("year")}get yearString(){return`${this.year}`}set year(e){return this.setAttributeValue("year",e)}get month(){const e=a.indexOf(this.getAttributeValue("month"));if(e===-1){throw new n(`Month value has not been set`)}return e+1}get monthString(){const e=this.month;return`${e}`.padStart(2,"0")}set month(e){const t=new Number(e);if(Number.isNaN(t)){return this.setAttributeValue("month",e)}else{const e=a[t-1];return this.setAttributeValue("month",e)}}get day(){return this.getAttributeValue("day")}get dayString(){return`${this.day}`.padStart(2,"0")}set day(e){return this.setAttributeValue("day",e)}toString(){return`${this.yearString}-${this.monthString}-${this.dayString}`}fromString(e){if(!e){return this.fromDate(new Date)}else{const t=u.exec(e);if(t){this.year=t.groups.year;this.month=t.groups.month;this.day=t.groups.day;return this}return this.fromDate(new Date)}}fromDate(e){const t=e.getUTCFullYear(),r=e.getUTCMonth(),n=e.getUTCDate();this.year=t;this.month=r+1;this.day=n;return this}}},47:(e,t,r)=>{"use strict";const n=r(1810),s=r(2353),i=r(996),o=r(7331);const u=[i.uint8({name:"hours",min:0,max:23}),i.uint8({name:"minutes",min:0,max:59}),i.uint8({name:"seconds",min:0,max:59})];const a=new RegExp(o.getTimePattern());e.exports=class HueTime extends s{constructor(e){super(u);if(e instanceof Date){this.fromDate(e)}else{this.fromString(e||"00:00:00")}}get hours(){return this.getAttributeValue("hours")}get hoursString(){return`${this.hours}`.padStart(2,"0")}set hours(e){return this.setAttributeValue("hours",e)}get minutes(){return this.getAttributeValue("minutes")}get minutesString(){return`${this.minutes}`.padStart(2,"0")}set minutes(e){return this.setAttributeValue("minutes",e)}get seconds(){return this.getAttributeValue("seconds")}get secondsString(){return`${this.seconds}`.padStart(2,"0")}set seconds(e){return this.setAttributeValue("seconds",e)}toString(){return`${this.hoursString}:${this.minutesString}:${this.secondsString}`}fromString(e){const t=a.exec(e);if(t){this.hours=t.groups.hours;this.minutes=t.groups.minutes;this.seconds=t.groups.seconds}else{throw new n(`Invalid time format string "${e}"`)}}fromDate(e){this.hours=e.getHours();this.minutes=e.getMinutes();this.seconds=e.getSeconds()}}},1242:(e,t,r)=>{"use strict";const n=r(7331),s=r(47),i=r(9427),o=r(7576),u=r(1810);const a=new RegExp(`^${n.getDatePattern()}T${n.getTimePattern()}A${n.getTimePattern("random")}$`);e.exports=class RandomizedTime extends o{constructor(e){super();this._time=new s;this._date=new i;this._random=new s;if(e){this.value=e}}static matches(e){return a.test(e)}set value(e){if(e instanceof RandomizedTime){return this.value=e.toString()}else if(e instanceof Date){this._time.fromDate(e);this._date.fromDate(e);this._random=new s;return this}const t=a.exec(e);if(t){const e=this._time;e.hours=t.groups.hours;e.minutes=t.groups.minutes;e.seconds=t.groups.seconds;const r=this._date;r.year=t.groups.year;r.month=t.groups.month;r.day=t.groups.day;const n=this._random;n.hours=t.groups.randomhours;n.minutes=t.groups.randomminutes;n.seconds=t.groups.randomseconds;return this}throw new u(`Cannot create a randomized time from ${e}`)}year(e){this._date.year=e;return this}month(e){this._date.month=e;return this}day(e){this._date.day=e;return this}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}randomHours(e){this._random.hours=e;return this}randomMinutes(e){this._random.minutes=e;return this}randomSeconds(e){this._random.seconds=e;return this}toString(){return`${this._date.toString()}T${this._time.toString()}A${this._random.toString()}`}}},2243:(e,t,r)=>{"use strict";const n=r(7331),s=r(47),i=r(7576),o=r(1810);const u=new RegExp(`^PT${n.getTimePattern()}A${n.getTimePattern("random")}$`);e.exports=class RandomizedTimer extends i{constructor(e){super();this._time=new s;this._random=new s;if(e){this.value=e}}static matches(e){return u.test(e)}set value(e){if(e instanceof RandomizedTimer){this.value=e.toString();return this}const t=u.exec(e);if(t){const e=this._time;e.hours=t.groups.hours;e.minutes=t.groups.minutes;e.seconds=t.groups.seconds;const r=this._random;r.hours=t.groups.randomhours;r.minutes=t.groups.randomminutes;r.seconds=t.groups.randomseconds;return this}throw new o(`Cannot create a RandomizedTimer from ${e}`)}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}randomHours(e){this._random.hours=e;return this}randomMinutes(e){this._random.minutes=e;return this}randomSeconds(e){this._random.seconds=e;return this}toString(){return`PT${this._time.toString()}A${this._random.toString()}`}}},6781:(e,t,r)=>{"use strict";const n=r(9767),s=r(1810),i=r(47),o=r(7331);const u=new RegExp(`^W(?<weekdays>[0-9]{3})/T${o.getTimePattern()}A${o.getTimePattern("random")}$`);e.exports=class RecurringRandomizedTime extends n{constructor(){super();this._random=new i;if(arguments.length>0){this.setValue.apply(this,Array.from(arguments))}}static matches(e){return u.test(e)}setValue(){let e=null,t=null;if(arguments.length>1){e=arguments[0];t=arguments[1]}else if(arguments.length===1){const r=arguments[0];if(r instanceof RecurringRandomizedTime){return this.setValue(r.toString())}else if(r instanceof Date){t=r}else if(Number.isInteger(r)){e=r}}if(t){this._time.fromDate(t)}if(e){this.weekdays(e)}const r=u.exec(arguments[0]);if(r){const e=this._time;e.hours=r.groups.hours;e.minutes=r.groups.minutes;e.seconds=r.groups.seconds;this.weekdays(r.groups.weekdays);const t=this._random;t.hours=r.groups.randomhours;t.minutes=r.groups.randomminutes;t.seconds=r.groups.randomseconds;return this}if(!e&&!t){const e=Array.from(arguments).join(", ");throw new s(`Cannot create an recurring time from ${e}`)}return this}randomHours(e){this._random.hours=e;return this}randomMinutes(e){this._random.minutes=e;return this}randomSeconds(e){this._random.seconds=e;return this}toString(){return`${super.toString()}A${this._random.toString()}`}}},404:(e,t,r)=>{"use strict";const n=r(7331),s=r(47),i=r(7576),o=r(1810),u=r(996);const a=new RegExp(`^R(?<times>[0-9]{0,2})/PT${n.getTimePattern()}A${n.getTimePattern("random")}$`);const c=u.uint8({name:"reoccurs",min:0,max:99,defaultValue:0,optional:true});e.exports=class RecurringRandomizedTimer extends i{constructor(e){super();this._time=new s;this._random=new s;this.reoccurs();if(e){this.value=e}}static matches(e){return a.test(e)}set value(e){if(e instanceof RecurringRandomizedTimer){this.value=e.toString();return this}const t=a.exec(e);if(t){const e=this._time;e.hours=t.groups.hours;e.minutes=t.groups.minutes;e.seconds=t.groups.seconds;const r=this._random;r.hours=t.groups.randomhours;r.minutes=t.groups.randomminutes;r.seconds=t.groups.randomseconds;this.reoccurs(t.groups.times.length===0?0:t.groups.times);return this}throw new o(`Cannot create a RandomizedTimer from ${e}`)}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}randomHours(e){this._random.hours=e;return this}randomMinutes(e){this._random.minutes=e;return this}randomSeconds(e){this._random.seconds=e;return this}reoccurs(e){this._reocurrance=c.getValue(e);return this}toString(){const e=this._reocurrance;let t="";if(e!==0){t=`${e}`.padStart(2,"0")}return`R${t}/PT${this._time.toString()}A${this._random.toString()}`}}},9767:(e,t,r)=>{"use strict";const n=r(7576),s=r(7331),i=r(47),o=r(1810),u=r(996);const a=new RegExp(`^W(?<weekdays>[0-9]{3})/T${s.getTimePattern()}$`);const c=u.uint8({name:"weekdays",min:1,max:s.weekdays.ALL});e.exports=class RecurringTime extends n{constructor(){super();this._time=new i;this._weekdays=s.weekdays.ALL;if(arguments.length>0){this.setValue.apply(this,Array.from(arguments))}}static matches(e){return a.test(e)}setValue(){let e=null,t=null;const r=Array.from(arguments).filter(e=>e!==undefined&&e!==null);if(r.length>1){e=r[0];t=r[1]}else if(r.length===1){const n=r[0];if(n instanceof RecurringTime){return this.setValue(n.toString())}else if(n instanceof Date){t=n}else if(Number.isInteger(n)){e=n}}if(t){this._time.fromDate(t)}if(e){this.weekdays(e)}const n=a.exec(arguments[0]);if(n){const e=this._time;e.hours=n.groups.hours;e.minutes=n.groups.minutes;e.seconds=n.groups.seconds;this.weekdays(n.groups.weekdays);return this}if(!e&&!t){const e=Array.from(arguments).join(", ");throw new o(`Cannot create an recurring time from ${e}`)}return this}get weekdaysString(){return`${this._weekdays}`.padStart(3,"0")}weekdays(e){this._weekdays=c.getValue(e);return this}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}toString(){return`W${this.weekdaysString}/T${this._time.toString()}`}}},8351:(e,t,r)=>{"use strict";const n=r(7331),s=r(47),i=r(7576),o=r(1810),u=r(996);const a=new RegExp(`^R(?<times>[0-9]{0,2})/PT${n.getTimePattern()}$`);const c=u.uint8({name:"reoccurs",min:0,max:99,defaultValue:0,optional:true});e.exports=class RecurringTimer extends i{constructor(e){super();this._time=new s;this.reoccurs();if(e){this.value=e}}static matches(e){return a.test(e)}set value(e){if(e instanceof RecurringTimer){this.value=e.toString()}else if(e instanceof Date){this._time.fromDate(e);return this}const t=a.exec(e);if(t){const e=this._time;e.hours=t.groups.hours;e.minutes=t.groups.minutes;e.seconds=t.groups.seconds;this.reoccurs(t.groups.times.length===0?0:t.groups.times);return this}throw new o(`Cannnot create a Timer from ${e}`)}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}reoccurs(e){this._reocurrance=c.getValue(e);return this}toString(){const e=this._reocurrance;let t="";if(e!==0){t=`${e}`.padStart(2,"0")}return`R${t}/PT${this._time.toString()}`}}},5425:(e,t,r)=>{"use strict";const n=r(7576),s=r(7331),i=r(47),o=r(1810),u=r(996);const a=new RegExp(`^W(?<weekdays>[0-9]{3})/T${s.getTimePattern("from")}/T${s.getTimePattern("to")}$`);const c=u.uint8({name:"weekdays",min:1,max:s.weekdays.ALL});e.exports=class TimeInterval extends n{constructor(){super();this._from=new i;this._to=new i;this._weekdays=s.weekdays.ALL;if(arguments.length>0){this.setValue.apply(this,Array.from(arguments))}}static matches(e){return a.test(e)}setValue(){const e=arguments[0];if(e instanceof TimeInterval){return this.setValue(e.toString())}const t=a.exec(arguments[0]);if(t){const e=this._from;e.hours=t.groups.fromhours;e.minutes=t.groups.fromminutes;e.seconds=t.groups.fromseconds;const r=this._to;r.hours=t.groups.tohours;r.minutes=t.groups.tominutes;r.seconds=t.groups.toseconds;this.weekdays(t.groups.weekdays);return this}const r=Array.from(arguments).join(", ");throw new o(`Cannot create a TimeInterval from ${r}`)}get weekdaysString(){return`${this._weekdays}`.padStart(3,"0")}weekdays(e){this._weekdays=c.getValue(e);return this}from(e){this._from.fromDate(e);return this}fromHours(e){this._from.hours=e;return this}fromMinutes(e){this._from.minutes=e;return this}fromSeconds(e){this._from.seconds=e;return this}to(e){this._to.fromDate(e);return this}toHours(e){this._to.hours=e;return this}toMinutes(e){this._to.minutes=e;return this}toSeconds(e){this._to.seconds=e;return this}toString(){return`W${this.weekdaysString}/T${this._from.toString()}/T${this._to.toString()}`}}},3714:(e,t,r)=>{"use strict";const n=r(7331),s=r(47),i=r(7576),o=r(1810);const u=new RegExp(`^PT${n.getTimePattern()}$`);e.exports=class Timer extends i{constructor(e){super();this._time=new s;if(e){this.value=e}}static matches(e){return u.test(e)}set value(e){if(e instanceof Timer){this.value=e.toString();return this}const t=u.exec(e);if(t){const e=this._time;e.hours=t.groups.hours;e.minutes=t.groups.minutes;e.seconds=t.groups.seconds;return this}throw new o(`Cannot create a Timer from ${e}`)}hours(e){this._time.hours=e;return this}minutes(e){this._time.minutes=e;return this}seconds(e){this._time.seconds=e;return this}toString(){return`PT${this._time.toString()}`}}},2499:(e,t,r)=>{"use strict";const n=r(7576),s=r(5400),i=r(1242),o=r(9767),u=r(6781),a=r(5425),c=r(3714),l=r(8351),h=r(2243),d=r(404),p=r(1810),g=r(7331);e.exports={weekdays:g.weekdays,isRecurring(e){if(e instanceof n){return e instanceof o||e instanceof u||e instanceof l||e instanceof d}else{return o.matches(e)||u.matches(e)||l.matches(e)||d.matches(e)}},createAbsoluteTime(e){return new s(e)},createRandomizedTime(e){return new i(e)},createRecurringTime(e,t){return new o(e,t)},createRecurringRandomizedTime(e){return new u(e)},createTimeInterval(e){return new a(e)},createTimer(e){return new c(e)},createRecurringTimer(e){return new l(e)},createRandomizedTimer(e){return new h(e)},createRecurringRandomizedTimer(e){return new d(e)},createFromString(e){if(s.matches(e)){return new s(e)}else if(o.matches(e)){return new o(e)}else if(c.matches(e)){return new c(e)}else if(i.matches(e)){return new i(e)}else if(u.matches(e)){return new u(e)}else if(l.matches(e)){return new l(e)}else if(h.matches(e)){return new h(e)}else if(d.matches(e)){return new d(e)}else{throw new p(`Unable to determine a valid time pattern for string: "${e}"`)}},isTimePattern(e){return s.matches(e)||o.matches(e)||i.matches(e)||u.matches(e)||c.matches(e)||l.matches(e)||h.matches(e)||d.matches(e)}}},7331:e=>{"use strict";e.exports={getTimePattern:e=>{const t="[0-9]{2}",r=e||"";return`(?<${r}hours>${t}):(?<${r}minutes>${t}):(?<${r}seconds>${t})`},getDatePattern:e=>{const t="[0-9]{2}",r="[0-9]{4}",n=e||"";return`(?<${n}year>${r})-(?<${n}month>${t})-(?<${n}day>${t})`},weekdays:{MONDAY:64,TUESDAY:32,WEDNESDAY:16,THURSDAY:8,FRIDAY:4,SATURDAY:2,SUNDAY:1,WEEKDAY:124,WEEKEND:3,ALL:127}}},7069:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class GroupIdPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.uint16({name:"group id",optional:false})}_getParameterValue(e){if(i.isGroupInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},6881:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class LightIdPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.uint16({name:"light id",optional:false})}_getParameterValue(e){if(i.isLightInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},2660:(e,t,r)=>{"use strict";const n=r(1810);e.exports=class Placeholder{constructor(e,t){this._name=t||e}get name(){return this._name}get typeDefinition(){return this._type}set typeDefinition(e){this._type=e}inject(e,t){const r=`<${this.name}>`;if(e.indexOf(r)>-1){return e.replace(r,this.getValue(t))}return e}getValue(e){const t=this.typeDefinition;if(!t){throw new n("No type definition has been specified for placeholder")}const r=e?e[this.name]:null;const s=this._getParameterValue(r);return t.getValue(s)}_getParameterValue(e){return e}toString(){const e=this.typeDefinition;return`${this.name}: { type:${e.type}, optional:${e.optional}, defaultValue:${e.defaultValue} }`}}},2458:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class ResourceLinkPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.uint16({name:"resourcelink id",optional:false})}_getParameterValue(e){if(i.isResourceLinkInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},3383:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class RuleIdPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.uint16({name:"rule id",optional:false})}_getParameterValue(e){if(i.isRuleInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},3116:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class SceneIdPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.string({name:"scene id",optional:false})}_getParameterValue(e){if(i.isSceneInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},9488:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class ScheduleIdPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.uint16({name:"schedule id",optional:false})}_getParameterValue(e){if(i.isScheduleInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},412:(e,t,r)=>{"use strict";const n=r(2660),s=r(996),i=r(4465);e.exports=class SensorIdPlaceholder extends n{constructor(e){super("id",e);this.typeDefinition=s.uint16({name:"sensor id",optional:false})}_getParameterValue(e){if(i.isSensorInstance(e)){return e.id}else{return super._getParameterValue(e)}}}},8378:(e,t,r)=>{"use strict";const n=r(2660),s=r(996);e.exports=class UsernamePlaceholder extends n{constructor(e){super("username",e);this.typeDefinition=s.string({name:"username",minLength:1,optional:false})}}},9818:(e,t,r)=>{"use strict";const n=r(1810);e.exports.rgbToXY=((e,t)=>{if(!t){throw new n("No color gamut provided, cannot perform conversion of RGB")}return _getXYStateFromRGB(e[0],e[1],e[2],t)});class XY{constructor(e,t){this._x=e;this._y=t}get x(){return this._x}get y(){return this._y}crossProduct(e){return this.x*e.y-this.y*e.x}}function _isInColorGamut(e,t){const r=new XY(t.green.x-t.red.x,t.green.y-t.red.y),n=new XY(t.blue.x-t.red.x,t.blue.y-t.red.y),s=new XY(e.x-t.red.x,e.y-t.red.y);const i=s.crossProduct(n)/r.crossProduct(n),o=r.crossProduct(s)/r.crossProduct(n);return i>=0&&o>=0&&i+o<=1}function _getClosestPoint(e,t,r){const n=new XY(r.x-e.x,r.y-e.y),s=new XY(t.x-e.x,t.y-e.y),i=s.x*s.x+s.y*s.y,o=n.x*s.x+n.y*s.y;let u=o/i;if(u<0){u=0}else if(u>1){u=1}return new XY(e.x+s.x*u,e.y+s.y*u)}function _getDistanceBetweenPoints(e,t){const r=e.x-t.x,n=e.y-t.y;return Math.sqrt(r*r+n*n)}function _getXYStateFromRGB(e,t,r,n){const s=_gammaCorrection(e),i=_gammaCorrection(t),o=_gammaCorrection(r),u=s*.4360747+i*.3850649+o*.0930804,a=s*.2225045+i*.7168786+o*.0406169,c=s*.0139322+i*.0971045+o*.7141733;let l=u/(u+a+c),h=a/(u+a+c);l=isNaN(l)?0:l;h=isNaN(h)?0:h;let d=new XY(l,h);if(!_isInColorGamut(d,n)){d=_resolveXYPointForLamp(d,n)}return[d.x,d.y]}function _getRGBFromXYState(e,t,r){const n=r,s=n/t*e,i=n/t*(1-e-t);let o=[s*1.612-n*.203-i*.302,-s*.509+n*1.412+i*.066,s*.026-n*.072+i*.962];o=o.map(function(e){return e<=.0031308?12.92*e:(1+.055)*Math.pow(e,1/2.4)-.055});o=o.map(function(e){return Math.max(0,e)});const u=Math.max(o[0],o[1],o[2]);if(u>1){o=o.map(function(e){return e/u})}o=o.map(function(e){return Math.floor(e*255)});return o}function _resolveXYPointForLamp(e,t){const r=_getClosestPoint(t.red,t.green,e),n=_getClosestPoint(t.blue,t.red,e),s=_getClosestPoint(t.green,t.blue,e),i=_getDistanceBetweenPoints(e,r),o=_getDistanceBetweenPoints(e,n),u=_getDistanceBetweenPoints(e,s);let a=i,c=r;if(o<a){a=o;c=n}if(u<a){c=s}return c}function _gammaCorrection(e){if(e>.04045){return Math.pow((e+.055)/(1+.055),2.4)}else{return e/12.92}}},1820:(e,t,r)=>{"use strict";const n=r(6011);e.exports=class BooleanType extends n{constructor(e){super(Object.assign({type:"boolean"},e))}getValue(e){if(n.isValueDefined(e)){return Boolean(e)}else{if(this.hasDefaultValue()){return Boolean(this.defaultValue)}else{if(this.optional){return e}else{throw new ApiError(`No value provided and '${this.name}' is not optional`)}}}}}},9000:(e,t,r)=>{"use strict";const n=r(6011),s=r(1810);e.exports=class ChoiceType extends n{constructor(e){super(Object.assign({type:"choice"},e));const t=e.validValues;if(!n.isValueDefined(t)){throw new s("validValues config property is required for choice type")}this._allowedValues=t}get validValues(){return this._allowedValues}_convertToType(e){if(this.validValues.indexOf(e)>-1){return e}else{throw new s(`Value '${e}' is not one of the allowed values [${this.validValues}]`)}}}},4284:(e,t,r)=>{"use strict";const n=r(3032);e.exports=class FloatType extends n{constructor(e){super(Object.assign({type:"float"},e),-Number.MAX_VALUE,Number.MAX_VALUE)}}},53:(e,t,r)=>{"use strict";const n=r(3032);e.exports=class Int16Type extends n{constructor(e){super(Object.assign({type:"int16"},e),-65535,65535)}_convertToType(e){return parseInt(e)}}},4897:(e,t,r)=>{"use strict";const n=r(3032);e.exports=class Int8Type extends n{constructor(e){super(Object.assign({type:"int8"},e),-255,255)}_convertToType(e){return parseInt(e)}}},5290:(e,t,r)=>{"use strict";const n=r(6011),s=r(1810);e.exports=class ListType extends n{constructor(e){if(e.minEntries===null||e.minEntries===undefined){throw new s("minEntries is required for a list type")}super(Object.assign({type:"list"},e));this.minEntries=e.minEntries;this.maxEntries=e.maxEntries;const t=e.listType;if(!(t instanceof n)){throw new s(`listType must be an instance of a Type, not ${t}`)}this._listType=t}get listType(){return this._listType}getValue(){const e=super.getValue.apply(this,Array.from(arguments));if(!n.isValueDefined(e)){if(this.minEntries===0){return e}else{throw new s(`Type ${this.name}, minEntries requirement not satisfied, required ${this.minEntries}, but have null object`)}}const t=e.length;if(t<this.minEntries){throw new s(`The number of entries for the list, "${t}" is less than required minimum of ${this.minEntries}`)}if(this.maxEntries&&t>this.maxEntries){throw new s(`The number of entries for the list, ${t}, is greater than required maximum of ${this.maxEntries}`)}return e}_convertToType(e){if(!n.isValueDefined(e)){return null}const t=[],r=this.listType;if(Array.isArray(e)){e.forEach(e=>{t.push(r.getValue(e))})}else{t.push(r.getValue(e))}return t}}},1999:(e,t,r)=>{"use strict";const n=r(6011),s=r(1810);e.exports=class ObjectType extends n{constructor(e){super(Object.assign({type:"object"},e));const t=e.types;if(!n.isValueDefined(t)){this._types=null;this._childRequiredKeys=[]}else{if(!Array.isArray(t)){throw new s("types definition must be an Array of types")}const e=[];t.forEach(t=>{if(!(t instanceof n)){throw new s(`type specified as ${JSON.stringify(t)} is not an instance of Type class`)}if(!t.optional){e.push(t.name)}});this._types=t;this._childRequiredKeys=e}}get types(){return this._types}get childRequiredKeys(){return this._childRequiredKeys}_convertToType(e){const t=this._getObject(e);this._validateRequiredKeys(t);if(Object.keys(t).length===0){if(this.optional){return null}else{throw new s(`Empty object created from data provided, but the object is not optional`)}}return t}_getObject(e){if(!this.types){return Object.assign({},e)}const t={};this.types.forEach(r=>{const s=r.name,i=r.getValue(e[s]);if(n.isValueDefined(i)){t[s]=i}});return t}_validateRequiredKeys(e){if(this.childRequiredKeys.length>0){const t=Object.keys(e);this.childRequiredKeys.forEach(e=>{if(t.indexOf(e)===-1){throw new s(`Required key '${e}' is missing from the object`)}})}}}},3032:(e,t,r)=>{"use strict";const n=r(6011),s=r(1810);e.exports=class RangedNumberType extends n{constructor(e,t,r){super(e);if(n.isValueDefined(e.min)){this.min=e.min}else{this.min=t}if(n.isValueDefined(e.max)){this.max=e.max}else{this.max=r}}getValue(e){const t=super.getValue(e);if(t===null){return null}if(Number.isNaN(t)){throw new s(`Failure to convert value for ${this.name}, value, '${e}' is not a parsable number'`)}if(this.isValueInRange(t)){return t}else{throw new s(`Value, '${t}' is not within allowed limits: min=${this.getMinValue()} max=${this.getMaxValue()} for '${this.name}'`)}}_convertToType(e){return Number(e)}isValueInRange(e){return e>=this.getMinValue()&&e<=this.getMaxValue()}getMinValue(){return this.min}getMaxValue(){return this.max}getRange(){return this.max}}},5345:(e,t,r)=>{"use strict";const n=r(6011),s=r(1810);e.exports=class StringType extends n{constructor(e){super(Object.assign({type:"string"},e));if(n.isValueDefined(e.min)){this.min=e.min}else{this.min=null}if(n.isValueDefined(e.max)){this.max=e.max}else{this.max=null}}get minLength(){return this.min}get maxLength(){return this.max}getValue(e){const t=super.getValue(e),r=n.isValueDefined(t),i=this.optional;if(i&&!r){return t}if(this.minLength){if(!r){throw new s(`No value provided for ${this.name}, must have a minimum length of ${this.minLength}`)}else if(t.length<this.min){throw new s(`'${e}' for ${this.name}, does not meet minimum length requirement of ${this.minLength}`)}}if(this.maxLength){if(r&&t.length>this.maxLength){throw new s(`'${e}' for ${this.name}, does not meet maximum length requirement of ${this.maxLength}`)}}return t}_convertToType(e){return`${e}`}}},3146:(e,t,r)=>{"use strict";const n=r(6011),s=r(2499),i=r(7576),o=r(1810);e.exports=class TimePatternType extends n{constructor(e){super(Object.assign({type:"timePattern"},e))}getValue(e){const t=super.getValue(e),r=n.isValueDefined(t),u=this.optional;if(u&&!r){return t}if(e instanceof i){return e.toString()}else if(s.isTimePattern(e)){return s.createFromString(e).toString()}else{throw new o(`Cannot convert value "${e}" to a valid TimePatten`)}}_convertToType(e){return s.createFromString(`${e}`)}}},6011:(e,t,r)=>{"use strict";const n=r(1810);e.exports=class Type{static isValueDefined(e){return e!==null&&e!==undefined&&e!==Number.NaN}constructor(e){if(!e.name){throw new n("A name must be specified")}this._name=e.name;if(!e.type){throw new n("A type must be specified")}this._type=e.type;this._optional=Type.isValueDefined(e.optional)?e.optional:true;this._defaultValue=Type.isValueDefined(e.defaultValue)?e.defaultValue:null}get name(){return this._name}get type(){return this._type}get defaultValue(){return this._defaultValue}get optional(){return this._optional}hasDefaultValue(){return Type.isValueDefined(this.defaultValue)}getValue(e){if(Type.isValueDefined(e)){return this._convertToType(e)}else{if(this.hasDefaultValue()){return this._convertToType(this.defaultValue)}else{if(this.optional){return null}else{throw new n(`No value provided and '${this.name}' is not optional`)}}}}_convertToType(e){return e}}},8650:(e,t,r)=>{"use strict";const n=r(3032);e.exports=class UInt16Type extends n{constructor(e){super(Object.assign({type:"uint16"},e),0,65535)}_convertToType(e){return parseInt(e)}}},8274:(e,t,r)=>{"use strict";const n=r(3032);e.exports=class UInt8Type extends n{constructor(e){super(Object.assign({type:"uint8"},e),0,255)}_convertToType(e){return parseInt(e)}}},996:(e,t,r)=>{"use strict";const n=r(5345),s=r(1820),i=r(9e3),o=r(8274),u=r(8650),a=r(4897),c=r(53),l=r(4284),h=r(5290),d=r(1999);e.exports={boolean:function(e){return new s(e)},uint8:function(e){return new o(e)},uint16:function(e){return new u(e)},int8:function(e){return new a(e)},int16:function(e){return new c(e)},float:function(e){return new l(e)},list:function(e){return new h(e)},choice:function(e){return new i(e)},string:function(e){return new n(e)},object:function(e){return new d(e)},timePattern:function(e){const t=r(3146);return new t(e)}}},7516:(e,t,r)=>{"use strict";const n=r(1810),s=r(7253);const i=process.env.NODE_HUE_API_SUPPRESS_DEPRICATION_WARNINGS||false;e.exports={parseErrors:parseErrors,wasSuccessful:wasSuccessful,extractUpdatedAttributes:extractUpdatedAttributes,toStringArray:asStringArray,flatten:mergeArrays,getValueForKey:getValueforKey,deprecatedFunction:deprecatedFunction};function parseErrors(e){let t=[];if(Array.isArray(e)){e.forEach(e=>{if(!e.success){t=t.concat(this.parseErrors(e))}})}else{if(e.error){if(e.error.description&&!e.error.message){const r=Object.assign({message:e.error.description},e.error);t.push(new s(r))}else{t.push(new s(e.error))}}}return t.length>0?t:null}function wasSuccessful(e){let t=true,r,n;if(Array.isArray(e)){for(r=0,n=e.length;r<n;r++){t=t&&wasSuccessful(e[r])}}else{t=e.success!==undefined}return t}function extractUpdatedAttributes(e){if(wasSuccessful(e)){const t={};e.forEach(e=>{const r=e.success;Object.keys(r).forEach(e=>{const r=/.*\/(.*)$/.exec(e)[1];t[r]=true})});return t}else{throw new n("Error in response")}}function asStringArray(e){if(!e){return null}if(Array.isArray(e)){const t=[];e.forEach(e=>{t.push(`${e}`)});return t}else{return[`${e}`]}}function getValueforKey(e,t){const r=e.split(".");let n=t,s=null;r.forEach(e=>{if(n!=null){s=n[e];n=s}else{n=null}});return s}function mergeArrays(){let e=[];Array.from(arguments).forEach(t=>{if(t){e=e.concat(t)}});return e}function deprecatedFunction(e,t,r){if(i){return}console.log(`**************************************************************************************************`);console.log(`Deprecated Function Usage: ${t}\n`);console.log(`  ${r}\n`);console.log(`  Function will be removed from node-hue-api in version ${e}`);console.log(`**************************************************************************************************`)}},7548:(e,t,r)=>{"use strict";const n=r(4305),s=r(3305),i=r(4465),o=r(1810),u=r(7516);e.exports={api:n,discovery:{upnpSearch:e=>{u.deprecatedFunction("6.x",`require('node-hue-api').v3.discovery.upnpSearch()`,`Use require('node-hue-api').discovery.upnpSearch()`);return s.upnpSearch(e)},nupnpSearch:()=>{u.deprecatedFunction("6.x",`require('node-hue-api').v3.discovery.nupnpSearch()`,`Use require('node-hue-api').discovery.nupnpSearch()`);return s.nupnpSearch()},description:e=>{u.deprecatedFunction("6.x",`require('node-hue-api').v3.discovery.description(ipAddress)`,`Use require('node-hue-api').discovery.description(ipAddress)`);return s.description(e)}},lightStates:i.lightStates,model:i,sensors:sensorsObject("Sensors are now contained in the v3.model interface\n"+"You can use the v3.model.createCLIP[xxx]Sensor() where [xxx] is the type of Sensor to instantiate a sensor."),Scene:classRemoved("Scenes are no longer exposed as a class.\n"+"Create a Scene using v3.model.createLightScene() or v3.model.createGroupScene()"),rules:rulesObject("Rules are now exposed under the v3.model interface.\n"+"Create a rule using v3.model.createRule()\n"+"Create a RuleCondition using v3.model.ruleConditions.[sensor|group]()\n"+"Create a RuleAction using v3.mode.ruleActions.[light|group|sensor|scene]\n")};function sensorsObject(e){return{clip:{GenericFlag:classRemoved(e),OpenClose:classRemoved(e),GenericStatus:classRemoved(e),Humidity:classRemoved(e),Lightlevel:classRemoved(e),Presence:classRemoved(e),Switch:classRemoved(e),Temperature:classRemoved(e)}}}function rulesObject(e){return{Rule:classRemoved(e),conditions:{group:functionRemoved(e),sensor:functionRemoved(e)},actions:{light:functionRemoved(e),group:functionRemoved(e),scene:functionRemoved(e)}}}function functionRemoved(e){return function(){throw new o(e)}}function classRemoved(e){return class RemovedClass{constructor(){throw new o(e)}}}},132:module=>{module.exports=eval("require")("supports-color")},696:e=>{"use strict";e.exports=JSON.parse('{"_from":"axios@^0.19.2","_id":"axios@0.19.2","_inBundle":false,"_integrity":"sha512-fjgm5MvRHLhx+osE2xoekY70AhARk3a6hkN+3Io1jc00jtquGvxYlKlsFUhmUET0V5te6CcZI7lcv2Ym61mjHA==","_location":"/axios","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"axios@^0.19.2","name":"axios","escapedName":"axios","rawSpec":"^0.19.2","saveSpec":null,"fetchSpec":"^0.19.2"},"_requiredBy":["/node-hue-api"],"_resolved":"https://registry.npmjs.org/axios/-/axios-0.19.2.tgz","_shasum":"3ea36c5d8818d0d5f8a8a97a6d36b86cdc00cb27","_spec":"axios@^0.19.2","_where":"/Users/peter-murray/code/winterfest-2020/xmas-lights/hue-lights-action/node_modules/node-hue-api","author":{"name":"Matt Zabriskie"},"browser":{"./lib/adapters/http.js":"./lib/adapters/xhr.js"},"bugs":{"url":"https://github.com/axios/axios/issues"},"bundleDependencies":false,"bundlesize":[{"path":"./dist/axios.min.js","threshold":"5kB"}],"dependencies":{"follow-redirects":"1.5.10"},"deprecated":false,"description":"Promise based HTTP client for the browser and node.js","devDependencies":{"bundlesize":"^0.17.0","coveralls":"^3.0.0","es6-promise":"^4.2.4","grunt":"^1.0.2","grunt-banner":"^0.6.0","grunt-cli":"^1.2.0","grunt-contrib-clean":"^1.1.0","grunt-contrib-watch":"^1.0.0","grunt-eslint":"^20.1.0","grunt-karma":"^2.0.0","grunt-mocha-test":"^0.13.3","grunt-ts":"^6.0.0-beta.19","grunt-webpack":"^1.0.18","istanbul-instrumenter-loader":"^1.0.0","jasmine-core":"^2.4.1","karma":"^1.3.0","karma-chrome-launcher":"^2.2.0","karma-coverage":"^1.1.1","karma-firefox-launcher":"^1.1.0","karma-jasmine":"^1.1.1","karma-jasmine-ajax":"^0.1.13","karma-opera-launcher":"^1.0.0","karma-safari-launcher":"^1.0.0","karma-sauce-launcher":"^1.2.0","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^1.7.0","load-grunt-tasks":"^3.5.2","minimist":"^1.2.0","mocha":"^5.2.0","sinon":"^4.5.0","typescript":"^2.8.1","url-search-params":"^0.10.0","webpack":"^1.13.1","webpack-dev-server":"^1.14.1"},"homepage":"https://github.com/axios/axios","keywords":["xhr","http","ajax","promise","node"],"license":"MIT","main":"index.js","name":"axios","repository":{"type":"git","url":"git+https://github.com/axios/axios.git"},"scripts":{"build":"NODE_ENV=production grunt build","coveralls":"cat coverage/lcov.info | ./node_modules/coveralls/bin/coveralls.js","examples":"node ./examples/server.js","fix":"eslint --fix lib/**/*.js","postversion":"git push && git push --tags","preversion":"npm test","start":"node ./sandbox/server.js","test":"grunt test && bundlesize","version":"npm run build && grunt version && git add -A dist && git add CHANGELOG.md bower.json package.json"},"typings":"./index.d.ts","version":"0.19.2"}')},3122:e=>{"use strict";e.exports=JSON.parse("{\"blacklist_client.lua\":\"local blacklist = ARGV[num_static_argv + 1]\\n\\nif redis.call('zscore', client_last_seen_key, blacklist) then\\n  redis.call('zadd', client_last_seen_key, 0, blacklist)\\nend\\n\\n\\nreturn {}\\n\",\"check.lua\":\"local weight = tonumber(ARGV[num_static_argv + 1])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\nlocal nextRequest = tonumber(redis.call('hget', settings_key, 'nextRequest'))\\n\\nreturn conditions_check(capacity, weight) and nextRequest - now <= 0\\n\",\"conditions_check.lua\":\"local conditions_check = function (capacity, weight)\\n  return capacity == nil or weight <= capacity\\nend\\n\",\"current_reservoir.lua\":\"return process_tick(now, false)['reservoir']\\n\",\"done.lua\":\"process_tick(now, false)\\n\\nreturn tonumber(redis.call('hget', settings_key, 'done'))\\n\",\"free.lua\":\"local index = ARGV[num_static_argv + 1]\\n\\nredis.call('zadd', job_expirations_key, 0, index)\\n\\nreturn process_tick(now, false)['running']\\n\",\"get_time.lua\":\"redis.replicate_commands()\\n\\nlocal get_time = function ()\\n  local time = redis.call('time')\\n\\n  return tonumber(time[1]..string.sub(time[2], 1, 3))\\nend\\n\",\"group_check.lua\":\"return not (redis.call('exists', settings_key) == 1)\\n\",\"heartbeat.lua\":\"process_tick(now, true)\\n\",\"increment_reservoir.lua\":\"local incr = tonumber(ARGV[num_static_argv + 1])\\n\\nredis.call('hincrby', settings_key, 'reservoir', incr)\\n\\nlocal reservoir = process_tick(now, true)['reservoir']\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn reservoir\\n\",\"init.lua\":\"local clear = tonumber(ARGV[num_static_argv + 1])\\nlocal limiter_version = ARGV[num_static_argv + 2]\\nlocal num_local_argv = num_static_argv + 2\\n\\nif clear == 1 then\\n  redis.call('del', unpack(KEYS))\\nend\\n\\nif redis.call('exists', settings_key) == 0 then\\n  -- Create\\n  local args = {'hmset', settings_key}\\n\\n  for i = num_local_argv + 1, #ARGV do\\n    table.insert(args, ARGV[i])\\n  end\\n\\n  redis.call(unpack(args))\\n  redis.call('hmset', settings_key,\\n    'nextRequest', now,\\n    'lastReservoirRefresh', now,\\n    'lastReservoirIncrease', now,\\n    'running', 0,\\n    'done', 0,\\n    'unblockTime', 0,\\n    'capacityPriorityCounter', 0\\n  )\\n\\nelse\\n  -- Apply migrations\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'version'\\n  )\\n  local id = settings[1]\\n  local current_version = settings[2]\\n\\n  if current_version ~= limiter_version then\\n    local version_digits = {}\\n    for k, v in string.gmatch(current_version, \\\"([^.]+)\\\") do\\n      table.insert(version_digits, tonumber(k))\\n    end\\n\\n    -- 2.10.0\\n    if version_digits[2] < 10 then\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirRefreshAmount', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirRefresh', '')\\n      redis.call('hsetnx', settings_key, 'done', 0)\\n      redis.call('hset', settings_key, 'version', '2.10.0')\\n    end\\n\\n    -- 2.11.1\\n    if version_digits[2] < 11 or (version_digits[2] == 11 and version_digits[3] < 1) then\\n      if redis.call('hstrlen', settings_key, 'lastReservoirRefresh') == 0 then\\n        redis.call('hmset', settings_key,\\n          'lastReservoirRefresh', now,\\n          'version', '2.11.1'\\n        )\\n      end\\n    end\\n\\n    -- 2.14.0\\n    if version_digits[2] < 14 then\\n      local old_running_key = 'b_'..id..'_running'\\n      local old_executing_key = 'b_'..id..'_executing'\\n\\n      if redis.call('exists', old_running_key) == 1 then\\n        redis.call('rename', old_running_key, job_weights_key)\\n      end\\n      if redis.call('exists', old_executing_key) == 1 then\\n        redis.call('rename', old_executing_key, job_expirations_key)\\n      end\\n      redis.call('hset', settings_key, 'version', '2.14.0')\\n    end\\n\\n    -- 2.15.2\\n    if version_digits[2] < 15 or (version_digits[2] == 15 and version_digits[3] < 2) then\\n      redis.call('hsetnx', settings_key, 'capacityPriorityCounter', 0)\\n      redis.call('hset', settings_key, 'version', '2.15.2')\\n    end\\n\\n    -- 2.17.0\\n    if version_digits[2] < 17 then\\n      redis.call('hsetnx', settings_key, 'clientTimeout', 10000)\\n      redis.call('hset', settings_key, 'version', '2.17.0')\\n    end\\n\\n    -- 2.18.0\\n    if version_digits[2] < 18 then\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseInterval', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseAmount', '')\\n      redis.call('hsetnx', settings_key, 'reservoirIncreaseMaximum', '')\\n      redis.call('hsetnx', settings_key, 'lastReservoirIncrease', now)\\n      redis.call('hset', settings_key, 'version', '2.18.0')\\n    end\\n\\n  end\\n\\n  process_tick(now, false)\\nend\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"process_tick.lua\":\"local process_tick = function (now, always_publish)\\n\\n  local compute_capacity = function (maxConcurrent, running, reservoir)\\n    if maxConcurrent ~= nil and reservoir ~= nil then\\n      return math.min((maxConcurrent - running), reservoir)\\n    elseif maxConcurrent ~= nil then\\n      return maxConcurrent - running\\n    elseif reservoir ~= nil then\\n      return reservoir\\n    else\\n      return nil\\n    end\\n  end\\n\\n  local settings = redis.call('hmget', settings_key,\\n    'id',\\n    'maxConcurrent',\\n    'running',\\n    'reservoir',\\n    'reservoirRefreshInterval',\\n    'reservoirRefreshAmount',\\n    'lastReservoirRefresh',\\n    'reservoirIncreaseInterval',\\n    'reservoirIncreaseAmount',\\n    'reservoirIncreaseMaximum',\\n    'lastReservoirIncrease',\\n    'capacityPriorityCounter',\\n    'clientTimeout'\\n  )\\n  local id = settings[1]\\n  local maxConcurrent = tonumber(settings[2])\\n  local running = tonumber(settings[3])\\n  local reservoir = tonumber(settings[4])\\n  local reservoirRefreshInterval = tonumber(settings[5])\\n  local reservoirRefreshAmount = tonumber(settings[6])\\n  local lastReservoirRefresh = tonumber(settings[7])\\n  local reservoirIncreaseInterval = tonumber(settings[8])\\n  local reservoirIncreaseAmount = tonumber(settings[9])\\n  local reservoirIncreaseMaximum = tonumber(settings[10])\\n  local lastReservoirIncrease = tonumber(settings[11])\\n  local capacityPriorityCounter = tonumber(settings[12])\\n  local clientTimeout = tonumber(settings[13])\\n\\n  local initial_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  --\\n  -- Process 'running' changes\\n  --\\n  local expired = redis.call('zrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n  if #expired > 0 then\\n    redis.call('zremrangebyscore', job_expirations_key, '-inf', '('..now)\\n\\n    local flush_batch = function (batch, acc)\\n      local weights = redis.call('hmget', job_weights_key, unpack(batch))\\n                      redis.call('hdel',  job_weights_key, unpack(batch))\\n      local clients = redis.call('hmget', job_clients_key, unpack(batch))\\n                      redis.call('hdel',  job_clients_key, unpack(batch))\\n\\n      -- Calculate sum of removed weights\\n      for i = 1, #weights do\\n        acc['total'] = acc['total'] + (tonumber(weights[i]) or 0)\\n      end\\n\\n      -- Calculate sum of removed weights by client\\n      local client_weights = {}\\n      for i = 1, #clients do\\n        local removed = tonumber(weights[i]) or 0\\n        if removed > 0 then\\n          acc['client_weights'][clients[i]] = (acc['client_weights'][clients[i]] or 0) + removed\\n        end\\n      end\\n    end\\n\\n    local acc = {\\n      ['total'] = 0,\\n      ['client_weights'] = {}\\n    }\\n    local batch_size = 1000\\n\\n    -- Compute changes to Zsets and apply changes to Hashes\\n    for i = 1, #expired, batch_size do\\n      local batch = {}\\n      for j = i, math.min(i + batch_size - 1, #expired) do\\n        table.insert(batch, expired[j])\\n      end\\n\\n      flush_batch(batch, acc)\\n    end\\n\\n    -- Apply changes to Zsets\\n    if acc['total'] > 0 then\\n      redis.call('hincrby', settings_key, 'done', acc['total'])\\n      running = tonumber(redis.call('hincrby', settings_key, 'running', -acc['total']))\\n    end\\n\\n    for client, weight in pairs(acc['client_weights']) do\\n      redis.call('zincrby', client_running_key, -weight, client)\\n    end\\n  end\\n\\n  --\\n  -- Process 'reservoir' changes\\n  --\\n  local reservoirRefreshActive = reservoirRefreshInterval ~= nil and reservoirRefreshAmount ~= nil\\n  if reservoirRefreshActive and now >= lastReservoirRefresh + reservoirRefreshInterval then\\n    reservoir = reservoirRefreshAmount\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirRefresh', now\\n    )\\n  end\\n\\n  local reservoirIncreaseActive = reservoirIncreaseInterval ~= nil and reservoirIncreaseAmount ~= nil\\n  if reservoirIncreaseActive and now >= lastReservoirIncrease + reservoirIncreaseInterval then\\n    local num_intervals = math.floor((now - lastReservoirIncrease) / reservoirIncreaseInterval)\\n    local incr = reservoirIncreaseAmount * num_intervals\\n    if reservoirIncreaseMaximum ~= nil then\\n      incr = math.min(incr, reservoirIncreaseMaximum - (reservoir or 0))\\n    end\\n    if incr > 0 then\\n      reservoir = (reservoir or 0) + incr\\n    end\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'lastReservoirIncrease', lastReservoirIncrease + (num_intervals * reservoirIncreaseInterval)\\n    )\\n  end\\n\\n  --\\n  -- Clear unresponsive clients\\n  --\\n  local unresponsive = redis.call('zrangebyscore', client_last_seen_key, '-inf', (now - clientTimeout))\\n  local unresponsive_lookup = {}\\n  local terminated_clients = {}\\n  for i = 1, #unresponsive do\\n    unresponsive_lookup[unresponsive[i]] = true\\n    if tonumber(redis.call('zscore', client_running_key, unresponsive[i])) == 0 then\\n      table.insert(terminated_clients, unresponsive[i])\\n    end\\n  end\\n  if #terminated_clients > 0 then\\n    redis.call('zrem', client_running_key,         unpack(terminated_clients))\\n    redis.call('hdel', client_num_queued_key,      unpack(terminated_clients))\\n    redis.call('zrem', client_last_registered_key, unpack(terminated_clients))\\n    redis.call('zrem', client_last_seen_key,       unpack(terminated_clients))\\n  end\\n\\n  --\\n  -- Broadcast capacity changes\\n  --\\n  local final_capacity = compute_capacity(maxConcurrent, running, reservoir)\\n\\n  if always_publish or (initial_capacity ~= nil and final_capacity == nil) then\\n    -- always_publish or was not unlimited, now unlimited\\n    redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n\\n  elseif initial_capacity ~= nil and final_capacity ~= nil and final_capacity > initial_capacity then\\n    -- capacity was increased\\n    -- send the capacity message to the limiter having the lowest number of running jobs\\n    -- the tiebreaker is the limiter having not registered a job in the longest time\\n\\n    local lowest_concurrency_value = nil\\n    local lowest_concurrency_clients = {}\\n    local lowest_concurrency_last_registered = {}\\n    local client_concurrencies = redis.call('zrange', client_running_key, 0, -1, 'withscores')\\n\\n    for i = 1, #client_concurrencies, 2 do\\n      local client = client_concurrencies[i]\\n      local concurrency = tonumber(client_concurrencies[i+1])\\n\\n      if (\\n        lowest_concurrency_value == nil or lowest_concurrency_value == concurrency\\n      ) and (\\n        not unresponsive_lookup[client]\\n      ) and (\\n        tonumber(redis.call('hget', client_num_queued_key, client)) > 0\\n      ) then\\n        lowest_concurrency_value = concurrency\\n        table.insert(lowest_concurrency_clients, client)\\n        local last_registered = tonumber(redis.call('zscore', client_last_registered_key, client))\\n        table.insert(lowest_concurrency_last_registered, last_registered)\\n      end\\n    end\\n\\n    if #lowest_concurrency_clients > 0 then\\n      local position = 1\\n      local earliest = lowest_concurrency_last_registered[1]\\n\\n      for i,v in ipairs(lowest_concurrency_last_registered) do\\n        if v < earliest then\\n          position = i\\n          earliest = v\\n        end\\n      end\\n\\n      local next_client = lowest_concurrency_clients[position]\\n      redis.call('publish', 'b_'..id,\\n        'capacity-priority:'..(final_capacity or '')..\\n        ':'..next_client..\\n        ':'..capacityPriorityCounter\\n      )\\n      redis.call('hincrby', settings_key, 'capacityPriorityCounter', '1')\\n    else\\n      redis.call('publish', 'b_'..id, 'capacity:'..(final_capacity or ''))\\n    end\\n  end\\n\\n  return {\\n    ['capacity'] = final_capacity,\\n    ['running'] = running,\\n    ['reservoir'] = reservoir\\n  }\\nend\\n\",\"queued.lua\":\"local clientTimeout = tonumber(redis.call('hget', settings_key, 'clientTimeout'))\\nlocal valid_clients = redis.call('zrangebyscore', client_last_seen_key, (now - clientTimeout), 'inf')\\nlocal client_queued = redis.call('hmget', client_num_queued_key, unpack(valid_clients))\\n\\nlocal sum = 0\\nfor i = 1, #client_queued do\\n  sum = sum + tonumber(client_queued[i])\\nend\\n\\nreturn sum\\n\",\"refresh_expiration.lua\":\"local refresh_expiration = function (now, nextRequest, groupTimeout)\\n\\n  if groupTimeout ~= nil then\\n    local ttl = (nextRequest + groupTimeout) - now\\n\\n    for i = 1, #KEYS do\\n      redis.call('pexpire', KEYS[i], ttl)\\n    end\\n  end\\n\\nend\\n\",\"refs.lua\":\"local settings_key = KEYS[1]\\nlocal job_weights_key = KEYS[2]\\nlocal job_expirations_key = KEYS[3]\\nlocal job_clients_key = KEYS[4]\\nlocal client_running_key = KEYS[5]\\nlocal client_num_queued_key = KEYS[6]\\nlocal client_last_registered_key = KEYS[7]\\nlocal client_last_seen_key = KEYS[8]\\n\\nlocal now = tonumber(ARGV[1])\\nlocal client = ARGV[2]\\n\\nlocal num_static_argv = 2\\n\",\"register.lua\":\"local index = ARGV[num_static_argv + 1]\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\nlocal expiration = tonumber(ARGV[num_static_argv + 3])\\n\\nlocal state = process_tick(now, false)\\nlocal capacity = state['capacity']\\nlocal reservoir = state['reservoir']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'nextRequest',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal nextRequest = tonumber(settings[1])\\nlocal minTime = tonumber(settings[2])\\nlocal groupTimeout = tonumber(settings[3])\\n\\nif conditions_check(capacity, weight) then\\n\\n  redis.call('hincrby', settings_key, 'running', weight)\\n  redis.call('hset', job_weights_key, index, weight)\\n  if expiration ~= nil then\\n    redis.call('zadd', job_expirations_key, now + expiration, index)\\n  end\\n  redis.call('hset', job_clients_key, index, client)\\n  redis.call('zincrby', client_running_key, weight, client)\\n  redis.call('hincrby', client_num_queued_key, client, -1)\\n  redis.call('zadd', client_last_registered_key, now, client)\\n\\n  local wait = math.max(nextRequest - now, 0)\\n  local newNextRequest = now + wait + minTime\\n\\n  if reservoir == nil then\\n    redis.call('hset', settings_key,\\n      'nextRequest', newNextRequest\\n    )\\n  else\\n    reservoir = reservoir - weight\\n    redis.call('hmset', settings_key,\\n      'reservoir', reservoir,\\n      'nextRequest', newNextRequest\\n    )\\n  end\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\n\\n  return {true, wait, reservoir}\\n\\nelse\\n  return {false}\\nend\\n\",\"register_client.lua\":\"local queued = tonumber(ARGV[num_static_argv + 1])\\n\\n-- Could have been re-registered concurrently\\nif not redis.call('zscore', client_last_seen_key, client) then\\n  redis.call('zadd', client_running_key, 0, client)\\n  redis.call('hset', client_num_queued_key, client, queued)\\n  redis.call('zadd', client_last_registered_key, 0, client)\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\\nreturn {}\\n\",\"running.lua\":\"return process_tick(now, false)['running']\\n\",\"submit.lua\":\"local queueLength = tonumber(ARGV[num_static_argv + 1])\\nlocal weight = tonumber(ARGV[num_static_argv + 2])\\n\\nlocal capacity = process_tick(now, false)['capacity']\\n\\nlocal settings = redis.call('hmget', settings_key,\\n  'id',\\n  'maxConcurrent',\\n  'highWater',\\n  'nextRequest',\\n  'strategy',\\n  'unblockTime',\\n  'penalty',\\n  'minTime',\\n  'groupTimeout'\\n)\\nlocal id = settings[1]\\nlocal maxConcurrent = tonumber(settings[2])\\nlocal highWater = tonumber(settings[3])\\nlocal nextRequest = tonumber(settings[4])\\nlocal strategy = tonumber(settings[5])\\nlocal unblockTime = tonumber(settings[6])\\nlocal penalty = tonumber(settings[7])\\nlocal minTime = tonumber(settings[8])\\nlocal groupTimeout = tonumber(settings[9])\\n\\nif maxConcurrent ~= nil and weight > maxConcurrent then\\n  return redis.error_reply('OVERWEIGHT:'..weight..':'..maxConcurrent)\\nend\\n\\nlocal reachedHWM = (highWater ~= nil and queueLength == highWater\\n  and not (\\n    conditions_check(capacity, weight)\\n    and nextRequest - now <= 0\\n  )\\n)\\n\\nlocal blocked = strategy == 3 and (reachedHWM or unblockTime >= now)\\n\\nif blocked then\\n  local computedPenalty = penalty\\n  if computedPenalty == nil then\\n    if minTime == 0 then\\n      computedPenalty = 5000\\n    else\\n      computedPenalty = 15 * minTime\\n    end\\n  end\\n\\n  local newNextRequest = now + computedPenalty + minTime\\n\\n  redis.call('hmset', settings_key,\\n    'unblockTime', now + computedPenalty,\\n    'nextRequest', newNextRequest\\n  )\\n\\n  local clients_queued_reset = redis.call('hkeys', client_num_queued_key)\\n  local queued_reset = {}\\n  for i = 1, #clients_queued_reset do\\n    table.insert(queued_reset, clients_queued_reset[i])\\n    table.insert(queued_reset, 0)\\n  end\\n  redis.call('hmset', client_num_queued_key, unpack(queued_reset))\\n\\n  redis.call('publish', 'b_'..id, 'blocked:')\\n\\n  refresh_expiration(now, newNextRequest, groupTimeout)\\nend\\n\\nif not blocked and not reachedHWM then\\n  redis.call('hincrby', client_num_queued_key, client, 1)\\nend\\n\\nreturn {reachedHWM, blocked, strategy}\\n\",\"update_settings.lua\":\"local args = {'hmset', settings_key}\\n\\nfor i = num_static_argv + 1, #ARGV do\\n  table.insert(args, ARGV[i])\\nend\\n\\nredis.call(unpack(args))\\n\\nprocess_tick(now, true)\\n\\nlocal groupTimeout = tonumber(redis.call('hget', settings_key, 'groupTimeout'))\\nrefresh_expiration(0, 0, groupTimeout)\\n\\nreturn {}\\n\",\"validate_client.lua\":\"if not redis.call('zscore', client_last_seen_key, client) then\\n  return redis.error_reply('UNKNOWN_CLIENT')\\nend\\n\\nredis.call('zadd', client_last_seen_key, now, client)\\n\",\"validate_keys.lua\":\"if not (redis.call('exists', settings_key) == 1) then\\n  return redis.error_reply('SETTINGS_KEY_NOT_FOUND')\\nend\\n\"}")},8372:e=>{"use strict";e.exports={i:"2.19.5"}},2357:e=>{"use strict";e.exports=require("assert")},6417:e=>{"use strict";e.exports=require("crypto")},6200:e=>{"use strict";e.exports=require("dgram")},8614:e=>{"use strict";e.exports=require("events")},5747:e=>{"use strict";e.exports=require("fs")},8605:e=>{"use strict";e.exports=require("http")},7211:e=>{"use strict";e.exports=require("https")},2087:e=>{"use strict";e.exports=require("os")},5622:e=>{"use strict";e.exports=require("path")},2413:e=>{"use strict";e.exports=require("stream")},3867:e=>{"use strict";e.exports=require("tty")},8835:e=>{"use strict";e.exports=require("url")},1669:e=>{"use strict";e.exports=require("util")},8761:e=>{"use strict";e.exports=require("zlib")}};var __webpack_module_cache__={};function __webpack_require__(e){if(__webpack_module_cache__[e]){return __webpack_module_cache__[e].exports}var t=__webpack_module_cache__[e]={exports:{}};var r=true;try{__webpack_modules__[e].call(t.exports,t,t.exports,__webpack_require__);r=false}finally{if(r)delete __webpack_module_cache__[e]}return t.exports}__webpack_require__.ab=__dirname+"/";return __webpack_require__(2932)})();